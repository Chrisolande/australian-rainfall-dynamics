{
  "hash": "594269123b49c4343a01ff9f14755512",
  "result": {
    "engine": "knitr",
    "markdown": "# Feature Engineering {#sec-feature-eng}\n## From Raw Meteorological Signals to Predictive Inputs\n\n---\n\n> **Chapter Context.** This chapter documents the feature engineering pipeline that bridges the exploratory analysis and the final model. Each design decision traces directly to an empirical finding from the EDA: the features constructed here are not ad hoc transformations but targeted responses to identified distributional and structural properties of the data.\n\n---\n\n## Signal Extraction via Moving Averages\n\nDaily meteorological observations are inherently noisy. A single day's rainfall measurement reflects both the underlying weather regime and a high-frequency stochastic component, the difference between a storm cell passing directly over a station versus five kilometres to its east. Before engineering predictive features from this signal, we must first assess whether smoothing can reduce this noise and, if so, at what cost.\n\nRolling means over 3-day and 7-day trailing windows are computed for both rainfall and afternoon humidity. Right-alignment is enforced throughout, meaning the average at time $t$ is computed from observations at $t$, $t-1$, ..., $t-(k-1)$. This is a necessary precaution against data leakage: any lookahead alignment would contaminate the training signal with future observations.\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nma_data <- df_final %>%\n  group_by(location) %>%\n  arrange(date) %>%\n  mutate(\n    rainfall_ma3 = rollmean(rainfall, k = 3, fill = NA, align = \"right\"),\n    rainfall_ma7 = rollmean(rainfall, k = 7, fill = NA, align = \"right\"),\n    humidity_ma3 = rollmean(humidity3pm, k = 3, fill = NA, align = \"right\"),\n    humidity_ma7 = rollmean(humidity3pm, k = 7, fill = NA, align = \"right\")\n  ) %>%\n  ungroup()\n```\n:::\n\n\n### Noise Reduction\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1_data <- ma_data %>%\n  filter(rainfall > 0) %>%\n  select(rainfall, rainfall_ma3, rainfall_ma7) %>%\n  pivot_longer(everything(), names_to = \"metric\", values_to = \"value\") %>%\n  filter(!is.na(value)) %>%\n  mutate(\n    metric = factor(\n      metric,\n      levels = c(\"rainfall\", \"rainfall_ma3\", \"rainfall_ma7\"),\n      labels = c(\"Raw daily\", \"3-day MA\", \"7-day MA\")\n    )\n  )\n\nggplot(p1_data, aes(x = value, fill = metric, colour = metric)) +\n  geom_density(alpha = 0.38, linewidth = 0.8) +\n  annotation_logticks(sides = \"b\", colour = \"grey55\", linewidth = 0.3) +\n  scale_x_log10(\n    breaks = c(0.1, 0.5, 1, 5, 10, 50, 100),\n    labels = label_number(suffix = \" mm\"),\n    expand = expansion(mult = c(0.02, 0.02))\n  ) +\n  scale_y_continuous(expand = expansion(mult = c(0, 0.05))) +\n  scale_fill_manual(\n    values = c(\n      \"Raw daily\" = \"#C0392B\",\n      \"3-day MA\" = \"#E67E22\",\n      \"7-day MA\" = \"#1A7A4A\"\n    )\n  ) +\n  scale_colour_manual(\n    values = c(\n      \"Raw daily\" = \"#C0392B\",\n      \"3-day MA\" = \"#E67E22\",\n      \"7-day MA\" = \"#1A7A4A\"\n    )\n  ) +\n  labs(\n    title = \"Moving Averages Filter High-Frequency Noise\",\n    subtitle = \"Raw rainfall (red) is severely right-skewed. \n    The 7-day average (green) concentrates \n    probability mass near the regime centre.\",\n    x = \"Rainfall intensity (log scale)\",\n    y = \"Density\",\n    caption = \"Restricted to non-zero observations. Log scale on x-axis.\",\n    fill = NULL,\n    colour = NULL\n  ) +\n  feat_theme +\n  theme(\n    legend.position = \"top\",\n    legend.key.width = unit(0.8, \"cm\")\n  )\n```\n\n::: {.cell-output-display}\n![Density of raw and smoothed daily rainfall on non-zero days. The 7-day moving average acts as a low-pass filter: the distribution peak rises and the extreme right tail compresses, isolating the central tendency of wet regimes from day-to-day stochastic variance.](04-features_files/figure-html/fig-signal-extraction-1.png){#fig-signal-extraction fig-align='center' width=100%}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nvariance_data <- ma_data %>%\n  filter(rainfall > 0) %>%\n  summarise(\n    Raw = sd(rainfall, na.rm = TRUE),\n    `3-day MA` = sd(rainfall_ma3, na.rm = TRUE),\n    `7-day MA` = sd(rainfall_ma7, na.rm = TRUE)\n  ) %>%\n  pivot_longer(everything(), names_to = \"metric\", values_to = \"sd\") %>%\n  mutate(\n    metric = factor(metric, levels = c(\"Raw\", \"3-day MA\", \"7-day MA\")),\n    variance_reduction = (sd[metric == \"Raw\"] - sd) / sd[metric == \"Raw\"] * 100\n  )\n\nggplot(variance_data, aes(metric, sd, fill = metric)) +\n  geom_col(alpha = 0.85, width = 0.58) +\n  geom_text(\n    aes(label = sprintf(\"%.1f mm\\n(%.0f%% reduction)\", sd, variance_reduction)),\n    vjust = -0.35,\n    fontface = \"bold\",\n    size = 3.6,\n    colour = \"grey15\"\n  ) +\n  scale_fill_manual(\n    values = c(\n      \"Raw\" = \"#C0392B\",\n      \"3-day MA\" = \"#E67E22\",\n      \"7-day MA\" = \"#1A7A4A\"\n    )\n  ) +\n  scale_y_continuous(\n    expand = expansion(mult = c(0, 0.18)),\n    breaks = pretty_breaks(n = 5)\n  ) +\n  labs(\n    title = \"Variance Reduction by Moving Average Window\",\n    subtitle = \"Standard deviation falls as the averaging window widens.\",\n    y = \"Standard deviation (mm)\",\n    x = NULL\n  ) +\n  feat_theme +\n  theme(\n    legend.position = \"none\",\n    panel.grid.major.x = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![Standard deviation of rainfall by averaging window. Each additional day of smoothing removes a material fraction of the day-to-day stochastic variability, at the cost of reduced responsiveness to abrupt regime changes.](04-features_files/figure-html/fig-variance-reduction-1.png){#fig-variance-reduction fig-align='center' width=100%}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nridge_data <- ma_data %>%\n  filter(rainfall > 0) %>%\n  select(rainfall, rainfall_ma3, rainfall_ma7) %>%\n  pivot_longer(everything(), names_to = \"metric\", values_to = \"value\") %>%\n  filter(!is.na(value)) %>%\n  mutate(\n    metric = factor(\n      metric,\n      levels = c(\"rainfall_ma7\", \"rainfall_ma3\", \"rainfall\"),\n      labels = c(\"7-day MA\", \"3-day MA\", \"Raw daily\")\n    )\n  )\n\nggplot(ridge_data, aes(value, metric, fill = metric)) +\n  geom_density_ridges(\n    alpha = 0.72,\n    scale = 1.5,\n    quantile_lines = TRUE,\n    quantiles = 2,\n    colour = \"grey30\",\n    linewidth = 0.3\n  ) +\n  scale_x_log10(\n    breaks = c(1, 5, 10, 25, 50, 100),\n    labels = c(\"1\", \"5\", \"10\", \"25\", \"50\", \"100\"),\n    expand = expansion(mult = c(0.02, 0.04))\n  ) +\n  scale_fill_manual(\n    values = c(\n      \"Raw daily\" = \"#C0392B\",\n      \"3-day MA\" = \"#E67E22\",\n      \"7-day MA\" = \"#1A7A4A\"\n    )\n  ) +\n  labs(\n    title = \"Distribution Tightening with Moving Averages\",\n    subtitle = \"Peaks become sharper and tails compress\n    as window size increases. Median lines are stable.\",\n    x = \"Rainfall (mm, log scale)\",\n    y = NULL\n  ) +\n  feat_theme +\n  theme(\n    legend.position = \"none\",\n    panel.grid.major.y = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![Ridgeline distributions for raw and smoothed rainfall on non-zero days. Median lines confirm that the central tendency is stable across windows; the visible tail compression is purely a reduction in stochastic variance.](04-features_files/figure-html/fig-ma-ridgeline-1.png){#fig-ma-ridgeline fig-align='center' width=100%}\n:::\n:::\n\n\nThe density plots in @fig-signal-extraction make the smoothing effect immediately apparent. The raw daily distribution is severely right-skewed with a long tail reaching into the hundreds of millimetres, a consequence of the extreme kurtosis documented in @sec-eda. The 3-day moving average begins to suppress this variance, and the 7-day average produces a substantially more concentrated distribution whose peak is considerably higher and whose tails are dramatically shorter.\n\nQuantitatively (@fig-variance-reduction), the standard deviation of rainfall intensity falls from 13.1 mm in the raw series to 5.8 mm under the 7-day average, a reduction of 56%. The ridgeline plot (@fig-ma-ridgeline) confirms that this compression is not an artefact of the summary statistic: the entire shape of the distribution tightens, with the median remaining stable across windows while the spread narrows. The 7-day average can therefore be interpreted as a measure of the prevailing weekly wetness regime, a smoothed characterisation of whether the preceding week has been generally wet or dry rather than a reflection of any single day's unpredictability.\n\n### Multicollinearity Trade-off\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncor_data <- ma_data %>%\n  select(\n    rainfall,\n    rainfall_ma3,\n    rainfall_ma7,\n    humidity3pm,\n    humidity_ma3,\n    humidity_ma7\n  ) %>%\n  cor(use = \"complete.obs\", method = \"spearman\") %>%\n  as.data.frame() %>%\n  rownames_to_column(\"var1\") %>%\n  pivot_longer(-var1, names_to = \"var2\", values_to = \"correlation\") %>%\n  mutate(\n    var1 = factor(\n      var1,\n      levels = c(\n        \"rainfall\",\n        \"rainfall_ma3\",\n        \"rainfall_ma7\",\n        \"humidity3pm\",\n        \"humidity_ma3\",\n        \"humidity_ma7\"\n      )\n    ),\n    var2 = factor(\n      var2,\n      levels = c(\n        \"rainfall\",\n        \"rainfall_ma3\",\n        \"rainfall_ma7\",\n        \"humidity3pm\",\n        \"humidity_ma3\",\n        \"humidity_ma7\"\n      )\n    )\n  )\n\nggplot(cor_data, aes(var2, var1, fill = correlation)) +\n  geom_tile(colour = \"white\", linewidth = 0.8) +\n  geom_text(\n    aes(label = sprintf(\"%.2f\", correlation)),\n    size = 3.2,\n    colour = \"grey15\",\n    fontface = \"plain\"\n  ) +\n  scale_fill_gradient2(\n    low = \"#2166AC\",\n    mid = \"white\",\n    high = \"#B2182B\",\n    midpoint = 0,\n    limits = c(-1, 1),\n    name = \"Spearman\\nr\"\n  ) +\n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0)) +\n  labs(\n    title = \"Correlations: Raw Variables vs. Moving Averages\",\n    subtitle = \"High within-variable correlations warn of multicollinearity for linear model families.\",\n    x = NULL,\n    y = NULL\n  ) +\n  feat_theme +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    panel.grid.major = element_blank(),\n    legend.position = \"right\",\n    legend.key.height = unit(1.1, \"cm\"),\n    legend.key.width = unit(0.4, \"cm\")\n  )\n```\n\n::: {.cell-output-display}\n![Spearman correlations between raw rainfall and humidity variables and their moving average counterparts. The high within-variable correlations (upper-left and lower-right blocks) confirm that including multiple windows of the same variable in a linear model would produce a near-singular design matrix.](04-features_files/figure-html/fig-ma-correlation-1.png){#fig-ma-correlation fig-align='center' width=100%}\n:::\n:::\n\n\nThe noise-reduction benefit of moving averages comes at a cost. As shown in @fig-ma-correlation, the 3-day and 7-day humidity moving averages share a Spearman correlation of 0.89, and the equivalent rainfall moving averages are similarly collinear with each other and with the raw series. Including multiple moving average windows alongside their source variables in the same linear model would produce a near-singular design matrix, inflating coefficient standard errors and making the model numerically unstable.\n\nThis presents a choice between responsiveness and stability. The 3-day average reacts more quickly to changing conditions but retains more of the day-to-day variability. The 7-day average is more stable but slower to reflect recent changes in the weather regime. For linear model families such as logistic regression, only one window can be safely retained per variable; including both is not viable. For tree-based models such as Random Forest and Gradient Boosting, this constraint does not apply, since these methods select among correlated features at each split rather than inverting the full covariance matrix. The moving average selection strategy therefore depends on the model family, a consideration that informs the variable selection carried out in the subsequent modelling chapter.\n\n---\n\n---\n\n## Feature Engineering Pipeline\n\nThe following pipeline implements the complete set of features motivated by the EDA. Each transformation is annotated to its originating empirical finding.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncompass_lookup <- c(\n  \"N\" = 0,\n  \"NNE\" = 22.5,\n  \"NE\" = 45,\n  \"ENE\" = 67.5,\n  \"E\" = 90,\n  \"ESE\" = 112.5,\n  \"SE\" = 135,\n  \"SSE\" = 157.5,\n  \"S\" = 180,\n  \"SSW\" = 202.5,\n  \"SW\" = 225,\n  \"WSW\" = 247.5,\n  \"W\" = 270,\n  \"WNW\" = 292.5,\n  \"NW\" = 315,\n  \"NNW\" = 337.5\n)\n\ndf_final <- df_final %>%\n  group_by(location) %>%\n  arrange(date) %>%\n  mutate(\n    # Lag the rolling window by one additional day to prevent same-day leakage\n    rainfall_ma7 = lag(\n      rollmean(rainfall, k = 7, fill = NA, align = \"right\"),\n      n = 1\n    ),\n    humidity_ma7 = lag(\n      rollmean(humidity3pm, k = 7, fill = NA, align = \"right\"),\n      n = 1\n    ),\n\n    # Dry spell counter\n    rain_event_id = cumsum(lag(rainfall, 1) > 0),\n    days_since_rain = row_number() - match(rain_event_id, rain_event_id),\n\n    # First-order Markov state\n    rain_yesterday = lag(rain_today, n = 1)\n  ) %>%\n  ungroup() %>%\n  filter(!is.na(rain_yesterday), !is.na(rainfall_ma7)) %>%\n  select(-rain_event_id) %>%\n  mutate(\n    # Cyclical annual encoding\n    day_of_year = yday(date),\n    day_sin = sin(2 * pi * day_of_year / 365),\n    day_cos = cos(2 * pi * day_of_year / 365),\n\n    # Mean-centred interaction term (the \"Rain Corner\")\n    sunshine = as.numeric(scale(sunshine, center = TRUE, scale = FALSE)),\n    humidity3pm = as.numeric(scale(humidity3pm, center = TRUE, scale = FALSE)),\n    sun_humid_interaction = as.numeric(sunshine * humidity3pm),\n\n    # Meteorological derived indices\n    pressure_change = pressure3pm - pressure9am,\n    dewpoint_9am = temp9am - ((100 - humidity9am) / 5),\n    dewpoint_3pm = temp3pm - ((100 - humidity3pm) / 5),\n    dewpoint_change = dewpoint_3pm - dewpoint_9am,\n    moisture_index = humidity3pm * (1 - sunshine / 15),\n    instability_index = (1020 - pressure3pm) * humidity3pm / 100,\n    cloud_development = pmax(0, cloud3pm - cloud9am),\n\n    # Circular wind vector decomposition\n    gust_rad = compass_lookup[wind_gust_dir] * pi / 180,\n    gust_V_NS = wind_gust_speed * cos(gust_rad),\n    gust_U_EW = wind_gust_speed * sin(gust_rad),\n    wind9am_rad = compass_lookup[wind_dir9am] * pi / 180,\n    wind9am_V_NS = wind_speed9am * cos(wind9am_rad),\n    wind9am_U_EW = wind_speed9am * sin(wind9am_rad)\n  ) %>%\n  relocate(rain_today, date, location) %>%\n  relocate(rain_yesterday, days_since_rain, .after = location) %>%\n  relocate(ends_with(\"_ma7\"), .after = days_since_rain) %>%\n  relocate(day_sin, day_cos, .after = date)\n```\n:::\n\n\nThe pipeline is organised into four conceptually distinct transformations, each addressing a specific structural property identified in the EDA.\n\n### Cyclical Encoding of Seasonality\n\nThe seasonal analysis established that rainfall frequency and intensity follow a smooth annual cycle: summer events are rarer but more intense, winter events are more frequent but lighter, and the transition months connect these poles continuously. Treating month as a standard integer (1 through 12) would incorrectly imply that January and December are maximally distant on the number line, when in reality they are climatologically adjacent. Treating it as an unordered factor imposes no such adjacency constraint but discards ordinal information entirely.\n\nThe appropriate solution is to represent the annual cycle as a point on the unit circle, decomposed into its sine and cosine components:\n\n$$\\text{day\\_sin} = \\sin\\!\\left(\\frac{2\\pi \\cdot \\text{day\\_of\\_year}}{365}\\right), \\quad \\text{day\\_cos} = \\cos\\!\\left(\\frac{2\\pi \\cdot \\text{day\\_of\\_year}}{365}\\right)$$\n\nTogether, these two features encode any day of the year as a unique coordinate on the unit circle. The distance between any two days in this space reflects their true circular proximity: the December-to-January transition corresponds to a small arc, not a large jump. The model can learn smooth seasonal effects directly from the geometry of this representation.\n\n### Temporal Persistence Features\n\nThe Markov Chain analysis (@sec-markov) demonstrated that the previous day's rain state carries a moderate but meaningful signal ($V \\approx 0.31$), and the dry spell analysis showed that the probability of rain decays in a non-linear pattern as dry spells lengthen. Three features capture these dynamics.\n\n`rain_yesterday` is a direct binary indicator of the previous day's state, encoding the first-order Markov transition as a predictor. `days_since_rain` counts the number of consecutive dry days preceding the current observation, capturing the progressive stabilisation of dry conditions that the logistic regression and spline analysis identified. `rainfall_ma7` and `humidity_ma7` provide a smoothed weekly context for both the rainfall and moisture signals, lagged by one additional day beyond the rolling window to ensure that no same-day information is included when predicting today's outcome.\n\nThe lagging step deserves emphasis. Without it, the 7-day moving average at time $t$ includes the observation at time $t$ itself, meaning a model trained on this feature would have access to the value it is trying to predict. This form of data leakage produces artificially optimistic training metrics that do not generalise to deployment, where future observations are unavailable by definition.\n\n### Physical Interaction and Derived Indices\n\nThe bivariate density analysis (@sec-bivariate-density) identified a qualitative difference in the joint distribution of humidity and sunshine between rainy and dry days: rain occurs almost exclusively when afternoon humidity is high and sunshine hours are low simultaneously, the \"Rain Corner\" phenomenon. An additive model cannot represent this conditional structure; a multiplicative interaction term is required.\n\nPrior to computing the interaction, both `sunshine` and `humidity3pm` are mean-centred by subtracting their grand means. This is not merely a cosmetic step. When an interaction term is formed from un-centred variables, the resulting product is algebraically correlated with both main effects, inflating the VIF of all three terms and making their individual coefficients difficult to interpret. Centring removes this artificial correlation: the main effects then represent the effect of each variable at the average level of the other, and the interaction term represents the additional effect of their joint deviation from those averages. This is confirmed empirically in the VIF diagnostics in Section 3.\n\nBeyond the interaction term, five derived meteorological indices are constructed from physically motivated combinations of the available variables. The dewpoint temperatures at 9:00 AM and 3:00 PM, computed from the Magnus approximation $T_d \\approx T - \\frac{100 - RH}{5}$, represent the temperature at which the air would become saturated if cooled at constant pressure. The change in dewpoint across the day (`dewpoint_change`) measures whether the atmosphere is gaining or losing moisture over the course of the day, a signal not directly recoverable from temperature or humidity alone. The `moisture_index` encodes the combined effect of high humidity and limited solar exposure. The `instability_index` combines pressure deficit from the standard 1020 hPa baseline with humidity, approximating the atmospheric conditions that favour convective development. `cloud_development` captures upward cloud formation during the day, which the pressure analysis identified as a meaningful precursor to precipitation.\n\n### Circular Wind Vector Decomposition\n\nWind direction is a circular variable: 360 degrees and 0 degrees represent the same direction (due North), yet a naive numeric encoding would treat them as maximally distant. This misrepresentation is particularly consequential for wind because the directional origin of an air mass carries meaningful physical content: moisture-laden northerly flows behave very differently from dry southerly flows in the Australian context.\n\nThe standard solution is to decompose each directional reading into orthogonal Cartesian components by projecting the wind vector onto the north-south and east-west axes:\n\n$$U_{EW} = v \\cdot \\sin(\\theta), \\quad V_{NS} = v \\cdot \\cos(\\theta)$$\n\nwhere $v$ is wind speed (in km/h) and $\\theta$ is the compass bearing in radians. The resulting U and V components are continuous and interpretable: a purely northerly wind of 20 km/h produces $V_{NS} = 20$, $U_{EW} = 0$; a purely easterly wind of the same speed produces $V_{NS} = 0$, $U_{EW} = 20$. This transformation is applied to both the peak gust and the 9:00 AM wind observations, yielding four wind component features in total.\n\n---\n\n## Multicollinearity Diagnostics\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwrite_csv(df_final, \"data/df_engineered.csv\")\n\ndf_wo_location <- select_model_features(df_final, keep_location = FALSE)\nvif_results <- mc_check(df_wo_location)\n\nvif_results %>%\n  as_tibble() %>%\n  arrange(desc(VIF)) %>%\n  kable(\n    caption = \"Variance Inflation Factor (VIF) for Selected Predictors\",\n    digits = 3,\n    booktabs = TRUE\n  ) %>%\n  kable_styling(\n    bootstrap_options = c(\"striped\", \"hover\"),\n    full_width = FALSE,\n    latex_options = c(\"hold_position\")\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Variance Inflation Factor (VIF) for Selected Predictors</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Term </th>\n   <th style=\"text-align:right;\"> VIF </th>\n   <th style=\"text-align:right;\"> VIF_CI_low </th>\n   <th style=\"text-align:right;\"> VIF_CI_high </th>\n   <th style=\"text-align:right;\"> SE_factor </th>\n   <th style=\"text-align:right;\"> Tolerance </th>\n   <th style=\"text-align:right;\"> Tolerance_CI_low </th>\n   <th style=\"text-align:right;\"> Tolerance_CI_high </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> humidity3pm </td>\n   <td style=\"text-align:right;\"> 4.841 </td>\n   <td style=\"text-align:right;\"> 4.796 </td>\n   <td style=\"text-align:right;\"> 4.886 </td>\n   <td style=\"text-align:right;\"> 2.200 </td>\n   <td style=\"text-align:right;\"> 0.207 </td>\n   <td style=\"text-align:right;\"> 0.205 </td>\n   <td style=\"text-align:right;\"> 0.209 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> cloud9am_imp_flagged </td>\n   <td style=\"text-align:right;\"> 3.659 </td>\n   <td style=\"text-align:right;\"> 3.626 </td>\n   <td style=\"text-align:right;\"> 3.692 </td>\n   <td style=\"text-align:right;\"> 1.913 </td>\n   <td style=\"text-align:right;\"> 0.273 </td>\n   <td style=\"text-align:right;\"> 0.271 </td>\n   <td style=\"text-align:right;\"> 0.276 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> cloud3pm_imp_flagged </td>\n   <td style=\"text-align:right;\"> 3.525 </td>\n   <td style=\"text-align:right;\"> 3.494 </td>\n   <td style=\"text-align:right;\"> 3.557 </td>\n   <td style=\"text-align:right;\"> 1.878 </td>\n   <td style=\"text-align:right;\"> 0.284 </td>\n   <td style=\"text-align:right;\"> 0.281 </td>\n   <td style=\"text-align:right;\"> 0.286 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> evap_imp_flagged </td>\n   <td style=\"text-align:right;\"> 3.021 </td>\n   <td style=\"text-align:right;\"> 2.995 </td>\n   <td style=\"text-align:right;\"> 3.047 </td>\n   <td style=\"text-align:right;\"> 1.738 </td>\n   <td style=\"text-align:right;\"> 0.331 </td>\n   <td style=\"text-align:right;\"> 0.328 </td>\n   <td style=\"text-align:right;\"> 0.334 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> sunshine_imp_flagged </td>\n   <td style=\"text-align:right;\"> 2.916 </td>\n   <td style=\"text-align:right;\"> 2.891 </td>\n   <td style=\"text-align:right;\"> 2.941 </td>\n   <td style=\"text-align:right;\"> 1.708 </td>\n   <td style=\"text-align:right;\"> 0.343 </td>\n   <td style=\"text-align:right;\"> 0.340 </td>\n   <td style=\"text-align:right;\"> 0.346 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> humidity9am </td>\n   <td style=\"text-align:right;\"> 2.527 </td>\n   <td style=\"text-align:right;\"> 2.506 </td>\n   <td style=\"text-align:right;\"> 2.548 </td>\n   <td style=\"text-align:right;\"> 1.590 </td>\n   <td style=\"text-align:right;\"> 0.396 </td>\n   <td style=\"text-align:right;\"> 0.392 </td>\n   <td style=\"text-align:right;\"> 0.399 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> humidity_ma7 </td>\n   <td style=\"text-align:right;\"> 2.360 </td>\n   <td style=\"text-align:right;\"> 2.341 </td>\n   <td style=\"text-align:right;\"> 2.380 </td>\n   <td style=\"text-align:right;\"> 1.536 </td>\n   <td style=\"text-align:right;\"> 0.424 </td>\n   <td style=\"text-align:right;\"> 0.420 </td>\n   <td style=\"text-align:right;\"> 0.427 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dewpoint_9am </td>\n   <td style=\"text-align:right;\"> 2.138 </td>\n   <td style=\"text-align:right;\"> 2.121 </td>\n   <td style=\"text-align:right;\"> 2.155 </td>\n   <td style=\"text-align:right;\"> 1.462 </td>\n   <td style=\"text-align:right;\"> 0.468 </td>\n   <td style=\"text-align:right;\"> 0.464 </td>\n   <td style=\"text-align:right;\"> 0.471 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> instability_index </td>\n   <td style=\"text-align:right;\"> 2.045 </td>\n   <td style=\"text-align:right;\"> 2.029 </td>\n   <td style=\"text-align:right;\"> 2.062 </td>\n   <td style=\"text-align:right;\"> 1.430 </td>\n   <td style=\"text-align:right;\"> 0.489 </td>\n   <td style=\"text-align:right;\"> 0.485 </td>\n   <td style=\"text-align:right;\"> 0.493 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> sunshine </td>\n   <td style=\"text-align:right;\"> 2.034 </td>\n   <td style=\"text-align:right;\"> 2.019 </td>\n   <td style=\"text-align:right;\"> 2.051 </td>\n   <td style=\"text-align:right;\"> 1.426 </td>\n   <td style=\"text-align:right;\"> 0.492 </td>\n   <td style=\"text-align:right;\"> 0.488 </td>\n   <td style=\"text-align:right;\"> 0.495 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> day_cos </td>\n   <td style=\"text-align:right;\"> 1.917 </td>\n   <td style=\"text-align:right;\"> 1.903 </td>\n   <td style=\"text-align:right;\"> 1.932 </td>\n   <td style=\"text-align:right;\"> 1.385 </td>\n   <td style=\"text-align:right;\"> 0.522 </td>\n   <td style=\"text-align:right;\"> 0.518 </td>\n   <td style=\"text-align:right;\"> 0.526 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> evaporation </td>\n   <td style=\"text-align:right;\"> 1.825 </td>\n   <td style=\"text-align:right;\"> 1.811 </td>\n   <td style=\"text-align:right;\"> 1.839 </td>\n   <td style=\"text-align:right;\"> 1.351 </td>\n   <td style=\"text-align:right;\"> 0.548 </td>\n   <td style=\"text-align:right;\"> 0.544 </td>\n   <td style=\"text-align:right;\"> 0.552 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wind9am_U_EW </td>\n   <td style=\"text-align:right;\"> 1.627 </td>\n   <td style=\"text-align:right;\"> 1.615 </td>\n   <td style=\"text-align:right;\"> 1.639 </td>\n   <td style=\"text-align:right;\"> 1.275 </td>\n   <td style=\"text-align:right;\"> 0.615 </td>\n   <td style=\"text-align:right;\"> 0.610 </td>\n   <td style=\"text-align:right;\"> 0.619 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wind9am_V_NS </td>\n   <td style=\"text-align:right;\"> 1.625 </td>\n   <td style=\"text-align:right;\"> 1.614 </td>\n   <td style=\"text-align:right;\"> 1.637 </td>\n   <td style=\"text-align:right;\"> 1.275 </td>\n   <td style=\"text-align:right;\"> 0.615 </td>\n   <td style=\"text-align:right;\"> 0.611 </td>\n   <td style=\"text-align:right;\"> 0.620 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gust_V_NS </td>\n   <td style=\"text-align:right;\"> 1.619 </td>\n   <td style=\"text-align:right;\"> 1.607 </td>\n   <td style=\"text-align:right;\"> 1.630 </td>\n   <td style=\"text-align:right;\"> 1.272 </td>\n   <td style=\"text-align:right;\"> 0.618 </td>\n   <td style=\"text-align:right;\"> 0.613 </td>\n   <td style=\"text-align:right;\"> 0.622 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dewpoint_change </td>\n   <td style=\"text-align:right;\"> 1.605 </td>\n   <td style=\"text-align:right;\"> 1.594 </td>\n   <td style=\"text-align:right;\"> 1.617 </td>\n   <td style=\"text-align:right;\"> 1.267 </td>\n   <td style=\"text-align:right;\"> 0.623 </td>\n   <td style=\"text-align:right;\"> 0.619 </td>\n   <td style=\"text-align:right;\"> 0.627 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gust_U_EW </td>\n   <td style=\"text-align:right;\"> 1.600 </td>\n   <td style=\"text-align:right;\"> 1.588 </td>\n   <td style=\"text-align:right;\"> 1.611 </td>\n   <td style=\"text-align:right;\"> 1.265 </td>\n   <td style=\"text-align:right;\"> 0.625 </td>\n   <td style=\"text-align:right;\"> 0.621 </td>\n   <td style=\"text-align:right;\"> 0.630 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> rainfall_ma7 </td>\n   <td style=\"text-align:right;\"> 1.327 </td>\n   <td style=\"text-align:right;\"> 1.319 </td>\n   <td style=\"text-align:right;\"> 1.336 </td>\n   <td style=\"text-align:right;\"> 1.152 </td>\n   <td style=\"text-align:right;\"> 0.753 </td>\n   <td style=\"text-align:right;\"> 0.748 </td>\n   <td style=\"text-align:right;\"> 0.758 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pressure_change </td>\n   <td style=\"text-align:right;\"> 1.225 </td>\n   <td style=\"text-align:right;\"> 1.218 </td>\n   <td style=\"text-align:right;\"> 1.233 </td>\n   <td style=\"text-align:right;\"> 1.107 </td>\n   <td style=\"text-align:right;\"> 0.816 </td>\n   <td style=\"text-align:right;\"> 0.811 </td>\n   <td style=\"text-align:right;\"> 0.821 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> rain_yesterday </td>\n   <td style=\"text-align:right;\"> 1.186 </td>\n   <td style=\"text-align:right;\"> 1.179 </td>\n   <td style=\"text-align:right;\"> 1.194 </td>\n   <td style=\"text-align:right;\"> 1.089 </td>\n   <td style=\"text-align:right;\"> 0.843 </td>\n   <td style=\"text-align:right;\"> 0.838 </td>\n   <td style=\"text-align:right;\"> 0.848 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> sun_humid_interaction </td>\n   <td style=\"text-align:right;\"> 1.182 </td>\n   <td style=\"text-align:right;\"> 1.175 </td>\n   <td style=\"text-align:right;\"> 1.189 </td>\n   <td style=\"text-align:right;\"> 1.087 </td>\n   <td style=\"text-align:right;\"> 0.846 </td>\n   <td style=\"text-align:right;\"> 0.841 </td>\n   <td style=\"text-align:right;\"> 0.851 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> day_sin </td>\n   <td style=\"text-align:right;\"> 1.160 </td>\n   <td style=\"text-align:right;\"> 1.153 </td>\n   <td style=\"text-align:right;\"> 1.167 </td>\n   <td style=\"text-align:right;\"> 1.077 </td>\n   <td style=\"text-align:right;\"> 0.862 </td>\n   <td style=\"text-align:right;\"> 0.857 </td>\n   <td style=\"text-align:right;\"> 0.867 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> cloud_development </td>\n   <td style=\"text-align:right;\"> 1.046 </td>\n   <td style=\"text-align:right;\"> 1.041 </td>\n   <td style=\"text-align:right;\"> 1.052 </td>\n   <td style=\"text-align:right;\"> 1.023 </td>\n   <td style=\"text-align:right;\"> 0.956 </td>\n   <td style=\"text-align:right;\"> 0.951 </td>\n   <td style=\"text-align:right;\"> 0.961 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> days_since_rain </td>\n   <td style=\"text-align:right;\"> 1.032 </td>\n   <td style=\"text-align:right;\"> 1.027 </td>\n   <td style=\"text-align:right;\"> 1.038 </td>\n   <td style=\"text-align:right;\"> 1.016 </td>\n   <td style=\"text-align:right;\"> 0.969 </td>\n   <td style=\"text-align:right;\"> 0.963 </td>\n   <td style=\"text-align:right;\"> 0.973 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\ndf_scaled <- df_wo_location %>%\n  scale_data()\n\nwrite_csv(df_scaled, \"data/df_scaled.csv\")\n```\n:::\n\n\nFeature engineering that introduces interaction terms, composite indices, and temporal aggregates necessarily creates new correlational structure in the design matrix. After constructing the full feature set, it is essential to verify that no predictor has become so collinear with the others that its coefficient in a linear model would be effectively unidentifiable. We use the Variance Inflation Factor (VIF) for this diagnosis. The VIF for a given predictor quantifies how much its coefficient variance is inflated relative to what it would be in an orthogonal design: a VIF of $k$ indicates that the standard error of that coefficient is $\\sqrt{k}$ times larger than it would be if the predictor were uncorrelated with all others. Values above 10 are conventionally treated as indicating severe collinearity requiring remediation.\n\n**Cyclical and wind components.** The `day_sin`, `day_cos`, `gust_V_NS`, and `gust_U_EW` features all show VIF values well below 3. This confirms that the decomposition strategies, sine/cosine for the annual cycle and U/V projection for wind direction, successfully converted circular variables into continuous representations without introducing redundancy. Each component carries information that is approximately orthogonal to its pair.\n\n**Interaction stability.** The `sun_humid_interaction` term has a VIF of 1.182, which is exceptionally low for a multiplicative interaction. Without mean-centring the constituent variables before multiplication, interaction terms routinely exhibit VIFs above 10 due to their algebraic overlap with the main effects. The observed value of 1.182 provides empirical confirmation that centring eliminated this artificial correlation, and that the interaction term is capturing a genuinely distinct dimension of the feature space, the joint Rain Corner structure identified in @sec-bivariate-density.\n\n**Elevated collinearity in humidity.** The highest observed VIF is for `humidity3pm` at approximately 4.841. This is expected: humidity participates structurally in three of the derived features (`moisture_index`, `instability_index`, and `sun_humid_interaction`), and its 7-day moving average is also present in the feature set. A VIF of 5 lies below the conventional threshold of 10 for severe concern and is consistent with what the literature describes as moderate collinearity. The decision to retain `humidity3pm` despite this inflation is deliberate: it is the single strongest individual predictor of rainfall in the dataset (Spearman $r = 0.44$, as established in @sec-eda), and removing it in favour of its derived aggregates would sacrifice the direct same-day atmospheric moisture signal for the sake of a marginal improvement in collinearity. For tree-based models, this trade-off does not arise, since these methods are not sensitive to multicollinearity by design.\n\n**Overall assessment.** The full engineered feature set is numerically stable for use in linear model families. No VIF exceeds the critical threshold of 10, and the majority of features show values below 3. The pipeline has successfully converted the raw meteorological signals into a representation that is both physically interpretable and statistically well-conditioned for the modelling stage.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}