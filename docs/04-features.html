<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="A comprehensive statistical analysis of rainfall patterns across 49 Australian cities using Zero-Inflated Gamma GLMMs.">

<title>4&nbsp; Feature Engineering – Australian Rainfall Dynamics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05-modeling.html" rel="next">
<link href="./03-eda.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-9eae319670a971b7aedd265dafd44b4f.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-e66b50aa4120364bfa72329fe8653b98.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-9eae319670a971b7aedd265dafd44b4f.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c16d967f7cb0c9f8ebae126fb3a45419.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-463e05341c278a50bd9d8b9e5c352418.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-c16d967f7cb0c9f8ebae126fb3a45419.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-features.html">Feature Engineering</a></li><li class="breadcrumb-item"><a href="./04-features.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Feature Engineering</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Australian Rainfall Dynamics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Predicting Australian Rainfall</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-data-prep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Feature Engineering</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-features.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Feature Engineering</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Modelling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Modelling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Model Evaluation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-model-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Model Selection</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#from-raw-meteorological-signals-to-predictive-inputs" id="toc-from-raw-meteorological-signals-to-predictive-inputs" class="nav-link active" data-scroll-target="#from-raw-meteorological-signals-to-predictive-inputs"><span class="header-section-number">4.1</span> From Raw Meteorological Signals to Predictive Inputs</a></li>
  <li><a href="#signal-extraction-via-moving-averages" id="toc-signal-extraction-via-moving-averages" class="nav-link" data-scroll-target="#signal-extraction-via-moving-averages"><span class="header-section-number">4.2</span> Signal Extraction via Moving Averages</a>
  <ul class="collapse">
  <li><a href="#noise-reduction" id="toc-noise-reduction" class="nav-link" data-scroll-target="#noise-reduction"><span class="header-section-number">4.2.1</span> Noise Reduction</a></li>
  <li><a href="#multicollinearity-trade-off" id="toc-multicollinearity-trade-off" class="nav-link" data-scroll-target="#multicollinearity-trade-off"><span class="header-section-number">4.2.2</span> Multicollinearity Trade-off</a></li>
  </ul></li>
  <li><a href="#feature-engineering-pipeline" id="toc-feature-engineering-pipeline" class="nav-link" data-scroll-target="#feature-engineering-pipeline"><span class="header-section-number">4.3</span> Feature Engineering Pipeline</a>
  <ul class="collapse">
  <li><a href="#cyclical-encoding-of-seasonality" id="toc-cyclical-encoding-of-seasonality" class="nav-link" data-scroll-target="#cyclical-encoding-of-seasonality"><span class="header-section-number">4.3.1</span> Cyclical Encoding of Seasonality</a></li>
  <li><a href="#temporal-persistence-features" id="toc-temporal-persistence-features" class="nav-link" data-scroll-target="#temporal-persistence-features"><span class="header-section-number">4.3.2</span> Temporal Persistence Features</a></li>
  <li><a href="#physical-interaction-and-derived-indices" id="toc-physical-interaction-and-derived-indices" class="nav-link" data-scroll-target="#physical-interaction-and-derived-indices"><span class="header-section-number">4.3.3</span> Physical Interaction and Derived Indices</a></li>
  <li><a href="#circular-wind-vector-decomposition" id="toc-circular-wind-vector-decomposition" class="nav-link" data-scroll-target="#circular-wind-vector-decomposition"><span class="header-section-number">4.3.4</span> Circular Wind Vector Decomposition</a></li>
  </ul></li>
  <li><a href="#multicollinearity-diagnostics" id="toc-multicollinearity-diagnostics" class="nav-link" data-scroll-target="#multicollinearity-diagnostics"><span class="header-section-number">4.4</span> Multicollinearity Diagnostics</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models/blob/main/04-features.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-features.html">Feature Engineering</a></li><li class="breadcrumb-item"><a href="./04-features.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Feature Engineering</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-feature-eng" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Feature Engineering</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="from-raw-meteorological-signals-to-predictive-inputs" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="from-raw-meteorological-signals-to-predictive-inputs"><span class="header-section-number">4.1</span> From Raw Meteorological Signals to Predictive Inputs</h2>
<hr>
<blockquote class="blockquote">
<p><strong>Chapter Context.</strong> This chapter documents the feature engineering pipeline that bridges the exploratory analysis and the final model. Each design decision traces directly to an empirical finding from the EDA: the features constructed here are not ad hoc transformations but targeted responses to identified distributional and structural properties of the data.</p>
</blockquote>
<hr>
</section>
<section id="signal-extraction-via-moving-averages" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="signal-extraction-via-moving-averages"><span class="header-section-number">4.2</span> Signal Extraction via Moving Averages</h2>
<p>Daily meteorological observations are inherently noisy. A single day’s rainfall measurement reflects both the underlying weather regime and a high-frequency stochastic component, the difference between a storm cell passing directly over a station versus five kilometres to its east. Before engineering predictive features from this signal, we must first assess whether smoothing can reduce this noise and, if so, at what cost.</p>
<p>We compute rolling means over 3-day and 7-day trailing windows for both rainfall and afternoon humidity. Right-alignment is enforced throughout, meaning the average at time <span class="math inline">\(t\)</span> is computed from observations at <span class="math inline">\(t\)</span>, <span class="math inline">\(t-1\)</span>, …, <span class="math inline">\(t-(k-1)\)</span>. This is a necessary precaution against data leakage: any lookahead alignment would contaminate the training signal with future observations.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>ma_data <span class="ot">&lt;-</span> df_final <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="at">rainfall_ma3 =</span> <span class="fu">rollmean</span>(rainfall, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="at">rainfall_ma7 =</span> <span class="fu">rollmean</span>(rainfall, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="at">humidity_ma3 =</span> <span class="fu">rollmean</span>(humidity3pm, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb1-8"><a href="#cb1-8"></a>    <span class="at">humidity_ma7 =</span> <span class="fu">rollmean</span>(humidity3pm, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="fu">ungroup</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="noise-reduction" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="noise-reduction"><span class="header-section-number">4.2.1</span> Noise Reduction</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>p1_data <span class="ot">&lt;-</span> ma_data <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">filter</span>(rainfall <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">select</span>(rainfall, rainfall_ma3, rainfall_ma7) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="at">metric =</span> <span class="fu">factor</span>(</span>
<span id="cb2-8"><a href="#cb2-8"></a>      metric,</span>
<span id="cb2-9"><a href="#cb2-9"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"rainfall"</span>, <span class="st">"rainfall_ma3"</span>, <span class="st">"rainfall_ma7"</span>),</span>
<span id="cb2-10"><a href="#cb2-10"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Raw Daily"</span>, <span class="st">"3-Day MA"</span>, <span class="st">"7-Day MA"</span>)</span>
<span id="cb2-11"><a href="#cb2-11"></a>    )</span>
<span id="cb2-12"><a href="#cb2-12"></a>  )</span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="fu">ggplot</span>(p1_data, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> metric, <span class="at">color =</span> metric)) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">"b"</span>, <span class="at">color =</span> <span class="st">"grey60"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb2-18"><a href="#cb2-18"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb2-19"><a href="#cb2-19"></a>    <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">" mm"</span>),</span>
<span id="cb2-20"><a href="#cb2-20"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb2-21"><a href="#cb2-21"></a>  ) <span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb2-23"><a href="#cb2-23"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb2-24"><a href="#cb2-24"></a>      <span class="st">"Raw Daily"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>,</span>
<span id="cb2-25"><a href="#cb2-25"></a>      <span class="st">"3-Day MA"</span> <span class="ot">=</span> <span class="st">"#F77F00"</span>,</span>
<span id="cb2-26"><a href="#cb2-26"></a>      <span class="st">"7-Day MA"</span> <span class="ot">=</span> <span class="st">"#06A77D"</span></span>
<span id="cb2-27"><a href="#cb2-27"></a>    )</span>
<span id="cb2-28"><a href="#cb2-28"></a>  ) <span class="sc">+</span></span>
<span id="cb2-29"><a href="#cb2-29"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb2-30"><a href="#cb2-30"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb2-31"><a href="#cb2-31"></a>      <span class="st">"Raw Daily"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>,</span>
<span id="cb2-32"><a href="#cb2-32"></a>      <span class="st">"3-Day MA"</span> <span class="ot">=</span> <span class="st">"#F77F00"</span>,</span>
<span id="cb2-33"><a href="#cb2-33"></a>      <span class="st">"7-Day MA"</span> <span class="ot">=</span> <span class="st">"#06A77D"</span></span>
<span id="cb2-34"><a href="#cb2-34"></a>    )</span>
<span id="cb2-35"><a href="#cb2-35"></a>  ) <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-37"><a href="#cb2-37"></a>    <span class="at">title =</span> <span class="st">"Signal Extraction: Moving Averages Filter High-Frequency Noise"</span>,</span>
<span id="cb2-38"><a href="#cb2-38"></a>    <span class="at">subtitle =</span> <span class="st">"Raw rainfall (Red) exhibits high stochastic variance with extreme skew. The 7-Day Moving Average (Green)</span><span class="sc">\n</span><span class="st">acts as a low-pass filter, suppressing daily noise to reveal the central tendency of wet regimes."</span>,</span>
<span id="cb2-39"><a href="#cb2-39"></a>    <span class="at">x =</span> <span class="st">"Rainfall Intensity (Log Scale)"</span>,</span>
<span id="cb2-40"><a href="#cb2-40"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb2-41"><a href="#cb2-41"></a>    <span class="at">caption =</span> <span class="st">"Data: Log-transformed daily rainfall recordings"</span>,</span>
<span id="cb2-42"><a href="#cb2-42"></a>    <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb2-43"><a href="#cb2-43"></a>    <span class="at">color =</span> <span class="cn">NULL</span></span>
<span id="cb2-44"><a href="#cb2-44"></a>  ) <span class="sc">+</span></span>
<span id="cb2-45"><a href="#cb2-45"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb2-46"><a href="#cb2-46"></a>  <span class="fu">theme</span>(</span>
<span id="cb2-47"><a href="#cb2-47"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb2-48"><a href="#cb2-48"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-49"><a href="#cb2-49"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey90"</span>, <span class="at">size =</span> <span class="fl">0.3</span>),</span>
<span id="cb2-50"><a href="#cb2-50"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey90"</span>, <span class="at">size =</span> <span class="fl">0.3</span>),</span>
<span id="cb2-51"><a href="#cb2-51"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb2-52"><a href="#cb2-52"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb2-53"><a href="#cb2-53"></a>      <span class="at">color =</span> <span class="st">"grey30"</span>,</span>
<span id="cb2-54"><a href="#cb2-54"></a>      <span class="at">size =</span> <span class="dv">11</span>,</span>
<span id="cb2-55"><a href="#cb2-55"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>)</span>
<span id="cb2-56"><a href="#cb2-56"></a>    ),</span>
<span id="cb2-57"><a href="#cb2-57"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>))</span>
<span id="cb2-58"><a href="#cb2-58"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-signal-extraction" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-signal-extraction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-features_files/figure-html/fig-signal-extraction-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-signal-extraction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Signal Extraction: Moving Averages Filter High-Frequency Noise. The 7-Day Moving Average (Green) suppresses daily stochastic variance to reveal the central tendency of wet regimes.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>variance_data <span class="ot">&lt;-</span> ma_data <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">filter</span>(rainfall <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="at">Raw =</span> <span class="fu">sd</span>(rainfall, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="st">`</span><span class="at">3-Day MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sd</span>(rainfall_ma3, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="st">`</span><span class="at">7-Day MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sd</span>(rainfall_ma7, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"sd"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-10"><a href="#cb3-10"></a>    <span class="at">metric =</span> <span class="fu">factor</span>(metric, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Raw"</span>, <span class="st">"3-Day MA"</span>, <span class="st">"7-Day MA"</span>)),</span>
<span id="cb3-11"><a href="#cb3-11"></a>    <span class="at">variance_reduction =</span> (sd[<span class="dv">1</span>] <span class="sc">-</span> sd) <span class="sc">/</span> sd[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>  )</span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="fu">ggplot</span>(variance_data, <span class="fu">aes</span>(metric, sd, <span class="at">fill =</span> metric)) <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f mm</span><span class="sc">\n</span><span class="st">(%.0f%% reduction)"</span>, sd, variance_reduction)),</span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>,</span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb3-20"><a href="#cb3-20"></a>    <span class="at">size =</span> <span class="fl">4.5</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>  ) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb3-23"><a href="#cb3-23"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb3-24"><a href="#cb3-24"></a>      <span class="st">"Raw"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>,</span>
<span id="cb3-25"><a href="#cb3-25"></a>      <span class="st">"3-Day MA"</span> <span class="ot">=</span> <span class="st">"#F77F00"</span>,</span>
<span id="cb3-26"><a href="#cb3-26"></a>      <span class="st">"7-Day MA"</span> <span class="ot">=</span> <span class="st">"#06A77D"</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>    )</span>
<span id="cb3-28"><a href="#cb3-28"></a>  ) <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-30"><a href="#cb3-30"></a>    <span class="at">title =</span> <span class="st">"Variance Reduction by Moving Averages"</span>,</span>
<span id="cb3-31"><a href="#cb3-31"></a>    <span class="at">subtitle =</span> <span class="st">"Standard deviation decreases as window increases"</span>,</span>
<span id="cb3-32"><a href="#cb3-32"></a>    <span class="at">y =</span> <span class="st">"Standard Deviation (mm)"</span>,</span>
<span id="cb3-33"><a href="#cb3-33"></a>    <span class="at">x =</span> <span class="cn">NULL</span></span>
<span id="cb3-34"><a href="#cb3-34"></a>  ) <span class="sc">+</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-37"><a href="#cb3-37"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb3-38"><a href="#cb3-38"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb3-39"><a href="#cb3-39"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb3-40"><a href="#cb3-40"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-41"><a href="#cb3-41"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb3-42"><a href="#cb3-42"></a>  ) <span class="sc">+</span></span>
<span id="cb3-43"><a href="#cb3-43"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fu">max</span>(variance_data<span class="sc">$</span>sd) <span class="sc">*</span> <span class="fl">1.15</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-variance-reduction" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-variance-reduction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-features_files/figure-html/fig-variance-reduction-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-variance-reduction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: Variance Reduction by Window Size. Standard deviation falls substantially as the averaging window widens.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>ridge_data <span class="ot">&lt;-</span> ma_data <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">filter</span>(rainfall <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">select</span>(rainfall, rainfall_ma3, rainfall_ma7) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="at">metric =</span> <span class="fu">factor</span>(</span>
<span id="cb4-8"><a href="#cb4-8"></a>      metric,</span>
<span id="cb4-9"><a href="#cb4-9"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"rainfall_ma7"</span>, <span class="st">"rainfall_ma3"</span>, <span class="st">"rainfall"</span>),</span>
<span id="cb4-10"><a href="#cb4-10"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"7-Day MA"</span>, <span class="st">"3-Day MA"</span>, <span class="st">"Raw Daily"</span>)</span>
<span id="cb4-11"><a href="#cb4-11"></a>    )</span>
<span id="cb4-12"><a href="#cb4-12"></a>  )</span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="fu">ggplot</span>(ridge_data, <span class="fu">aes</span>(value, metric, <span class="at">fill =</span> metric)) <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>  <span class="fu">geom_density_ridges</span>(</span>
<span id="cb4-16"><a href="#cb4-16"></a>    <span class="at">alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb4-17"><a href="#cb4-17"></a>    <span class="at">scale =</span> <span class="fl">1.5</span>,</span>
<span id="cb4-18"><a href="#cb4-18"></a>    <span class="at">quantile_lines =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-19"><a href="#cb4-19"></a>    <span class="at">quantiles =</span> <span class="dv">2</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>  ) <span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb4-23"><a href="#cb4-23"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"5"</span>, <span class="st">"10"</span>, <span class="st">"25"</span>, <span class="st">"50"</span>, <span class="st">"100"</span>)</span>
<span id="cb4-24"><a href="#cb4-24"></a>  ) <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb4-26"><a href="#cb4-26"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb4-27"><a href="#cb4-27"></a>      <span class="st">"Raw Daily"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>,</span>
<span id="cb4-28"><a href="#cb4-28"></a>      <span class="st">"3-Day MA"</span> <span class="ot">=</span> <span class="st">"#F77F00"</span>,</span>
<span id="cb4-29"><a href="#cb4-29"></a>      <span class="st">"7-Day MA"</span> <span class="ot">=</span> <span class="st">"#06A77D"</span></span>
<span id="cb4-30"><a href="#cb4-30"></a>    )</span>
<span id="cb4-31"><a href="#cb4-31"></a>  ) <span class="sc">+</span></span>
<span id="cb4-32"><a href="#cb4-32"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-33"><a href="#cb4-33"></a>    <span class="at">title =</span> <span class="st">"Distribution Tightening with Moving Averages"</span>,</span>
<span id="cb4-34"><a href="#cb4-34"></a>    <span class="at">subtitle =</span> <span class="st">"Peaks become sharper and tails compress as window size increases"</span>,</span>
<span id="cb4-35"><a href="#cb4-35"></a>    <span class="at">x =</span> <span class="st">"Rainfall (mm, log scale)"</span>,</span>
<span id="cb4-36"><a href="#cb4-36"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb4-37"><a href="#cb4-37"></a>  ) <span class="sc">+</span></span>
<span id="cb4-38"><a href="#cb4-38"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb4-39"><a href="#cb4-39"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-40"><a href="#cb4-40"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-41"><a href="#cb4-41"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>)),</span>
<span id="cb4-42"><a href="#cb4-42"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb4-43"><a href="#cb4-43"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-44"><a href="#cb4-44"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-45"><a href="#cb4-45"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb4-46"><a href="#cb4-46"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-ma-ridgeline" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ma-ridgeline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-features_files/figure-html/fig-ma-ridgeline-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ma-ridgeline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: Distribution Tightening with Moving Averages. Peaks sharpen and tails compress as the averaging window increases.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The density plots in <a href="#fig-signal-extraction" class="quarto-xref">Figure&nbsp;<span>4.1</span></a> make the smoothing effect immediately apparent. The raw daily distribution (pink) is severely right-skewed with a long tail reaching into the hundreds of millimetres, a consequence of the extreme kurtosis documented in the <a href="03-eda.html" class="quarto-xref"><span>Chapter 3</span></a>. The 3-day moving average (orange) begins to suppress this variance, and the 7-day average (green) produces a substantially more concentrated distribution whose peak is considerably higher and whose tails are dramatically shorter.</p>
<p>Quantitatively (<a href="#fig-variance-reduction" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>), the standard deviation of rainfall intensity falls from 13.1 mm in the raw series to 5.8 mm under the 7-day average, a reduction of 56%. The ridgeline plot (<a href="#fig-ma-ridgeline" class="quarto-xref">Figure&nbsp;<span>4.3</span></a>) confirms that this compression is not an artefact of the summary statistic: the entire shape of the distribution tightens, with each additional day of averaging producing a distribution that is more peaked and less diffuse. The 7-day average can therefore be interpreted as a measure of the “weekly wetness regime”.A smoothed characterisation of whether the preceding week has been generally wet or generally dry rather than the unpredictability of any single day’s precipitation.</p>
</section>
<section id="multicollinearity-trade-off" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="multicollinearity-trade-off"><span class="header-section-number">4.2.2</span> Multicollinearity Trade-off</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>cor_data <span class="ot">&lt;-</span> ma_data <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">select</span>(</span>
<span id="cb5-3"><a href="#cb5-3"></a>    rainfall,</span>
<span id="cb5-4"><a href="#cb5-4"></a>    rainfall_ma3,</span>
<span id="cb5-5"><a href="#cb5-5"></a>    rainfall_ma7,</span>
<span id="cb5-6"><a href="#cb5-6"></a>    humidity3pm,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    humidity_ma3,</span>
<span id="cb5-8"><a href="#cb5-8"></a>    humidity_ma7</span>
<span id="cb5-9"><a href="#cb5-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>, <span class="at">method =</span> <span class="st">"spearman"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"var1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>var1, <span class="at">names_to =</span> <span class="st">"var2"</span>, <span class="at">values_to =</span> <span class="st">"correlation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-15"><a href="#cb5-15"></a>    <span class="at">var1 =</span> <span class="fu">factor</span>(</span>
<span id="cb5-16"><a href="#cb5-16"></a>      var1,</span>
<span id="cb5-17"><a href="#cb5-17"></a>      <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb5-18"><a href="#cb5-18"></a>        <span class="st">"rainfall"</span>,</span>
<span id="cb5-19"><a href="#cb5-19"></a>        <span class="st">"rainfall_ma3"</span>,</span>
<span id="cb5-20"><a href="#cb5-20"></a>        <span class="st">"rainfall_ma7"</span>,</span>
<span id="cb5-21"><a href="#cb5-21"></a>        <span class="st">"humidity3pm"</span>,</span>
<span id="cb5-22"><a href="#cb5-22"></a>        <span class="st">"humidity_ma3"</span>,</span>
<span id="cb5-23"><a href="#cb5-23"></a>        <span class="st">"humidity_ma7"</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>      )</span>
<span id="cb5-25"><a href="#cb5-25"></a>    ),</span>
<span id="cb5-26"><a href="#cb5-26"></a>    <span class="at">var2 =</span> <span class="fu">factor</span>(</span>
<span id="cb5-27"><a href="#cb5-27"></a>      var2,</span>
<span id="cb5-28"><a href="#cb5-28"></a>      <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb5-29"><a href="#cb5-29"></a>        <span class="st">"rainfall"</span>,</span>
<span id="cb5-30"><a href="#cb5-30"></a>        <span class="st">"rainfall_ma3"</span>,</span>
<span id="cb5-31"><a href="#cb5-31"></a>        <span class="st">"rainfall_ma7"</span>,</span>
<span id="cb5-32"><a href="#cb5-32"></a>        <span class="st">"humidity3pm"</span>,</span>
<span id="cb5-33"><a href="#cb5-33"></a>        <span class="st">"humidity_ma3"</span>,</span>
<span id="cb5-34"><a href="#cb5-34"></a>        <span class="st">"humidity_ma7"</span></span>
<span id="cb5-35"><a href="#cb5-35"></a>      )</span>
<span id="cb5-36"><a href="#cb5-36"></a>    )</span>
<span id="cb5-37"><a href="#cb5-37"></a>  )</span>
<span id="cb5-38"><a href="#cb5-38"></a></span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="fu">ggplot</span>(cor_data, <span class="fu">aes</span>(var2, var1, <span class="at">fill =</span> correlation)) <span class="sc">+</span></span>
<span id="cb5-40"><a href="#cb5-40"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-41"><a href="#cb5-41"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb5-42"><a href="#cb5-42"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, correlation)),</span>
<span id="cb5-43"><a href="#cb5-43"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb5-44"><a href="#cb5-44"></a>    <span class="at">size =</span> <span class="fl">3.5</span></span>
<span id="cb5-45"><a href="#cb5-45"></a>  ) <span class="sc">+</span></span>
<span id="cb5-46"><a href="#cb5-46"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb5-47"><a href="#cb5-47"></a>    <span class="at">low =</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb5-48"><a href="#cb5-48"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb5-49"><a href="#cb5-49"></a>    <span class="at">high =</span> <span class="st">"#D55E00"</span>,</span>
<span id="cb5-50"><a href="#cb5-50"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb5-51"><a href="#cb5-51"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb5-52"><a href="#cb5-52"></a>    <span class="at">name =</span> <span class="st">"Correlation"</span></span>
<span id="cb5-53"><a href="#cb5-53"></a>  ) <span class="sc">+</span></span>
<span id="cb5-54"><a href="#cb5-54"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-55"><a href="#cb5-55"></a>    <span class="at">title =</span> <span class="st">"Feature Correlations: Raw vs Moving Averages"</span>,</span>
<span id="cb5-56"><a href="#cb5-56"></a>    <span class="at">subtitle =</span> <span class="st">"MAs are highly correlated with each other (potential multicollinearity)"</span>,</span>
<span id="cb5-57"><a href="#cb5-57"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-58"><a href="#cb5-58"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb5-59"><a href="#cb5-59"></a>  ) <span class="sc">+</span></span>
<span id="cb5-60"><a href="#cb5-60"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb5-61"><a href="#cb5-61"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-62"><a href="#cb5-62"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb5-63"><a href="#cb5-63"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb5-64"><a href="#cb5-64"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb5-65"><a href="#cb5-65"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb5-66"><a href="#cb5-66"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb5-67"><a href="#cb5-67"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-ma-correlation" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ma-correlation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-features_files/figure-html/fig-ma-correlation-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ma-correlation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4: Feature Correlations: Raw vs Moving Averages. High correlations between MA features warn of multicollinearity risks for linear model families.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The noise-reduction benefit of moving averages comes at a cost. As shown in <a href="#fig-ma-correlation" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>, the 3-day and 7-day humidity moving averages share a Spearman correlation of 0.89, and the equivalent rainfall moving averages are similarly collinear with each other and with the raw series. Including multiple moving average windows alongside their source variables in the same linear model would produce a near-singular design matrix, inflating coefficient standard errors and making the model numerically unstable.</p>
<p>This presents a choice between responsiveness and stability. The 3-day average reacts more quickly to changing conditions but retains more of the day-to-day variability. The 7-day average is more stable but slower to reflect recent changes in the weather regime. For linear model families such as logistic regression, only one window can be safely retained per variable; including both is not viable. For tree-based models like Random Forest and Gradient Boosting, this constraint does not apply, since these methods select among correlated features at each split rather than inverting the full covariance matrix. The moving average selection strategy therefore depends on the model family, a consideration that informs the variable selection carried out in the subsequent modelling chapter.</p>
<hr>
</section>
</section>
<section id="feature-engineering-pipeline" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="feature-engineering-pipeline"><span class="header-section-number">4.3</span> Feature Engineering Pipeline</h2>
<p>The following pipeline implements the complete set of features motivated by the EDA. Each transformation is annotated to its originating empirical finding.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>compass_lookup <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="st">"N"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="st">"NNE"</span> <span class="ot">=</span> <span class="fl">22.5</span>,</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="st">"NE"</span> <span class="ot">=</span> <span class="dv">45</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="st">"ENE"</span> <span class="ot">=</span> <span class="fl">67.5</span>,</span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="st">"E"</span> <span class="ot">=</span> <span class="dv">90</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="st">"ESE"</span> <span class="ot">=</span> <span class="fl">112.5</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="st">"SE"</span> <span class="ot">=</span> <span class="dv">135</span>,</span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="st">"SSE"</span> <span class="ot">=</span> <span class="fl">157.5</span>,</span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="st">"S"</span> <span class="ot">=</span> <span class="dv">180</span>,</span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="st">"SSW"</span> <span class="ot">=</span> <span class="fl">202.5</span>,</span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="st">"SW"</span> <span class="ot">=</span> <span class="dv">225</span>,</span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="st">"WSW"</span> <span class="ot">=</span> <span class="fl">247.5</span>,</span>
<span id="cb6-14"><a href="#cb6-14"></a>  <span class="st">"W"</span> <span class="ot">=</span> <span class="dv">270</span>,</span>
<span id="cb6-15"><a href="#cb6-15"></a>  <span class="st">"WNW"</span> <span class="ot">=</span> <span class="fl">292.5</span>,</span>
<span id="cb6-16"><a href="#cb6-16"></a>  <span class="st">"NW"</span> <span class="ot">=</span> <span class="dv">315</span>,</span>
<span id="cb6-17"><a href="#cb6-17"></a>  <span class="st">"NNW"</span> <span class="ot">=</span> <span class="fl">337.5</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>)</span>
<span id="cb6-19"><a href="#cb6-19"></a></span>
<span id="cb6-20"><a href="#cb6-20"></a>df_final <span class="ot">&lt;-</span> df_final <span class="sc">%&gt;%</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>  <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="#cb6-22"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="#cb6-23"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-24"><a href="#cb6-24"></a>    <span class="co"># Lagging MA by 1 day ensures we predict 'Today' using only 'Yesterday's'</span></span>
<span id="cb6-25"><a href="#cb6-25"></a>    <span class="co"># trends to prevent data leakage</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>    <span class="at">rainfall_ma7 =</span> <span class="fu">lag</span>(</span>
<span id="cb6-27"><a href="#cb6-27"></a>      <span class="fu">rollmean</span>(rainfall, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb6-28"><a href="#cb6-28"></a>      <span class="at">n =</span> <span class="dv">1</span></span>
<span id="cb6-29"><a href="#cb6-29"></a>    ),</span>
<span id="cb6-30"><a href="#cb6-30"></a>    <span class="at">humidity_ma7 =</span> <span class="fu">lag</span>(</span>
<span id="cb6-31"><a href="#cb6-31"></a>      <span class="fu">rollmean</span>(humidity3pm, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb6-32"><a href="#cb6-32"></a>      <span class="dv">1</span></span>
<span id="cb6-33"><a href="#cb6-33"></a>    ),</span>
<span id="cb6-34"><a href="#cb6-34"></a></span>
<span id="cb6-35"><a href="#cb6-35"></a>    <span class="co"># Dry Spell Calculation</span></span>
<span id="cb6-36"><a href="#cb6-36"></a>    <span class="at">rain_event_id =</span> <span class="fu">cumsum</span>(<span class="fu">lag</span>(rainfall, <span class="dv">1</span>) <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb6-37"><a href="#cb6-37"></a>    <span class="at">days_since_rain =</span> <span class="fu">row_number</span>() <span class="sc">-</span> <span class="fu">match</span>(rain_event_id, rain_event_id),</span>
<span id="cb6-38"><a href="#cb6-38"></a></span>
<span id="cb6-39"><a href="#cb6-39"></a>    <span class="co"># Markov Chain State</span></span>
<span id="cb6-40"><a href="#cb6-40"></a>    <span class="at">rain_yesterday =</span> <span class="fu">lag</span>(rain_today, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb6-41"><a href="#cb6-41"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-42"><a href="#cb6-42"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-43"><a href="#cb6-43"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rain_yesterday), <span class="sc">!</span><span class="fu">is.na</span>(rainfall_ma7)) <span class="sc">%&gt;%</span></span>
<span id="cb6-44"><a href="#cb6-44"></a>  <span class="fu">select</span>(<span class="sc">-</span>rain_event_id) <span class="sc">%&gt;%</span></span>
<span id="cb6-45"><a href="#cb6-45"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-46"><a href="#cb6-46"></a>    <span class="co"># Cyclical Time Encoding</span></span>
<span id="cb6-47"><a href="#cb6-47"></a>    <span class="at">day_of_year =</span> <span class="fu">yday</span>(date),</span>
<span id="cb6-48"><a href="#cb6-48"></a>    <span class="at">day_sin =</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> day_of_year <span class="sc">/</span> <span class="dv">365</span>),</span>
<span id="cb6-49"><a href="#cb6-49"></a>    <span class="at">day_cos =</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> day_of_year <span class="sc">/</span> <span class="dv">365</span>),</span>
<span id="cb6-50"><a href="#cb6-50"></a></span>
<span id="cb6-51"><a href="#cb6-51"></a>    <span class="co"># Interaction Terms (The "Rain Corner")</span></span>
<span id="cb6-52"><a href="#cb6-52"></a>    <span class="at">sunshine =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(sunshine, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb6-53"><a href="#cb6-53"></a>    <span class="at">humidity3pm =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(humidity3pm, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb6-54"><a href="#cb6-54"></a>    <span class="at">sun_humid_interaction =</span> <span class="fu">as.numeric</span>(sunshine <span class="sc">*</span> humidity3pm),</span>
<span id="cb6-55"><a href="#cb6-55"></a></span>
<span id="cb6-56"><a href="#cb6-56"></a>    <span class="co"># Meteorological Indices</span></span>
<span id="cb6-57"><a href="#cb6-57"></a>    <span class="at">pressure_change =</span> pressure3pm <span class="sc">-</span> pressure9am,</span>
<span id="cb6-58"><a href="#cb6-58"></a>    <span class="at">dewpoint_9am =</span> temp9am <span class="sc">-</span> ((<span class="dv">100</span> <span class="sc">-</span> humidity9am) <span class="sc">/</span> <span class="dv">5</span>),</span>
<span id="cb6-59"><a href="#cb6-59"></a>    <span class="at">dewpoint_3pm =</span> temp3pm <span class="sc">-</span> ((<span class="dv">100</span> <span class="sc">-</span> humidity3pm) <span class="sc">/</span> <span class="dv">5</span>),</span>
<span id="cb6-60"><a href="#cb6-60"></a>    <span class="at">dewpoint_change =</span> dewpoint_3pm <span class="sc">-</span> dewpoint_9am,</span>
<span id="cb6-61"><a href="#cb6-61"></a>    <span class="at">moisture_index =</span> humidity3pm <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> sunshine <span class="sc">/</span> <span class="dv">15</span>),</span>
<span id="cb6-62"><a href="#cb6-62"></a>    <span class="at">instability_index =</span> (<span class="dv">1020</span> <span class="sc">-</span> pressure3pm) <span class="sc">*</span> humidity3pm <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb6-63"><a href="#cb6-63"></a>    <span class="at">cloud_development =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, cloud3pm <span class="sc">-</span> cloud9am),</span>
<span id="cb6-64"><a href="#cb6-64"></a></span>
<span id="cb6-65"><a href="#cb6-65"></a>    <span class="co"># Circular Wind Vector Decomposition</span></span>
<span id="cb6-66"><a href="#cb6-66"></a>    <span class="at">gust_rad =</span> compass_lookup[wind_gust_dir] <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>,</span>
<span id="cb6-67"><a href="#cb6-67"></a>    <span class="at">gust_V_NS =</span> wind_gust_speed <span class="sc">*</span> <span class="fu">cos</span>(gust_rad),</span>
<span id="cb6-68"><a href="#cb6-68"></a>    <span class="at">gust_U_EW =</span> wind_gust_speed <span class="sc">*</span> <span class="fu">sin</span>(gust_rad),</span>
<span id="cb6-69"><a href="#cb6-69"></a>    <span class="at">wind9am_rad =</span> compass_lookup[wind_dir9am] <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>,</span>
<span id="cb6-70"><a href="#cb6-70"></a>    <span class="at">wind9am_V_NS =</span> wind_speed9am <span class="sc">*</span> <span class="fu">cos</span>(wind9am_rad),</span>
<span id="cb6-71"><a href="#cb6-71"></a>    <span class="at">wind9am_U_EW =</span> wind_speed9am <span class="sc">*</span> <span class="fu">sin</span>(wind9am_rad)</span>
<span id="cb6-72"><a href="#cb6-72"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-73"><a href="#cb6-73"></a>  <span class="fu">relocate</span>(rain_today, date, location) <span class="sc">%&gt;%</span></span>
<span id="cb6-74"><a href="#cb6-74"></a>  <span class="fu">relocate</span>(rain_yesterday, days_since_rain, <span class="at">.after =</span> location) <span class="sc">%&gt;%</span></span>
<span id="cb6-75"><a href="#cb6-75"></a>  <span class="fu">relocate</span>(<span class="fu">ends_with</span>(<span class="st">"_ma7"</span>), <span class="at">.after =</span> days_since_rain) <span class="sc">%&gt;%</span></span>
<span id="cb6-76"><a href="#cb6-76"></a>  <span class="fu">relocate</span>(day_sin, day_cos, <span class="at">.after =</span> date)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The pipeline is organised into four conceptually distinct transformations, each addressing a specific structural property identified in the EDA.</p>
<section id="cyclical-encoding-of-seasonality" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="cyclical-encoding-of-seasonality"><span class="header-section-number">4.3.1</span> Cyclical Encoding of Seasonality</h3>
<p>The seasonal analysis established that rainfall frequency and intensity follow a smooth annual cycle: summer events are rarer but more intense, winter events are more frequent but lighter, and the transition months connect these poles continuously. Treating month as a standard integer (1 through 12) would incorrectly imply that January and December are maximally distant on the number line, when in reality they are climatologically adjacent. Treating it as an unordered factor imposes no such adjacency constraint but discards ordinal information entirely.</p>
<p>The appropriate solution is to represent the annual cycle as a point on the unit circle, decomposed into its sine and cosine components:</p>
<p><span class="math display">\[\text{day\_sin} = \sin\!\left(\frac{2\pi \cdot \text{day\_of\_year}}{365}\right), \quad \text{day\_cos} = \cos\!\left(\frac{2\pi \cdot \text{day\_of\_year}}{365}\right)\]</span></p>
<p>Together, these two features encode any day of the year as a unique coordinate on the unit circle. The distance between any two days in this space reflects their true circular proximity: the December-to-January transition corresponds to a small arc, not a large jump. The model can learn smooth seasonal effects directly from the geometry of this representation.</p>
</section>
<section id="temporal-persistence-features" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="temporal-persistence-features"><span class="header-section-number">4.3.2</span> Temporal Persistence Features</h3>
<p>The Markov Chain analysis (<a href="03-eda.html#sec-markov" class="quarto-xref"><span>Section 3.5.2</span></a>) demonstrated that the previous day’s rain state carries a moderate but meaningful signal (<span class="math inline">\(V \approx 0.31\)</span>), and the dry spell analysis showed that the probability of rain decays in a non-linear pattern as dry spells lengthen. Three features capture these dynamics.</p>
<p><code>rain_yesterday</code> is a direct binary indicator of the previous day’s state, encoding the first-order Markov transition directly as a predictor. <code>days_since_rain</code> counts the number of consecutive dry days preceding the current observation, capturing the progressive stabilisation of dry conditions that the logistic regression and spline analysis identified. <code>rainfall_ma7</code> and <code>humidity_ma7</code> provide a smoothed weekly context for both the rainfall and moisture signals, lagged by one additional day beyond the rolling window to ensure that no same-day information is included when predicting today’s outcome.</p>
<p>The lagging step deserves emphasis. Without it, the 7-day moving average at time <span class="math inline">\(t\)</span> includes the observation at time <span class="math inline">\(t\)</span> itself, meaning a model trained on this feature would have access to the value it is trying to predict. This form of data leakage produces artificially optimistic training metrics that do not generalise to deployment, where future observations are unavailable by definition.</p>
</section>
<section id="physical-interaction-and-derived-indices" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="physical-interaction-and-derived-indices"><span class="header-section-number">4.3.3</span> Physical Interaction and Derived Indices</h3>
<p>The bivariate density analysis (<a href="03-eda.html#sec-bivariate-density" class="quarto-xref"><span>Section 3.8</span></a>) identified a qualitative difference in the joint distribution of humidity and sunshine between rainy and dry days: rain occurs almost exclusively when afternoon humidity is high and sunshine hours are low simultaneously, the “Rain Corner” phenomenon. An additive model cannot represent this conditional structure; a multiplicative interaction term is required.</p>
<p>Prior to computing the interaction, both <code>sunshine</code> and <code>humidity3pm</code> are mean-centred (their grand means are subtracted). This is not merely a cosmetic step. When an interaction term is formed from un-centred variables, the resulting product is algebraically correlated with both main effects, inflating the VIF of all three terms and making their individual coefficients difficult to interpret. Centring removes this artificial correlation: the main effects then represent the effect of each variable at the average level of the other, and the interaction term represents the additional effect of their joint deviation. This is confirmed empirically in the VIF diagnostics in Section 3.</p>
<p>Beyond the interaction term, five derived meteorological indices are constructed from physically motivated combinations of the available variables. The dewpoint temperatures at 9:00 AM and 3:00 PM computed from the Magnus approximation <span class="math inline">\(T_d \approx T - \frac{100 - RH}{5}\)</span> represent the temperature at which the air would become saturated if cooled at constant pressure. The change in dewpoint across the day (<code>dewpoint_change</code>) measures whether the atmosphere is gaining or losing moisture over the course of the day, a signal not directly recoverable from temperature or humidity alone. The <code>moisture_index</code> encodes the combined effect of high humidity and limited solar exposure. The <code>instability_index</code> combines pressure deficit from the standard 1020 hPa baseline with humidity, approximating the atmospheric conditions that favour convective development. <code>cloud_development</code> captures upward cloud formation during the day, which the pressure analysis identified as a meaningful precursor to precipitation.</p>
</section>
<section id="circular-wind-vector-decomposition" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="circular-wind-vector-decomposition"><span class="header-section-number">4.3.4</span> Circular Wind Vector Decomposition</h3>
<p>Wind direction is a circular variable: 360 <span class="math inline">\(^\circ\)</span> and 0 <span class="math inline">\(^\circ\)</span> represent the same direction (due North), yet a naive numeric encoding would treat them as maximally distant. This misrepresentation is particularly consequential for wind because the directional origin of an air mass carries meaningful physical content, moisture-laden northerly flows behave very differently from dry southerly flows in the Australian context.</p>
<p>The standard solution is to decompose each directional reading into orthogonal Cartesian components by projecting the wind vector onto the north-south and east-west axes:</p>
<p><span class="math display">\[U_{EW} = v \cdot \sin(\theta), \quad V_{NS} = v \cdot \cos(\theta)\]</span></p>
<p>where <span class="math inline">\(v\)</span> is wind speed (in km/h) and <span class="math inline">\(\theta\)</span> is the compass bearing in radians. The resulting U and V components are continuous and interpretable: a purely northerly wind of 20 km/h produces <span class="math inline">\(V_{NS} = 20\)</span>, <span class="math inline">\(U_{EW} = 0\)</span>; a purely easterly wind of the same speed produces <span class="math inline">\(V_{NS} = 0\)</span>, <span class="math inline">\(U_{EW} = 20\)</span>. This transformation is applied to both the peak gust and the 9:00 AM wind observations, yielding four wind component features in total.</p>
<hr>
</section>
</section>
<section id="multicollinearity-diagnostics" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="multicollinearity-diagnostics"><span class="header-section-number">4.4</span> Multicollinearity Diagnostics</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">write_csv</span>(df_final, <span class="st">"data/df_engineered.csv"</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>df_wo_location <span class="ot">&lt;-</span> <span class="fu">select_model_features</span>(df_final, <span class="at">keep_location =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a>vif_results <span class="ot">&lt;-</span> <span class="fu">mc_check</span>(df_wo_location)</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a>vif_results <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(VIF)) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="fu">kable</span>(</span>
<span id="cb7-11"><a href="#cb7-11"></a>    <span class="at">caption =</span> <span class="st">"Variance Inflation Factor (VIF) for Selected Predictors"</span>,</span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Variance Inflation Factor (VIF) for Selected Predictors</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VIF</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VIF_CI_low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VIF_CI_high</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE_factor</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tolerance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tolerance_CI_low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tolerance_CI_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">humidity3pm</td>
<td style="text-align: right;">4.728</td>
<td style="text-align: right;">4.684</td>
<td style="text-align: right;">4.772</td>
<td style="text-align: right;">2.174</td>
<td style="text-align: right;">0.211</td>
<td style="text-align: right;">0.210</td>
<td style="text-align: right;">0.213</td>
</tr>
<tr class="even">
<td style="text-align: left;">humidity9am</td>
<td style="text-align: right;">2.589</td>
<td style="text-align: right;">2.567</td>
<td style="text-align: right;">2.611</td>
<td style="text-align: right;">1.609</td>
<td style="text-align: right;">0.386</td>
<td style="text-align: right;">0.383</td>
<td style="text-align: right;">0.390</td>
</tr>
<tr class="odd">
<td style="text-align: left;">humidity_ma7</td>
<td style="text-align: right;">2.334</td>
<td style="text-align: right;">2.315</td>
<td style="text-align: right;">2.354</td>
<td style="text-align: right;">1.528</td>
<td style="text-align: right;">0.428</td>
<td style="text-align: right;">0.425</td>
<td style="text-align: right;">0.432</td>
</tr>
<tr class="even">
<td style="text-align: left;">dewpoint_9am</td>
<td style="text-align: right;">2.150</td>
<td style="text-align: right;">2.133</td>
<td style="text-align: right;">2.167</td>
<td style="text-align: right;">1.466</td>
<td style="text-align: right;">0.465</td>
<td style="text-align: right;">0.461</td>
<td style="text-align: right;">0.469</td>
</tr>
<tr class="odd">
<td style="text-align: left;">instability_index</td>
<td style="text-align: right;">2.076</td>
<td style="text-align: right;">2.060</td>
<td style="text-align: right;">2.092</td>
<td style="text-align: right;">1.441</td>
<td style="text-align: right;">0.482</td>
<td style="text-align: right;">0.478</td>
<td style="text-align: right;">0.486</td>
</tr>
<tr class="even">
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">1.918</td>
<td style="text-align: right;">1.904</td>
<td style="text-align: right;">1.933</td>
<td style="text-align: right;">1.385</td>
<td style="text-align: right;">0.521</td>
<td style="text-align: right;">0.517</td>
<td style="text-align: right;">0.525</td>
</tr>
<tr class="odd">
<td style="text-align: left;">day_cos</td>
<td style="text-align: right;">1.868</td>
<td style="text-align: right;">1.854</td>
<td style="text-align: right;">1.882</td>
<td style="text-align: right;">1.367</td>
<td style="text-align: right;">0.535</td>
<td style="text-align: right;">0.531</td>
<td style="text-align: right;">0.539</td>
</tr>
<tr class="even">
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">1.786</td>
<td style="text-align: right;">1.773</td>
<td style="text-align: right;">1.800</td>
<td style="text-align: right;">1.336</td>
<td style="text-align: right;">0.560</td>
<td style="text-align: right;">0.556</td>
<td style="text-align: right;">0.564</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dewpoint_change</td>
<td style="text-align: right;">1.762</td>
<td style="text-align: right;">1.749</td>
<td style="text-align: right;">1.775</td>
<td style="text-align: right;">1.327</td>
<td style="text-align: right;">0.567</td>
<td style="text-align: right;">0.563</td>
<td style="text-align: right;">0.572</td>
</tr>
<tr class="even">
<td style="text-align: left;">wind9am_U_EW</td>
<td style="text-align: right;">1.642</td>
<td style="text-align: right;">1.630</td>
<td style="text-align: right;">1.654</td>
<td style="text-align: right;">1.281</td>
<td style="text-align: right;">0.609</td>
<td style="text-align: right;">0.605</td>
<td style="text-align: right;">0.613</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wind9am_V_NS</td>
<td style="text-align: right;">1.639</td>
<td style="text-align: right;">1.627</td>
<td style="text-align: right;">1.651</td>
<td style="text-align: right;">1.280</td>
<td style="text-align: right;">0.610</td>
<td style="text-align: right;">0.606</td>
<td style="text-align: right;">0.614</td>
</tr>
<tr class="even">
<td style="text-align: left;">gust_V_NS</td>
<td style="text-align: right;">1.629</td>
<td style="text-align: right;">1.618</td>
<td style="text-align: right;">1.641</td>
<td style="text-align: right;">1.277</td>
<td style="text-align: right;">0.614</td>
<td style="text-align: right;">0.609</td>
<td style="text-align: right;">0.618</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gust_U_EW</td>
<td style="text-align: right;">1.614</td>
<td style="text-align: right;">1.602</td>
<td style="text-align: right;">1.626</td>
<td style="text-align: right;">1.270</td>
<td style="text-align: right;">0.620</td>
<td style="text-align: right;">0.615</td>
<td style="text-align: right;">0.624</td>
</tr>
<tr class="even">
<td style="text-align: left;">rainfall_ma7</td>
<td style="text-align: right;">1.327</td>
<td style="text-align: right;">1.318</td>
<td style="text-align: right;">1.336</td>
<td style="text-align: right;">1.152</td>
<td style="text-align: right;">0.754</td>
<td style="text-align: right;">0.749</td>
<td style="text-align: right;">0.758</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sun_humid_interaction</td>
<td style="text-align: right;">1.185</td>
<td style="text-align: right;">1.178</td>
<td style="text-align: right;">1.192</td>
<td style="text-align: right;">1.089</td>
<td style="text-align: right;">0.844</td>
<td style="text-align: right;">0.839</td>
<td style="text-align: right;">0.849</td>
</tr>
<tr class="even">
<td style="text-align: left;">rain_yesterday</td>
<td style="text-align: right;">1.183</td>
<td style="text-align: right;">1.176</td>
<td style="text-align: right;">1.190</td>
<td style="text-align: right;">1.088</td>
<td style="text-align: right;">0.845</td>
<td style="text-align: right;">0.840</td>
<td style="text-align: right;">0.850</td>
</tr>
<tr class="odd">
<td style="text-align: left;">day_sin</td>
<td style="text-align: right;">1.161</td>
<td style="text-align: right;">1.154</td>
<td style="text-align: right;">1.168</td>
<td style="text-align: right;">1.077</td>
<td style="text-align: right;">0.862</td>
<td style="text-align: right;">0.856</td>
<td style="text-align: right;">0.867</td>
</tr>
<tr class="even">
<td style="text-align: left;">pressure_change</td>
<td style="text-align: right;">1.110</td>
<td style="text-align: right;">1.104</td>
<td style="text-align: right;">1.117</td>
<td style="text-align: right;">1.054</td>
<td style="text-align: right;">0.901</td>
<td style="text-align: right;">0.896</td>
<td style="text-align: right;">0.906</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cloud_development</td>
<td style="text-align: right;">1.032</td>
<td style="text-align: right;">1.026</td>
<td style="text-align: right;">1.038</td>
<td style="text-align: right;">1.016</td>
<td style="text-align: right;">0.969</td>
<td style="text-align: right;">0.964</td>
<td style="text-align: right;">0.974</td>
</tr>
<tr class="even">
<td style="text-align: left;">days_since_rain</td>
<td style="text-align: right;">1.004</td>
<td style="text-align: right;">1.001</td>
<td style="text-align: right;">1.015</td>
<td style="text-align: right;">1.002</td>
<td style="text-align: right;">0.996</td>
<td style="text-align: right;">0.986</td>
<td style="text-align: right;">0.999</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>df_scaled <span class="ot">&lt;-</span> df_wo_location <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">scale_data</span>()</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">write_csv</span>(df_scaled, <span class="st">"data/df_scaled.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Feature engineering that introduces interaction terms, composite indices, and temporal aggregates necessarily creates new correlational structure in the design matrix. After constructing the full feature set, it is therefore essential to verify that no predictor has become so collinear with the others that its coefficient in a linear model would be effectively unidentifiable. We use the Variance Inflation Factor (VIF) for this diagnosis. The VIF for a given predictor quantifies how much its coefficient variance is inflated relative to what it would be in an orthogonal design: a VIF of <span class="math inline">\(k\)</span> indicates that the standard error of that coefficient is <span class="math inline">\(\sqrt{k}\)</span> times larger than it would be if the predictor were uncorrelated with all others. Values above 10 are conventionally treated as indicating severe collinearity requiring remediation.</p>
<p><strong>Cyclical and wind components.</strong> The <code>day_sin</code>, <code>day_cos</code>, <code>gust_V_NS</code>, and <code>gust_U_EW</code> features all show VIF values well below 3. This confirms that the decomposition strategies, sine/cosine for the annual cycle and U/V projection for wind direction, successfully converted circular variables into continuous representations without introducing redundancy. Each component carries information that is approximately orthogonal to its pair.</p>
<p><strong>Interaction stability.</strong> The <code>sun_humid_interaction</code> term has a VIF of 1.188, which is exceptionally low for a multiplicative interaction. Without mean-centring the constituent variables before multiplication, interaction terms routinely exhibit VIFs above 10 due to their algebraic overlap with the main effects. The observed value of 1.188 provides empirical confirmation that centring eliminated this artificial correlation, and that the interaction term is capturing a genuinely distinct dimension of the feature space, the joint “Rain Corner” structure identified in the EDA.</p>
<p><strong>Elevated collinearity in humidity.</strong> The highest observed VIF is for <code>humidity3pm</code> at approximately 4.832. This is expected: humidity participates structurally in three of the derived features (<code>moisture_index</code>, <code>instability_index</code>, and <code>sun_humid_interaction</code>), and its 7-day moving average is also present in the feature set. A VIF of 5 lies below the conventional threshold of 10 for severe concern and is consistent with what the literature describes as moderate collinearity. The decision to retain <code>humidity3pm</code> despite this inflation is deliberate: it is the single strongest individual predictor of rainfall in the dataset (Spearman <span class="math inline">\(r = 0.44\)</span>, as established in the <a href="03-eda.html" class="quarto-xref"><span>Chapter 3</span></a>), and removing it in favour of its derived aggregates would sacrifice the direct same-day atmospheric moisture signal for the sake of a marginal improvement in collinearity. For tree-based models, this trade-off does not arise, since these methods are not sensitive to multicollinearity by design.</p>
<p><strong>Overall assessment.</strong> The full engineered feature set is numerically stable for use in linear model families. No VIF exceeds the critical threshold of 10, and the majority of features show values below 3. The pipeline has successfully converted the raw meteorological signals into a representation that is both physically interpretable and statistically well-conditioned for the modelling stage.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03-eda.html" class="pagination-link" aria-label="Exploratory Data Analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05-modeling.html" class="pagination-link" aria-label="Modelling">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Modelling</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu"># Feature Engineering {#sec-feature-eng}</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">## From Raw Meteorological Signals to Predictive Inputs</span></span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a>---</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="at">&gt; **Chapter Context.** This chapter documents the feature engineering pipeline that bridges the exploratory analysis and the final model. Each design decision traces directly to an empirical finding from the EDA: the features constructed here are not ad hoc transformations but targeted responses to identified distributional and structural properties of the data.</span></span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>---</span>
<span id="cb9-9"><a href="#cb9-9"></a></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="fu">## Signal Extraction via Moving Averages</span></span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a>Daily meteorological observations are inherently noisy. A single day's rainfall measurement reflects both the underlying weather regime and a high-frequency stochastic component, the difference between a storm cell passing directly over a station versus five kilometres to its east. Before engineering predictive features from this signal, we must first assess whether smoothing can reduce this noise and, if so, at what cost.</span>
<span id="cb9-13"><a href="#cb9-13"></a></span>
<span id="cb9-14"><a href="#cb9-14"></a>We compute rolling means over 3-day and 7-day trailing windows for both rainfall and afternoon humidity. Right-alignment is enforced throughout, meaning the average at time $t$ is computed from observations at $t$, $t-1$, ..., $t-(k-1)$. This is a necessary precaution against data leakage: any lookahead alignment would contaminate the training signal with future observations.</span>
<span id="cb9-15"><a href="#cb9-15"></a></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="in">```{r}</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co">#| label: setup-features</span></span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co">#| include: false</span></span>
<span id="cb9-21"><a href="#cb9-21"></a></span>
<span id="cb9-22"><a href="#cb9-22"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb9-23"><a href="#cb9-23"></a>  tidyverse,</span>
<span id="cb9-24"><a href="#cb9-24"></a>  zoo,</span>
<span id="cb9-25"><a href="#cb9-25"></a>  ggridges,</span>
<span id="cb9-26"><a href="#cb9-26"></a>  scales,</span>
<span id="cb9-27"><a href="#cb9-27"></a>  kableExtra,</span>
<span id="cb9-28"><a href="#cb9-28"></a>  performance,</span>
<span id="cb9-29"><a href="#cb9-29"></a>  here</span>
<span id="cb9-30"><a href="#cb9-30"></a>)</span>
<span id="cb9-31"><a href="#cb9-31"></a></span>
<span id="cb9-32"><a href="#cb9-32"></a></span>
<span id="cb9-33"><a href="#cb9-33"></a>df_final <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/df_final.csv"</span>)</span>
<span id="cb9-34"><a href="#cb9-34"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"utils.R"</span>))</span>
<span id="cb9-35"><a href="#cb9-35"></a><span class="in">```</span></span>
<span id="cb9-36"><a href="#cb9-36"></a></span>
<span id="cb9-37"><a href="#cb9-37"></a></span>
<span id="cb9-40"><a href="#cb9-40"></a><span class="in">```{r}</span></span>
<span id="cb9-41"><a href="#cb9-41"></a><span class="co">#| label: ma-feature-engineering</span></span>
<span id="cb9-42"><a href="#cb9-42"></a><span class="co">#| echo: true</span></span>
<span id="cb9-43"><a href="#cb9-43"></a><span class="co">#| message: false</span></span>
<span id="cb9-44"><a href="#cb9-44"></a></span>
<span id="cb9-45"><a href="#cb9-45"></a>ma_data <span class="ot">&lt;-</span> df_final <span class="sc">%&gt;%</span></span>
<span id="cb9-46"><a href="#cb9-46"></a>  <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb9-47"><a href="#cb9-47"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb9-48"><a href="#cb9-48"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-49"><a href="#cb9-49"></a>    <span class="at">rainfall_ma3 =</span> <span class="fu">rollmean</span>(rainfall, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb9-50"><a href="#cb9-50"></a>    <span class="at">rainfall_ma7 =</span> <span class="fu">rollmean</span>(rainfall, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb9-51"><a href="#cb9-51"></a>    <span class="at">humidity_ma3 =</span> <span class="fu">rollmean</span>(humidity3pm, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb9-52"><a href="#cb9-52"></a>    <span class="at">humidity_ma7 =</span> <span class="fu">rollmean</span>(humidity3pm, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>)</span>
<span id="cb9-53"><a href="#cb9-53"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-54"><a href="#cb9-54"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb9-55"><a href="#cb9-55"></a><span class="in">```</span></span>
<span id="cb9-56"><a href="#cb9-56"></a></span>
<span id="cb9-57"><a href="#cb9-57"></a><span class="fu">### Noise Reduction</span></span>
<span id="cb9-58"><a href="#cb9-58"></a></span>
<span id="cb9-61"><a href="#cb9-61"></a><span class="in">```{r}</span></span>
<span id="cb9-62"><a href="#cb9-62"></a><span class="co">#| label: fig-signal-extraction</span></span>
<span id="cb9-63"><a href="#cb9-63"></a><span class="co">#| fig-cap: "Signal Extraction: Moving Averages Filter High-Frequency Noise. The 7-Day Moving Average (Green) suppresses daily stochastic variance to reveal the central tendency of wet regimes."</span></span>
<span id="cb9-64"><a href="#cb9-64"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb9-65"><a href="#cb9-65"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb9-66"><a href="#cb9-66"></a><span class="co">#| echo: true</span></span>
<span id="cb9-67"><a href="#cb9-67"></a><span class="co">#| warning: false</span></span>
<span id="cb9-68"><a href="#cb9-68"></a></span>
<span id="cb9-69"><a href="#cb9-69"></a>p1_data <span class="ot">&lt;-</span> ma_data <span class="sc">%&gt;%</span></span>
<span id="cb9-70"><a href="#cb9-70"></a>  <span class="fu">filter</span>(rainfall <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-71"><a href="#cb9-71"></a>  <span class="fu">select</span>(rainfall, rainfall_ma3, rainfall_ma7) <span class="sc">%&gt;%</span></span>
<span id="cb9-72"><a href="#cb9-72"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-73"><a href="#cb9-73"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb9-74"><a href="#cb9-74"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-75"><a href="#cb9-75"></a>    <span class="at">metric =</span> <span class="fu">factor</span>(</span>
<span id="cb9-76"><a href="#cb9-76"></a>      metric,</span>
<span id="cb9-77"><a href="#cb9-77"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"rainfall"</span>, <span class="st">"rainfall_ma3"</span>, <span class="st">"rainfall_ma7"</span>),</span>
<span id="cb9-78"><a href="#cb9-78"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Raw Daily"</span>, <span class="st">"3-Day MA"</span>, <span class="st">"7-Day MA"</span>)</span>
<span id="cb9-79"><a href="#cb9-79"></a>    )</span>
<span id="cb9-80"><a href="#cb9-80"></a>  )</span>
<span id="cb9-81"><a href="#cb9-81"></a></span>
<span id="cb9-82"><a href="#cb9-82"></a><span class="fu">ggplot</span>(p1_data, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> metric, <span class="at">color =</span> metric)) <span class="sc">+</span></span>
<span id="cb9-83"><a href="#cb9-83"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-84"><a href="#cb9-84"></a>  <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">"b"</span>, <span class="at">color =</span> <span class="st">"grey60"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb9-85"><a href="#cb9-85"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb9-86"><a href="#cb9-86"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb9-87"><a href="#cb9-87"></a>    <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">" mm"</span>),</span>
<span id="cb9-88"><a href="#cb9-88"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb9-89"><a href="#cb9-89"></a>  ) <span class="sc">+</span></span>
<span id="cb9-90"><a href="#cb9-90"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb9-91"><a href="#cb9-91"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb9-92"><a href="#cb9-92"></a>      <span class="st">"Raw Daily"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>,</span>
<span id="cb9-93"><a href="#cb9-93"></a>      <span class="st">"3-Day MA"</span> <span class="ot">=</span> <span class="st">"#F77F00"</span>,</span>
<span id="cb9-94"><a href="#cb9-94"></a>      <span class="st">"7-Day MA"</span> <span class="ot">=</span> <span class="st">"#06A77D"</span></span>
<span id="cb9-95"><a href="#cb9-95"></a>    )</span>
<span id="cb9-96"><a href="#cb9-96"></a>  ) <span class="sc">+</span></span>
<span id="cb9-97"><a href="#cb9-97"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb9-98"><a href="#cb9-98"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb9-99"><a href="#cb9-99"></a>      <span class="st">"Raw Daily"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>,</span>
<span id="cb9-100"><a href="#cb9-100"></a>      <span class="st">"3-Day MA"</span> <span class="ot">=</span> <span class="st">"#F77F00"</span>,</span>
<span id="cb9-101"><a href="#cb9-101"></a>      <span class="st">"7-Day MA"</span> <span class="ot">=</span> <span class="st">"#06A77D"</span></span>
<span id="cb9-102"><a href="#cb9-102"></a>    )</span>
<span id="cb9-103"><a href="#cb9-103"></a>  ) <span class="sc">+</span></span>
<span id="cb9-104"><a href="#cb9-104"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-105"><a href="#cb9-105"></a>    <span class="at">title =</span> <span class="st">"Signal Extraction: Moving Averages Filter High-Frequency Noise"</span>,</span>
<span id="cb9-106"><a href="#cb9-106"></a>    <span class="at">subtitle =</span> <span class="st">"Raw rainfall (Red) exhibits high stochastic variance with extreme skew. The 7-Day Moving Average (Green)</span><span class="sc">\n</span><span class="st">acts as a low-pass filter, suppressing daily noise to reveal the central tendency of wet regimes."</span>,</span>
<span id="cb9-107"><a href="#cb9-107"></a>    <span class="at">x =</span> <span class="st">"Rainfall Intensity (Log Scale)"</span>,</span>
<span id="cb9-108"><a href="#cb9-108"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb9-109"><a href="#cb9-109"></a>    <span class="at">caption =</span> <span class="st">"Data: Log-transformed daily rainfall recordings"</span>,</span>
<span id="cb9-110"><a href="#cb9-110"></a>    <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-111"><a href="#cb9-111"></a>    <span class="at">color =</span> <span class="cn">NULL</span></span>
<span id="cb9-112"><a href="#cb9-112"></a>  ) <span class="sc">+</span></span>
<span id="cb9-113"><a href="#cb9-113"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb9-114"><a href="#cb9-114"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-115"><a href="#cb9-115"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb9-116"><a href="#cb9-116"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-117"><a href="#cb9-117"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey90"</span>, <span class="at">size =</span> <span class="fl">0.3</span>),</span>
<span id="cb9-118"><a href="#cb9-118"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey90"</span>, <span class="at">size =</span> <span class="fl">0.3</span>),</span>
<span id="cb9-119"><a href="#cb9-119"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb9-120"><a href="#cb9-120"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb9-121"><a href="#cb9-121"></a>      <span class="at">color =</span> <span class="st">"grey30"</span>,</span>
<span id="cb9-122"><a href="#cb9-122"></a>      <span class="at">size =</span> <span class="dv">11</span>,</span>
<span id="cb9-123"><a href="#cb9-123"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>)</span>
<span id="cb9-124"><a href="#cb9-124"></a>    ),</span>
<span id="cb9-125"><a href="#cb9-125"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>))</span>
<span id="cb9-126"><a href="#cb9-126"></a>  )</span>
<span id="cb9-127"><a href="#cb9-127"></a><span class="in">```</span></span>
<span id="cb9-128"><a href="#cb9-128"></a></span>
<span id="cb9-131"><a href="#cb9-131"></a><span class="in">```{r}</span></span>
<span id="cb9-132"><a href="#cb9-132"></a><span class="co">#| label: fig-variance-reduction</span></span>
<span id="cb9-133"><a href="#cb9-133"></a><span class="co">#| fig-cap: "Variance Reduction by Window Size. Standard deviation falls substantially as the averaging window widens."</span></span>
<span id="cb9-134"><a href="#cb9-134"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb9-135"><a href="#cb9-135"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb9-136"><a href="#cb9-136"></a><span class="co">#| echo: true</span></span>
<span id="cb9-137"><a href="#cb9-137"></a><span class="co">#| warning: false</span></span>
<span id="cb9-138"><a href="#cb9-138"></a></span>
<span id="cb9-139"><a href="#cb9-139"></a>variance_data <span class="ot">&lt;-</span> ma_data <span class="sc">%&gt;%</span></span>
<span id="cb9-140"><a href="#cb9-140"></a>  <span class="fu">filter</span>(rainfall <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-141"><a href="#cb9-141"></a>  <span class="fu">summarise</span>(</span>
<span id="cb9-142"><a href="#cb9-142"></a>    <span class="at">Raw =</span> <span class="fu">sd</span>(rainfall, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-143"><a href="#cb9-143"></a>    <span class="st">`</span><span class="at">3-Day MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sd</span>(rainfall_ma3, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-144"><a href="#cb9-144"></a>    <span class="st">`</span><span class="at">7-Day MA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sd</span>(rainfall_ma7, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-145"><a href="#cb9-145"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-146"><a href="#cb9-146"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"sd"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-147"><a href="#cb9-147"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-148"><a href="#cb9-148"></a>    <span class="at">metric =</span> <span class="fu">factor</span>(metric, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Raw"</span>, <span class="st">"3-Day MA"</span>, <span class="st">"7-Day MA"</span>)),</span>
<span id="cb9-149"><a href="#cb9-149"></a>    <span class="at">variance_reduction =</span> (sd[<span class="dv">1</span>] <span class="sc">-</span> sd) <span class="sc">/</span> sd[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb9-150"><a href="#cb9-150"></a>  )</span>
<span id="cb9-151"><a href="#cb9-151"></a></span>
<span id="cb9-152"><a href="#cb9-152"></a><span class="fu">ggplot</span>(variance_data, <span class="fu">aes</span>(metric, sd, <span class="at">fill =</span> metric)) <span class="sc">+</span></span>
<span id="cb9-153"><a href="#cb9-153"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb9-154"><a href="#cb9-154"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb9-155"><a href="#cb9-155"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f mm</span><span class="sc">\n</span><span class="st">(%.0f%% reduction)"</span>, sd, variance_reduction)),</span>
<span id="cb9-156"><a href="#cb9-156"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>,</span>
<span id="cb9-157"><a href="#cb9-157"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb9-158"><a href="#cb9-158"></a>    <span class="at">size =</span> <span class="fl">4.5</span></span>
<span id="cb9-159"><a href="#cb9-159"></a>  ) <span class="sc">+</span></span>
<span id="cb9-160"><a href="#cb9-160"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb9-161"><a href="#cb9-161"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb9-162"><a href="#cb9-162"></a>      <span class="st">"Raw"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>,</span>
<span id="cb9-163"><a href="#cb9-163"></a>      <span class="st">"3-Day MA"</span> <span class="ot">=</span> <span class="st">"#F77F00"</span>,</span>
<span id="cb9-164"><a href="#cb9-164"></a>      <span class="st">"7-Day MA"</span> <span class="ot">=</span> <span class="st">"#06A77D"</span></span>
<span id="cb9-165"><a href="#cb9-165"></a>    )</span>
<span id="cb9-166"><a href="#cb9-166"></a>  ) <span class="sc">+</span></span>
<span id="cb9-167"><a href="#cb9-167"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-168"><a href="#cb9-168"></a>    <span class="at">title =</span> <span class="st">"Variance Reduction by Moving Averages"</span>,</span>
<span id="cb9-169"><a href="#cb9-169"></a>    <span class="at">subtitle =</span> <span class="st">"Standard deviation decreases as window increases"</span>,</span>
<span id="cb9-170"><a href="#cb9-170"></a>    <span class="at">y =</span> <span class="st">"Standard Deviation (mm)"</span>,</span>
<span id="cb9-171"><a href="#cb9-171"></a>    <span class="at">x =</span> <span class="cn">NULL</span></span>
<span id="cb9-172"><a href="#cb9-172"></a>  ) <span class="sc">+</span></span>
<span id="cb9-173"><a href="#cb9-173"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb9-174"><a href="#cb9-174"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-175"><a href="#cb9-175"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb9-176"><a href="#cb9-176"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb9-177"><a href="#cb9-177"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb9-178"><a href="#cb9-178"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-179"><a href="#cb9-179"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb9-180"><a href="#cb9-180"></a>  ) <span class="sc">+</span></span>
<span id="cb9-181"><a href="#cb9-181"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fu">max</span>(variance_data<span class="sc">$</span>sd) <span class="sc">*</span> <span class="fl">1.15</span>)</span>
<span id="cb9-182"><a href="#cb9-182"></a><span class="in">```</span></span>
<span id="cb9-183"><a href="#cb9-183"></a></span>
<span id="cb9-186"><a href="#cb9-186"></a><span class="in">```{r}</span></span>
<span id="cb9-187"><a href="#cb9-187"></a><span class="co">#| label: fig-ma-ridgeline</span></span>
<span id="cb9-188"><a href="#cb9-188"></a><span class="co">#| fig-cap: "Distribution Tightening with Moving Averages. Peaks sharpen and tails compress as the averaging window increases."</span></span>
<span id="cb9-189"><a href="#cb9-189"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb9-190"><a href="#cb9-190"></a><span class="co">#| fig-height: 7</span></span>
<span id="cb9-191"><a href="#cb9-191"></a><span class="co">#| echo: true</span></span>
<span id="cb9-192"><a href="#cb9-192"></a><span class="co">#| warning: false</span></span>
<span id="cb9-193"><a href="#cb9-193"></a></span>
<span id="cb9-194"><a href="#cb9-194"></a>ridge_data <span class="ot">&lt;-</span> ma_data <span class="sc">%&gt;%</span></span>
<span id="cb9-195"><a href="#cb9-195"></a>  <span class="fu">filter</span>(rainfall <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-196"><a href="#cb9-196"></a>  <span class="fu">select</span>(rainfall, rainfall_ma3, rainfall_ma7) <span class="sc">%&gt;%</span></span>
<span id="cb9-197"><a href="#cb9-197"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-198"><a href="#cb9-198"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb9-199"><a href="#cb9-199"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-200"><a href="#cb9-200"></a>    <span class="at">metric =</span> <span class="fu">factor</span>(</span>
<span id="cb9-201"><a href="#cb9-201"></a>      metric,</span>
<span id="cb9-202"><a href="#cb9-202"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"rainfall_ma7"</span>, <span class="st">"rainfall_ma3"</span>, <span class="st">"rainfall"</span>),</span>
<span id="cb9-203"><a href="#cb9-203"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"7-Day MA"</span>, <span class="st">"3-Day MA"</span>, <span class="st">"Raw Daily"</span>)</span>
<span id="cb9-204"><a href="#cb9-204"></a>    )</span>
<span id="cb9-205"><a href="#cb9-205"></a>  )</span>
<span id="cb9-206"><a href="#cb9-206"></a></span>
<span id="cb9-207"><a href="#cb9-207"></a><span class="fu">ggplot</span>(ridge_data, <span class="fu">aes</span>(value, metric, <span class="at">fill =</span> metric)) <span class="sc">+</span></span>
<span id="cb9-208"><a href="#cb9-208"></a>  <span class="fu">geom_density_ridges</span>(</span>
<span id="cb9-209"><a href="#cb9-209"></a>    <span class="at">alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb9-210"><a href="#cb9-210"></a>    <span class="at">scale =</span> <span class="fl">1.5</span>,</span>
<span id="cb9-211"><a href="#cb9-211"></a>    <span class="at">quantile_lines =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-212"><a href="#cb9-212"></a>    <span class="at">quantiles =</span> <span class="dv">2</span></span>
<span id="cb9-213"><a href="#cb9-213"></a>  ) <span class="sc">+</span></span>
<span id="cb9-214"><a href="#cb9-214"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb9-215"><a href="#cb9-215"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb9-216"><a href="#cb9-216"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"5"</span>, <span class="st">"10"</span>, <span class="st">"25"</span>, <span class="st">"50"</span>, <span class="st">"100"</span>)</span>
<span id="cb9-217"><a href="#cb9-217"></a>  ) <span class="sc">+</span></span>
<span id="cb9-218"><a href="#cb9-218"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb9-219"><a href="#cb9-219"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb9-220"><a href="#cb9-220"></a>      <span class="st">"Raw Daily"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>,</span>
<span id="cb9-221"><a href="#cb9-221"></a>      <span class="st">"3-Day MA"</span> <span class="ot">=</span> <span class="st">"#F77F00"</span>,</span>
<span id="cb9-222"><a href="#cb9-222"></a>      <span class="st">"7-Day MA"</span> <span class="ot">=</span> <span class="st">"#06A77D"</span></span>
<span id="cb9-223"><a href="#cb9-223"></a>    )</span>
<span id="cb9-224"><a href="#cb9-224"></a>  ) <span class="sc">+</span></span>
<span id="cb9-225"><a href="#cb9-225"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-226"><a href="#cb9-226"></a>    <span class="at">title =</span> <span class="st">"Distribution Tightening with Moving Averages"</span>,</span>
<span id="cb9-227"><a href="#cb9-227"></a>    <span class="at">subtitle =</span> <span class="st">"Peaks become sharper and tails compress as window size increases"</span>,</span>
<span id="cb9-228"><a href="#cb9-228"></a>    <span class="at">x =</span> <span class="st">"Rainfall (mm, log scale)"</span>,</span>
<span id="cb9-229"><a href="#cb9-229"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb9-230"><a href="#cb9-230"></a>  ) <span class="sc">+</span></span>
<span id="cb9-231"><a href="#cb9-231"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb9-232"><a href="#cb9-232"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-233"><a href="#cb9-233"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb9-234"><a href="#cb9-234"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>)),</span>
<span id="cb9-235"><a href="#cb9-235"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb9-236"><a href="#cb9-236"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb9-237"><a href="#cb9-237"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-238"><a href="#cb9-238"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb9-239"><a href="#cb9-239"></a>  )</span>
<span id="cb9-240"><a href="#cb9-240"></a><span class="in">```</span></span>
<span id="cb9-241"><a href="#cb9-241"></a></span>
<span id="cb9-242"><a href="#cb9-242"></a>The density plots in @fig-signal-extraction make the smoothing effect immediately apparent. The raw daily distribution (pink) is severely right-skewed with a long tail reaching into the hundreds of millimetres, a consequence of the extreme kurtosis documented in the @sec-eda. The 3-day moving average (orange) begins to suppress this variance, and the 7-day average (green) produces a substantially more concentrated distribution whose peak is considerably higher and whose tails are dramatically shorter.</span>
<span id="cb9-243"><a href="#cb9-243"></a></span>
<span id="cb9-244"><a href="#cb9-244"></a>Quantitatively (@fig-variance-reduction), the standard deviation of rainfall intensity falls from 13.1 mm in the raw series to 5.8 mm under the 7-day average, a reduction of 56%. The ridgeline plot (@fig-ma-ridgeline) confirms that this compression is not an artefact of the summary statistic: the entire shape of the distribution tightens, with each additional day of averaging producing a distribution that is more peaked and less diffuse. The 7-day average can therefore be interpreted as a measure of the "weekly wetness regime".A smoothed characterisation of whether the preceding week has been generally wet or generally dry rather than the unpredictability of any single day's precipitation.</span>
<span id="cb9-245"><a href="#cb9-245"></a></span>
<span id="cb9-246"><a href="#cb9-246"></a><span class="fu">### Multicollinearity Trade-off</span></span>
<span id="cb9-247"><a href="#cb9-247"></a></span>
<span id="cb9-250"><a href="#cb9-250"></a><span class="in">```{r}</span></span>
<span id="cb9-251"><a href="#cb9-251"></a><span class="co">#| label: fig-ma-correlation</span></span>
<span id="cb9-252"><a href="#cb9-252"></a><span class="co">#| fig-cap: "Feature Correlations: Raw vs Moving Averages. High correlations between MA features warn of multicollinearity risks for linear model families."</span></span>
<span id="cb9-253"><a href="#cb9-253"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb9-254"><a href="#cb9-254"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb9-255"><a href="#cb9-255"></a><span class="co">#| echo: true</span></span>
<span id="cb9-256"><a href="#cb9-256"></a><span class="co">#| warning: false</span></span>
<span id="cb9-257"><a href="#cb9-257"></a></span>
<span id="cb9-258"><a href="#cb9-258"></a>cor_data <span class="ot">&lt;-</span> ma_data <span class="sc">%&gt;%</span></span>
<span id="cb9-259"><a href="#cb9-259"></a>  <span class="fu">select</span>(</span>
<span id="cb9-260"><a href="#cb9-260"></a>    rainfall,</span>
<span id="cb9-261"><a href="#cb9-261"></a>    rainfall_ma3,</span>
<span id="cb9-262"><a href="#cb9-262"></a>    rainfall_ma7,</span>
<span id="cb9-263"><a href="#cb9-263"></a>    humidity3pm,</span>
<span id="cb9-264"><a href="#cb9-264"></a>    humidity_ma3,</span>
<span id="cb9-265"><a href="#cb9-265"></a>    humidity_ma7</span>
<span id="cb9-266"><a href="#cb9-266"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-267"><a href="#cb9-267"></a>  <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>, <span class="at">method =</span> <span class="st">"spearman"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-268"><a href="#cb9-268"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-269"><a href="#cb9-269"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"var1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-270"><a href="#cb9-270"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>var1, <span class="at">names_to =</span> <span class="st">"var2"</span>, <span class="at">values_to =</span> <span class="st">"correlation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-271"><a href="#cb9-271"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-272"><a href="#cb9-272"></a>    <span class="at">var1 =</span> <span class="fu">factor</span>(</span>
<span id="cb9-273"><a href="#cb9-273"></a>      var1,</span>
<span id="cb9-274"><a href="#cb9-274"></a>      <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb9-275"><a href="#cb9-275"></a>        <span class="st">"rainfall"</span>,</span>
<span id="cb9-276"><a href="#cb9-276"></a>        <span class="st">"rainfall_ma3"</span>,</span>
<span id="cb9-277"><a href="#cb9-277"></a>        <span class="st">"rainfall_ma7"</span>,</span>
<span id="cb9-278"><a href="#cb9-278"></a>        <span class="st">"humidity3pm"</span>,</span>
<span id="cb9-279"><a href="#cb9-279"></a>        <span class="st">"humidity_ma3"</span>,</span>
<span id="cb9-280"><a href="#cb9-280"></a>        <span class="st">"humidity_ma7"</span></span>
<span id="cb9-281"><a href="#cb9-281"></a>      )</span>
<span id="cb9-282"><a href="#cb9-282"></a>    ),</span>
<span id="cb9-283"><a href="#cb9-283"></a>    <span class="at">var2 =</span> <span class="fu">factor</span>(</span>
<span id="cb9-284"><a href="#cb9-284"></a>      var2,</span>
<span id="cb9-285"><a href="#cb9-285"></a>      <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb9-286"><a href="#cb9-286"></a>        <span class="st">"rainfall"</span>,</span>
<span id="cb9-287"><a href="#cb9-287"></a>        <span class="st">"rainfall_ma3"</span>,</span>
<span id="cb9-288"><a href="#cb9-288"></a>        <span class="st">"rainfall_ma7"</span>,</span>
<span id="cb9-289"><a href="#cb9-289"></a>        <span class="st">"humidity3pm"</span>,</span>
<span id="cb9-290"><a href="#cb9-290"></a>        <span class="st">"humidity_ma3"</span>,</span>
<span id="cb9-291"><a href="#cb9-291"></a>        <span class="st">"humidity_ma7"</span></span>
<span id="cb9-292"><a href="#cb9-292"></a>      )</span>
<span id="cb9-293"><a href="#cb9-293"></a>    )</span>
<span id="cb9-294"><a href="#cb9-294"></a>  )</span>
<span id="cb9-295"><a href="#cb9-295"></a></span>
<span id="cb9-296"><a href="#cb9-296"></a><span class="fu">ggplot</span>(cor_data, <span class="fu">aes</span>(var2, var1, <span class="at">fill =</span> correlation)) <span class="sc">+</span></span>
<span id="cb9-297"><a href="#cb9-297"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-298"><a href="#cb9-298"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb9-299"><a href="#cb9-299"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, correlation)),</span>
<span id="cb9-300"><a href="#cb9-300"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb9-301"><a href="#cb9-301"></a>    <span class="at">size =</span> <span class="fl">3.5</span></span>
<span id="cb9-302"><a href="#cb9-302"></a>  ) <span class="sc">+</span></span>
<span id="cb9-303"><a href="#cb9-303"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb9-304"><a href="#cb9-304"></a>    <span class="at">low =</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb9-305"><a href="#cb9-305"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb9-306"><a href="#cb9-306"></a>    <span class="at">high =</span> <span class="st">"#D55E00"</span>,</span>
<span id="cb9-307"><a href="#cb9-307"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb9-308"><a href="#cb9-308"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb9-309"><a href="#cb9-309"></a>    <span class="at">name =</span> <span class="st">"Correlation"</span></span>
<span id="cb9-310"><a href="#cb9-310"></a>  ) <span class="sc">+</span></span>
<span id="cb9-311"><a href="#cb9-311"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-312"><a href="#cb9-312"></a>    <span class="at">title =</span> <span class="st">"Feature Correlations: Raw vs Moving Averages"</span>,</span>
<span id="cb9-313"><a href="#cb9-313"></a>    <span class="at">subtitle =</span> <span class="st">"MAs are highly correlated with each other (potential multicollinearity)"</span>,</span>
<span id="cb9-314"><a href="#cb9-314"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-315"><a href="#cb9-315"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb9-316"><a href="#cb9-316"></a>  ) <span class="sc">+</span></span>
<span id="cb9-317"><a href="#cb9-317"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb9-318"><a href="#cb9-318"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-319"><a href="#cb9-319"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb9-320"><a href="#cb9-320"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb9-321"><a href="#cb9-321"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb9-322"><a href="#cb9-322"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb9-323"><a href="#cb9-323"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb9-324"><a href="#cb9-324"></a>  )</span>
<span id="cb9-325"><a href="#cb9-325"></a><span class="in">```</span></span>
<span id="cb9-326"><a href="#cb9-326"></a></span>
<span id="cb9-327"><a href="#cb9-327"></a>The noise-reduction benefit of moving averages comes at a cost. As shown in @fig-ma-correlation, the 3-day and 7-day humidity moving averages share a Spearman correlation of 0.89, and the equivalent rainfall moving averages are similarly collinear with each other and with the raw series. Including multiple moving average windows alongside their source variables in the same linear model would produce a near-singular design matrix, inflating coefficient standard errors and making the model numerically unstable.</span>
<span id="cb9-328"><a href="#cb9-328"></a></span>
<span id="cb9-329"><a href="#cb9-329"></a>This presents a choice between responsiveness and stability. The 3-day average reacts more quickly to changing conditions but retains more of the day-to-day variability. The 7-day average is more stable but slower to reflect recent changes in the weather regime. For linear model families such as logistic regression, only one window can be safely retained per variable; including both is not viable. For tree-based models like Random Forest and Gradient Boosting, this constraint does not apply, since these methods select among correlated features at each split rather than inverting the full covariance matrix. The moving average selection strategy therefore depends on the model family, a consideration that informs the variable selection carried out in the subsequent modelling chapter.</span>
<span id="cb9-330"><a href="#cb9-330"></a></span>
<span id="cb9-331"><a href="#cb9-331"></a>---</span>
<span id="cb9-332"><a href="#cb9-332"></a></span>
<span id="cb9-333"><a href="#cb9-333"></a><span class="fu">## Feature Engineering Pipeline</span></span>
<span id="cb9-334"><a href="#cb9-334"></a></span>
<span id="cb9-335"><a href="#cb9-335"></a>The following pipeline implements the complete set of features motivated by the EDA. Each transformation is annotated to its originating empirical finding.</span>
<span id="cb9-336"><a href="#cb9-336"></a></span>
<span id="cb9-339"><a href="#cb9-339"></a><span class="in">```{r}</span></span>
<span id="cb9-340"><a href="#cb9-340"></a><span class="co">#| label: feature-engineering</span></span>
<span id="cb9-341"><a href="#cb9-341"></a><span class="co">#| echo: true</span></span>
<span id="cb9-342"><a href="#cb9-342"></a><span class="co">#| message: false</span></span>
<span id="cb9-343"><a href="#cb9-343"></a><span class="co">#| warning: false</span></span>
<span id="cb9-344"><a href="#cb9-344"></a></span>
<span id="cb9-345"><a href="#cb9-345"></a>compass_lookup <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-346"><a href="#cb9-346"></a>  <span class="st">"N"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb9-347"><a href="#cb9-347"></a>  <span class="st">"NNE"</span> <span class="ot">=</span> <span class="fl">22.5</span>,</span>
<span id="cb9-348"><a href="#cb9-348"></a>  <span class="st">"NE"</span> <span class="ot">=</span> <span class="dv">45</span>,</span>
<span id="cb9-349"><a href="#cb9-349"></a>  <span class="st">"ENE"</span> <span class="ot">=</span> <span class="fl">67.5</span>,</span>
<span id="cb9-350"><a href="#cb9-350"></a>  <span class="st">"E"</span> <span class="ot">=</span> <span class="dv">90</span>,</span>
<span id="cb9-351"><a href="#cb9-351"></a>  <span class="st">"ESE"</span> <span class="ot">=</span> <span class="fl">112.5</span>,</span>
<span id="cb9-352"><a href="#cb9-352"></a>  <span class="st">"SE"</span> <span class="ot">=</span> <span class="dv">135</span>,</span>
<span id="cb9-353"><a href="#cb9-353"></a>  <span class="st">"SSE"</span> <span class="ot">=</span> <span class="fl">157.5</span>,</span>
<span id="cb9-354"><a href="#cb9-354"></a>  <span class="st">"S"</span> <span class="ot">=</span> <span class="dv">180</span>,</span>
<span id="cb9-355"><a href="#cb9-355"></a>  <span class="st">"SSW"</span> <span class="ot">=</span> <span class="fl">202.5</span>,</span>
<span id="cb9-356"><a href="#cb9-356"></a>  <span class="st">"SW"</span> <span class="ot">=</span> <span class="dv">225</span>,</span>
<span id="cb9-357"><a href="#cb9-357"></a>  <span class="st">"WSW"</span> <span class="ot">=</span> <span class="fl">247.5</span>,</span>
<span id="cb9-358"><a href="#cb9-358"></a>  <span class="st">"W"</span> <span class="ot">=</span> <span class="dv">270</span>,</span>
<span id="cb9-359"><a href="#cb9-359"></a>  <span class="st">"WNW"</span> <span class="ot">=</span> <span class="fl">292.5</span>,</span>
<span id="cb9-360"><a href="#cb9-360"></a>  <span class="st">"NW"</span> <span class="ot">=</span> <span class="dv">315</span>,</span>
<span id="cb9-361"><a href="#cb9-361"></a>  <span class="st">"NNW"</span> <span class="ot">=</span> <span class="fl">337.5</span></span>
<span id="cb9-362"><a href="#cb9-362"></a>)</span>
<span id="cb9-363"><a href="#cb9-363"></a></span>
<span id="cb9-364"><a href="#cb9-364"></a>df_final <span class="ot">&lt;-</span> df_final <span class="sc">%&gt;%</span></span>
<span id="cb9-365"><a href="#cb9-365"></a>  <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb9-366"><a href="#cb9-366"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb9-367"><a href="#cb9-367"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-368"><a href="#cb9-368"></a>    <span class="co"># Lagging MA by 1 day ensures we predict 'Today' using only 'Yesterday's'</span></span>
<span id="cb9-369"><a href="#cb9-369"></a>    <span class="co"># trends to prevent data leakage</span></span>
<span id="cb9-370"><a href="#cb9-370"></a>    <span class="at">rainfall_ma7 =</span> <span class="fu">lag</span>(</span>
<span id="cb9-371"><a href="#cb9-371"></a>      <span class="fu">rollmean</span>(rainfall, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb9-372"><a href="#cb9-372"></a>      <span class="at">n =</span> <span class="dv">1</span></span>
<span id="cb9-373"><a href="#cb9-373"></a>    ),</span>
<span id="cb9-374"><a href="#cb9-374"></a>    <span class="at">humidity_ma7 =</span> <span class="fu">lag</span>(</span>
<span id="cb9-375"><a href="#cb9-375"></a>      <span class="fu">rollmean</span>(humidity3pm, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb9-376"><a href="#cb9-376"></a>      <span class="dv">1</span></span>
<span id="cb9-377"><a href="#cb9-377"></a>    ),</span>
<span id="cb9-378"><a href="#cb9-378"></a></span>
<span id="cb9-379"><a href="#cb9-379"></a>    <span class="co"># Dry Spell Calculation</span></span>
<span id="cb9-380"><a href="#cb9-380"></a>    <span class="at">rain_event_id =</span> <span class="fu">cumsum</span>(<span class="fu">lag</span>(rainfall, <span class="dv">1</span>) <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb9-381"><a href="#cb9-381"></a>    <span class="at">days_since_rain =</span> <span class="fu">row_number</span>() <span class="sc">-</span> <span class="fu">match</span>(rain_event_id, rain_event_id),</span>
<span id="cb9-382"><a href="#cb9-382"></a></span>
<span id="cb9-383"><a href="#cb9-383"></a>    <span class="co"># Markov Chain State</span></span>
<span id="cb9-384"><a href="#cb9-384"></a>    <span class="at">rain_yesterday =</span> <span class="fu">lag</span>(rain_today, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb9-385"><a href="#cb9-385"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-386"><a href="#cb9-386"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-387"><a href="#cb9-387"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rain_yesterday), <span class="sc">!</span><span class="fu">is.na</span>(rainfall_ma7)) <span class="sc">%&gt;%</span></span>
<span id="cb9-388"><a href="#cb9-388"></a>  <span class="fu">select</span>(<span class="sc">-</span>rain_event_id) <span class="sc">%&gt;%</span></span>
<span id="cb9-389"><a href="#cb9-389"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-390"><a href="#cb9-390"></a>    <span class="co"># Cyclical Time Encoding</span></span>
<span id="cb9-391"><a href="#cb9-391"></a>    <span class="at">day_of_year =</span> <span class="fu">yday</span>(date),</span>
<span id="cb9-392"><a href="#cb9-392"></a>    <span class="at">day_sin =</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> day_of_year <span class="sc">/</span> <span class="dv">365</span>),</span>
<span id="cb9-393"><a href="#cb9-393"></a>    <span class="at">day_cos =</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> day_of_year <span class="sc">/</span> <span class="dv">365</span>),</span>
<span id="cb9-394"><a href="#cb9-394"></a></span>
<span id="cb9-395"><a href="#cb9-395"></a>    <span class="co"># Interaction Terms (The "Rain Corner")</span></span>
<span id="cb9-396"><a href="#cb9-396"></a>    <span class="at">sunshine =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(sunshine, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb9-397"><a href="#cb9-397"></a>    <span class="at">humidity3pm =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(humidity3pm, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb9-398"><a href="#cb9-398"></a>    <span class="at">sun_humid_interaction =</span> <span class="fu">as.numeric</span>(sunshine <span class="sc">*</span> humidity3pm),</span>
<span id="cb9-399"><a href="#cb9-399"></a></span>
<span id="cb9-400"><a href="#cb9-400"></a>    <span class="co"># Meteorological Indices</span></span>
<span id="cb9-401"><a href="#cb9-401"></a>    <span class="at">pressure_change =</span> pressure3pm <span class="sc">-</span> pressure9am,</span>
<span id="cb9-402"><a href="#cb9-402"></a>    <span class="at">dewpoint_9am =</span> temp9am <span class="sc">-</span> ((<span class="dv">100</span> <span class="sc">-</span> humidity9am) <span class="sc">/</span> <span class="dv">5</span>),</span>
<span id="cb9-403"><a href="#cb9-403"></a>    <span class="at">dewpoint_3pm =</span> temp3pm <span class="sc">-</span> ((<span class="dv">100</span> <span class="sc">-</span> humidity3pm) <span class="sc">/</span> <span class="dv">5</span>),</span>
<span id="cb9-404"><a href="#cb9-404"></a>    <span class="at">dewpoint_change =</span> dewpoint_3pm <span class="sc">-</span> dewpoint_9am,</span>
<span id="cb9-405"><a href="#cb9-405"></a>    <span class="at">moisture_index =</span> humidity3pm <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> sunshine <span class="sc">/</span> <span class="dv">15</span>),</span>
<span id="cb9-406"><a href="#cb9-406"></a>    <span class="at">instability_index =</span> (<span class="dv">1020</span> <span class="sc">-</span> pressure3pm) <span class="sc">*</span> humidity3pm <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb9-407"><a href="#cb9-407"></a>    <span class="at">cloud_development =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, cloud3pm <span class="sc">-</span> cloud9am),</span>
<span id="cb9-408"><a href="#cb9-408"></a></span>
<span id="cb9-409"><a href="#cb9-409"></a>    <span class="co"># Circular Wind Vector Decomposition</span></span>
<span id="cb9-410"><a href="#cb9-410"></a>    <span class="at">gust_rad =</span> compass_lookup[wind_gust_dir] <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>,</span>
<span id="cb9-411"><a href="#cb9-411"></a>    <span class="at">gust_V_NS =</span> wind_gust_speed <span class="sc">*</span> <span class="fu">cos</span>(gust_rad),</span>
<span id="cb9-412"><a href="#cb9-412"></a>    <span class="at">gust_U_EW =</span> wind_gust_speed <span class="sc">*</span> <span class="fu">sin</span>(gust_rad),</span>
<span id="cb9-413"><a href="#cb9-413"></a>    <span class="at">wind9am_rad =</span> compass_lookup[wind_dir9am] <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>,</span>
<span id="cb9-414"><a href="#cb9-414"></a>    <span class="at">wind9am_V_NS =</span> wind_speed9am <span class="sc">*</span> <span class="fu">cos</span>(wind9am_rad),</span>
<span id="cb9-415"><a href="#cb9-415"></a>    <span class="at">wind9am_U_EW =</span> wind_speed9am <span class="sc">*</span> <span class="fu">sin</span>(wind9am_rad)</span>
<span id="cb9-416"><a href="#cb9-416"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-417"><a href="#cb9-417"></a>  <span class="fu">relocate</span>(rain_today, date, location) <span class="sc">%&gt;%</span></span>
<span id="cb9-418"><a href="#cb9-418"></a>  <span class="fu">relocate</span>(rain_yesterday, days_since_rain, <span class="at">.after =</span> location) <span class="sc">%&gt;%</span></span>
<span id="cb9-419"><a href="#cb9-419"></a>  <span class="fu">relocate</span>(<span class="fu">ends_with</span>(<span class="st">"_ma7"</span>), <span class="at">.after =</span> days_since_rain) <span class="sc">%&gt;%</span></span>
<span id="cb9-420"><a href="#cb9-420"></a>  <span class="fu">relocate</span>(day_sin, day_cos, <span class="at">.after =</span> date)</span>
<span id="cb9-421"><a href="#cb9-421"></a><span class="in">```</span></span>
<span id="cb9-422"><a href="#cb9-422"></a></span>
<span id="cb9-423"><a href="#cb9-423"></a>The pipeline is organised into four conceptually distinct transformations, each addressing a specific structural property identified in the EDA.</span>
<span id="cb9-424"><a href="#cb9-424"></a></span>
<span id="cb9-425"><a href="#cb9-425"></a><span class="fu">### Cyclical Encoding of Seasonality</span></span>
<span id="cb9-426"><a href="#cb9-426"></a></span>
<span id="cb9-427"><a href="#cb9-427"></a>The seasonal analysis established that rainfall frequency and intensity follow a smooth annual cycle: summer events are rarer but more intense, winter events are more frequent but lighter, and the transition months connect these poles continuously. Treating month as a standard integer (1 through 12) would incorrectly imply that January and December are maximally distant on the number line, when in reality they are climatologically adjacent. Treating it as an unordered factor imposes no such adjacency constraint but discards ordinal information entirely.</span>
<span id="cb9-428"><a href="#cb9-428"></a></span>
<span id="cb9-429"><a href="#cb9-429"></a>The appropriate solution is to represent the annual cycle as a point on the unit circle, decomposed into its sine and cosine components:</span>
<span id="cb9-430"><a href="#cb9-430"></a></span>
<span id="cb9-431"><a href="#cb9-431"></a>$$\text{day<span class="sc">\_</span>sin} = \sin<span class="sc">\!</span>\left(\frac{2\pi \cdot \text{day<span class="sc">\_</span>of<span class="sc">\_</span>year}}{365}\right), \quad \text{day<span class="sc">\_</span>cos} = \cos<span class="sc">\!</span>\left(\frac{2\pi \cdot \text{day<span class="sc">\_</span>of<span class="sc">\_</span>year}}{365}\right)$$</span>
<span id="cb9-432"><a href="#cb9-432"></a></span>
<span id="cb9-433"><a href="#cb9-433"></a>Together, these two features encode any day of the year as a unique coordinate on the unit circle. The distance between any two days in this space reflects their true circular proximity: the December-to-January transition corresponds to a small arc, not a large jump. The model can learn smooth seasonal effects directly from the geometry of this representation.</span>
<span id="cb9-434"><a href="#cb9-434"></a></span>
<span id="cb9-435"><a href="#cb9-435"></a><span class="fu">### Temporal Persistence Features</span></span>
<span id="cb9-436"><a href="#cb9-436"></a></span>
<span id="cb9-437"><a href="#cb9-437"></a>The Markov Chain analysis (@sec-markov) demonstrated that the previous day's rain state carries a moderate but meaningful signal ($V \approx 0.31$), and the dry spell analysis showed that the probability of rain decays in a non-linear pattern as dry spells lengthen. Three features capture these dynamics.</span>
<span id="cb9-438"><a href="#cb9-438"></a></span>
<span id="cb9-439"><a href="#cb9-439"></a><span class="in">`rain_yesterday`</span> is a direct binary indicator of the previous day's state, encoding the first-order Markov transition directly as a predictor. <span class="in">`days_since_rain`</span> counts the number of consecutive dry days preceding the current observation, capturing the progressive stabilisation of dry conditions that the logistic regression and spline analysis identified. <span class="in">`rainfall_ma7`</span> and <span class="in">`humidity_ma7`</span> provide a smoothed weekly context for both the rainfall and moisture signals, lagged by one additional day beyond the rolling window to ensure that no same-day information is included when predicting today's outcome.</span>
<span id="cb9-440"><a href="#cb9-440"></a></span>
<span id="cb9-441"><a href="#cb9-441"></a>The lagging step deserves emphasis. Without it, the 7-day moving average at time $t$ includes the observation at time $t$ itself, meaning a model trained on this feature would have access to the value it is trying to predict. This form of data leakage produces artificially optimistic training metrics that do not generalise to deployment, where future observations are unavailable by definition.</span>
<span id="cb9-442"><a href="#cb9-442"></a></span>
<span id="cb9-443"><a href="#cb9-443"></a><span class="fu">### Physical Interaction and Derived Indices</span></span>
<span id="cb9-444"><a href="#cb9-444"></a></span>
<span id="cb9-445"><a href="#cb9-445"></a>The bivariate density analysis (@sec-bivariate-density) identified a qualitative difference in the joint distribution of humidity and sunshine between rainy and dry days: rain occurs almost exclusively when afternoon humidity is high and sunshine hours are low simultaneously, the "Rain Corner" phenomenon. An additive model cannot represent this conditional structure; a multiplicative interaction term is required.</span>
<span id="cb9-446"><a href="#cb9-446"></a></span>
<span id="cb9-447"><a href="#cb9-447"></a>Prior to computing the interaction, both <span class="in">`sunshine`</span> and <span class="in">`humidity3pm`</span> are mean-centred (their grand means are subtracted). This is not merely a cosmetic step. When an interaction term is formed from un-centred variables, the resulting product is algebraically correlated with both main effects, inflating the VIF of all three terms and making their individual coefficients difficult to interpret. Centring removes this artificial correlation: the main effects then represent the effect of each variable at the average level of the other, and the interaction term represents the additional effect of their joint deviation. This is confirmed empirically in the VIF diagnostics in Section 3.</span>
<span id="cb9-448"><a href="#cb9-448"></a></span>
<span id="cb9-449"><a href="#cb9-449"></a>Beyond the interaction term, five derived meteorological indices are constructed from physically motivated combinations of the available variables. The dewpoint temperatures at 9:00 AM and 3:00 PM computed from the Magnus approximation $T_d \approx T - \frac{100 - RH}{5}$  represent the temperature at which the air would become saturated if cooled at constant pressure. The change in dewpoint across the day (<span class="in">`dewpoint_change`</span>) measures whether the atmosphere is gaining or losing moisture over the course of the day, a signal not directly recoverable from temperature or humidity alone. The <span class="in">`moisture_index`</span> encodes the combined effect of high humidity and limited solar exposure. The <span class="in">`instability_index`</span> combines pressure deficit from the standard 1020 hPa baseline with humidity, approximating the atmospheric conditions that favour convective development. <span class="in">`cloud_development`</span> captures upward cloud formation during the day, which the pressure analysis identified as a meaningful precursor to precipitation.</span>
<span id="cb9-450"><a href="#cb9-450"></a></span>
<span id="cb9-451"><a href="#cb9-451"></a><span class="fu">### Circular Wind Vector Decomposition</span></span>
<span id="cb9-452"><a href="#cb9-452"></a></span>
<span id="cb9-453"><a href="#cb9-453"></a>Wind direction is a circular variable: 360 $^\circ$  and 0 $^\circ$ represent the same direction (due North), yet a naive numeric encoding would treat them as maximally distant. This misrepresentation is particularly consequential for wind because the directional origin of an air mass carries meaningful physical content, moisture-laden northerly flows behave very differently from dry southerly flows in the Australian context.</span>
<span id="cb9-454"><a href="#cb9-454"></a></span>
<span id="cb9-455"><a href="#cb9-455"></a>The standard solution is to decompose each directional reading into orthogonal Cartesian components by projecting the wind vector onto the north-south and east-west axes:</span>
<span id="cb9-456"><a href="#cb9-456"></a></span>
<span id="cb9-457"><a href="#cb9-457"></a>$$U_{EW} = v \cdot \sin(\theta), \quad V_{NS} = v \cdot \cos(\theta)$$</span>
<span id="cb9-458"><a href="#cb9-458"></a></span>
<span id="cb9-459"><a href="#cb9-459"></a>where $v$ is wind speed (in km/h) and $\theta$ is the compass bearing in radians. The resulting U and V components are continuous and interpretable: a purely northerly wind of 20 km/h produces $V_{NS} = 20$, $U_{EW} = 0$; a purely easterly wind of the same speed produces $V_{NS} = 0$, $U_{EW} = 20$. This transformation is applied to both the peak gust and the 9:00 AM wind observations, yielding four wind component features in total.</span>
<span id="cb9-460"><a href="#cb9-460"></a></span>
<span id="cb9-461"><a href="#cb9-461"></a>---</span>
<span id="cb9-462"><a href="#cb9-462"></a></span>
<span id="cb9-463"><a href="#cb9-463"></a><span class="fu">## Multicollinearity Diagnostics</span></span>
<span id="cb9-464"><a href="#cb9-464"></a></span>
<span id="cb9-467"><a href="#cb9-467"></a><span class="in">```{r}</span></span>
<span id="cb9-468"><a href="#cb9-468"></a><span class="co">#| label: multicollinearity-check</span></span>
<span id="cb9-469"><a href="#cb9-469"></a><span class="co">#| echo: true</span></span>
<span id="cb9-470"><a href="#cb9-470"></a><span class="co">#| message: false</span></span>
<span id="cb9-471"><a href="#cb9-471"></a><span class="co">#| warning: false</span></span>
<span id="cb9-472"><a href="#cb9-472"></a></span>
<span id="cb9-473"><a href="#cb9-473"></a><span class="fu">write_csv</span>(df_final, <span class="st">"data/df_engineered.csv"</span>)</span>
<span id="cb9-474"><a href="#cb9-474"></a></span>
<span id="cb9-475"><a href="#cb9-475"></a>df_wo_location <span class="ot">&lt;-</span> <span class="fu">select_model_features</span>(df_final, <span class="at">keep_location =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-476"><a href="#cb9-476"></a></span>
<span id="cb9-477"><a href="#cb9-477"></a>vif_results <span class="ot">&lt;-</span> <span class="fu">mc_check</span>(df_wo_location)</span>
<span id="cb9-478"><a href="#cb9-478"></a></span>
<span id="cb9-479"><a href="#cb9-479"></a>vif_results <span class="sc">%&gt;%</span></span>
<span id="cb9-480"><a href="#cb9-480"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-481"><a href="#cb9-481"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(VIF)) <span class="sc">%&gt;%</span></span>
<span id="cb9-482"><a href="#cb9-482"></a>  <span class="fu">kable</span>(</span>
<span id="cb9-483"><a href="#cb9-483"></a>    <span class="at">caption =</span> <span class="st">"Variance Inflation Factor (VIF) for Selected Predictors"</span>,</span>
<span id="cb9-484"><a href="#cb9-484"></a>    <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb9-485"><a href="#cb9-485"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-486"><a href="#cb9-486"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-487"><a href="#cb9-487"></a></span>
<span id="cb9-488"><a href="#cb9-488"></a>df_scaled <span class="ot">&lt;-</span> df_wo_location <span class="sc">%&gt;%</span></span>
<span id="cb9-489"><a href="#cb9-489"></a>  <span class="fu">scale_data</span>()</span>
<span id="cb9-490"><a href="#cb9-490"></a></span>
<span id="cb9-491"><a href="#cb9-491"></a><span class="fu">write_csv</span>(df_scaled, <span class="st">"data/df_scaled.csv"</span>)</span>
<span id="cb9-492"><a href="#cb9-492"></a><span class="in">```</span></span>
<span id="cb9-493"><a href="#cb9-493"></a></span>
<span id="cb9-494"><a href="#cb9-494"></a>Feature engineering that introduces interaction terms, composite indices, and temporal aggregates necessarily creates new correlational structure in the design matrix. After constructing the full feature set, it is therefore essential to verify that no predictor has become so collinear with the others that its coefficient in a linear model would be effectively unidentifiable. We use the Variance Inflation Factor (VIF) for this diagnosis. The VIF for a given predictor quantifies how much its coefficient variance is inflated relative to what it would be in an orthogonal design: a VIF of $k$ indicates that the standard error of that coefficient is $\sqrt{k}$ times larger than it would be if the predictor were uncorrelated with all others. Values above 10 are conventionally treated as indicating severe collinearity requiring remediation.</span>
<span id="cb9-495"><a href="#cb9-495"></a></span>
<span id="cb9-496"><a href="#cb9-496"></a>**Cyclical and wind components.** The <span class="in">`day_sin`</span>, <span class="in">`day_cos`</span>, <span class="in">`gust_V_NS`</span>, and <span class="in">`gust_U_EW`</span> features all show VIF values well below 3. This confirms that the decomposition strategies, sine/cosine for the annual cycle and U/V projection for wind direction, successfully converted circular variables into continuous representations without introducing redundancy. Each component carries information that is approximately orthogonal to its pair.</span>
<span id="cb9-497"><a href="#cb9-497"></a></span>
<span id="cb9-498"><a href="#cb9-498"></a>**Interaction stability.** The <span class="in">`sun_humid_interaction`</span> term has a VIF of 1.188, which is exceptionally low for a multiplicative interaction. Without mean-centring the constituent variables before multiplication, interaction terms routinely exhibit VIFs above 10 due to their algebraic overlap with the main effects. The observed value of 1.188 provides empirical confirmation that centring eliminated this artificial correlation, and that the interaction term is capturing a genuinely distinct dimension of the feature space, the joint "Rain Corner" structure identified in the EDA.</span>
<span id="cb9-499"><a href="#cb9-499"></a></span>
<span id="cb9-500"><a href="#cb9-500"></a>**Elevated collinearity in humidity.** The highest observed VIF is for <span class="in">`humidity3pm`</span> at approximately 4.832. This is expected: humidity participates structurally in three of the derived features (<span class="in">`moisture_index`</span>, <span class="in">`instability_index`</span>, and <span class="in">`sun_humid_interaction`</span>), and its 7-day moving average is also present in the feature set. A VIF of 5 lies below the conventional threshold of 10 for severe concern and is consistent with what the literature describes as moderate collinearity. The decision to retain <span class="in">`humidity3pm`</span> despite this inflation is deliberate: it is the single strongest individual predictor of rainfall in the dataset (Spearman $r = 0.44$, as established in the @sec-eda), and removing it in favour of its derived aggregates would sacrifice the direct same-day atmospheric moisture signal for the sake of a marginal improvement in collinearity. For tree-based models, this trade-off does not arise, since these methods are not sensitive to multicollinearity by design.</span>
<span id="cb9-501"><a href="#cb9-501"></a></span>
<span id="cb9-502"><a href="#cb9-502"></a>**Overall assessment.** The full engineered feature set is numerically stable for use in linear model families. No VIF exceeds the critical threshold of 10, and the majority of features show values below 3. The pipeline has successfully converted the raw meteorological signals into a representation that is both physically interpretable and statistically well-conditioned for the modelling stage.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models/blob/main/04-features.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>