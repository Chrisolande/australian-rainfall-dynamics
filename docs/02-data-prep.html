<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="An in-depth statistical analysis of rainfall patterns across 49 Australian cities using Zero-Inflated Gamma GLMMs.">

<title>2&nbsp; Data Preparation – Australian Rainfall Dynamics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-eda.html" rel="next">
<link href="./01-intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-9eae319670a971b7aedd265dafd44b4f.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-e66b50aa4120364bfa72329fe8653b98.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-9eae319670a971b7aedd265dafd44b4f.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8e2f1e7c0669198c4f94b96f7f06b074.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-463e05341c278a50bd9d8b9e5c352418.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-8e2f1e7c0669198c4f94b96f7f06b074.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-data-prep.html">Data</a></li><li class="breadcrumb-item"><a href="./02-data-prep.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Preparation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Australian Rainfall Dynamics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Predicting Australian Rainfall</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-data-prep.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Feature Engineering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Feature Engineering</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Modelling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Modelling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Model Evaluation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-model-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Model Selection</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#computational-environment" id="toc-computational-environment" class="nav-link active" data-scroll-target="#computational-environment"><span class="header-section-number">2.1</span> Computational Environment</a></li>
  <li><a href="#initial-cleaning-and-standardisation" id="toc-initial-cleaning-and-standardisation" class="nav-link" data-scroll-target="#initial-cleaning-and-standardisation"><span class="header-section-number">2.2</span> Initial Cleaning and Standardisation</a></li>
  <li><a href="#sec-missingness-diagnostics" id="toc-sec-missingness-diagnostics" class="nav-link" data-scroll-target="#sec-missingness-diagnostics"><span class="header-section-number">2.3</span> Missingness Diagnostics</a>
  <ul class="collapse">
  <li><a href="#sec-co-missingness" id="toc-sec-co-missingness" class="nav-link" data-scroll-target="#sec-co-missingness"><span class="header-section-number">2.3.1</span> Co-missingness Structure</a></li>
  <li><a href="#sec-temporal-structure" id="toc-sec-temporal-structure" class="nav-link" data-scroll-target="#sec-temporal-structure"><span class="header-section-number">2.3.2</span> Temporal Structure and Structural Breaks</a></li>
  <li><a href="#sec-ghost-sensor" id="toc-sec-ghost-sensor" class="nav-link" data-scroll-target="#sec-ghost-sensor"><span class="header-section-number">2.3.3</span> Geographic Concentration: Ghost Sensor Identification</a></li>
  <li><a href="#sec-weather-conditionality" id="toc-sec-weather-conditionality" class="nav-link" data-scroll-target="#sec-weather-conditionality"><span class="header-section-number">2.3.4</span> Weather-Conditionality of Sunshine Missingness</a></li>
  <li><a href="#missing-pattern-structure" id="toc-missing-pattern-structure" class="nav-link" data-scroll-target="#missing-pattern-structure"><span class="header-section-number">2.3.5</span> Missing Pattern Structure</a></li>
  </ul></li>
  <li><a href="#sec-imputation-pipeline" id="toc-sec-imputation-pipeline" class="nav-link" data-scroll-target="#sec-imputation-pipeline"><span class="header-section-number">2.4</span> Imputation Pipeline</a>
  <ul class="collapse">
  <li><a href="#stage-1-temporal-interpolation" id="toc-stage-1-temporal-interpolation" class="nav-link" data-scroll-target="#stage-1-temporal-interpolation"><span class="header-section-number">2.4.1</span> Stage 1: Temporal Interpolation</a></li>
  <li><a href="#stage-2-multivariate-imputation-via-predictive-mean-matching-and-random-forest" id="toc-stage-2-multivariate-imputation-via-predictive-mean-matching-and-random-forest" class="nav-link" data-scroll-target="#stage-2-multivariate-imputation-via-predictive-mean-matching-and-random-forest"><span class="header-section-number">2.4.2</span> Stage 2: Multivariate Imputation via Predictive Mean Matching and Random Forest</a></li>
  <li><a href="#ghost-sensor-flagging" id="toc-ghost-sensor-flagging" class="nav-link" data-scroll-target="#ghost-sensor-flagging"><span class="header-section-number">2.4.3</span> Ghost Sensor Flagging</a></li>
  </ul></li>
  <li><a href="#post-imputation-dataset-properties" id="toc-post-imputation-dataset-properties" class="nav-link" data-scroll-target="#post-imputation-dataset-properties"><span class="header-section-number">2.5</span> Post-Imputation Dataset Properties</a></li>
  <li><a href="#sec-sensitivity" id="toc-sec-sensitivity" class="nav-link" data-scroll-target="#sec-sensitivity"><span class="header-section-number">2.6</span> Imputation Sensitivity Analysis</a>
  <ul class="collapse">
  <li><a href="#sec-sensitivity-setup" id="toc-sec-sensitivity-setup" class="nav-link" data-scroll-target="#sec-sensitivity-setup"><span class="header-section-number">2.6.1</span> Setup</a></li>
  <li><a href="#sec-convergence" id="toc-sec-convergence" class="nav-link" data-scroll-target="#sec-convergence"><span class="header-section-number">2.6.2</span> Algorithmic Convergence</a></li>
  <li><a href="#sec-dist-fidelity" id="toc-sec-dist-fidelity" class="nav-link" data-scroll-target="#sec-dist-fidelity"><span class="header-section-number">2.6.3</span> Distributional Fidelity</a></li>
  <li><a href="#sec-between-variance" id="toc-sec-between-variance" class="nav-link" data-scroll-target="#sec-between-variance"><span class="header-section-number">2.6.4</span> Between-Imputation Variance</a></li>
  <li><a href="#sec-rubins-rules" id="toc-sec-rubins-rules" class="nav-link" data-scroll-target="#sec-rubins-rules"><span class="header-section-number">2.6.5</span> Rubin’s Rules Variance Decomposition</a></li>
  <li><a href="#sec-sensitivity-summary" id="toc-sec-sensitivity-summary" class="nav-link" data-scroll-target="#sec-sensitivity-summary"><span class="header-section-number">2.6.6</span> Diagnostic Summary</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models/blob/main/02-data-prep.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-data-prep.html">Data</a></li><li class="breadcrumb-item"><a href="./02-data-prep.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Preparation</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-data" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Preparation</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<hr>
<blockquote class="blockquote">
<p><strong>Chapter Context.</strong> Before any statistical analysis can proceed, the raw dataset must be transformed into a form that is both analytically tractable and physically credible. This chapter documents three decisions that have downstream consequences throughout the report: the syntactic and temporal standardisation of the raw data, a diagnostic investigation of the structure and mechanism of the missingness, and the design of a two-stage imputation pipeline informed by that investigation. Each decision is motivated by the properties of the data-generating process rather than by computational convenience.</p>
</blockquote>
<hr>
<section id="computational-environment" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="computational-environment"><span class="header-section-number">2.1</span> Computational Environment</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb1-2"><a href="#cb1-2"></a>  tidyverse,</span>
<span id="cb1-3"><a href="#cb1-3"></a>  tidymodels,</span>
<span id="cb1-4"><a href="#cb1-4"></a>  kableExtra,</span>
<span id="cb1-5"><a href="#cb1-5"></a>  patchwork,</span>
<span id="cb1-6"><a href="#cb1-6"></a>  skimr,</span>
<span id="cb1-7"><a href="#cb1-7"></a>  gridExtra,</span>
<span id="cb1-8"><a href="#cb1-8"></a>  gtsummary,</span>
<span id="cb1-9"><a href="#cb1-9"></a>  janitor,</span>
<span id="cb1-10"><a href="#cb1-10"></a>  corrplot,</span>
<span id="cb1-11"><a href="#cb1-11"></a>  sjPlot,</span>
<span id="cb1-12"><a href="#cb1-12"></a>  scales,</span>
<span id="cb1-13"><a href="#cb1-13"></a>  GGally,</span>
<span id="cb1-14"><a href="#cb1-14"></a>  car,</span>
<span id="cb1-15"><a href="#cb1-15"></a>  forcats,</span>
<span id="cb1-16"><a href="#cb1-16"></a>  performance,</span>
<span id="cb1-17"><a href="#cb1-17"></a>  glmmTMB,</span>
<span id="cb1-18"><a href="#cb1-18"></a>  splines,</span>
<span id="cb1-19"><a href="#cb1-19"></a>  mgcv,</span>
<span id="cb1-20"><a href="#cb1-20"></a>  DHARMa,</span>
<span id="cb1-21"><a href="#cb1-21"></a>  zoo,</span>
<span id="cb1-22"><a href="#cb1-22"></a>  ggpubr,</span>
<span id="cb1-23"><a href="#cb1-23"></a>  ggridges,</span>
<span id="cb1-24"><a href="#cb1-24"></a>  caret,</span>
<span id="cb1-25"><a href="#cb1-25"></a>  rstatix,</span>
<span id="cb1-26"><a href="#cb1-26"></a>  Metrics,</span>
<span id="cb1-27"><a href="#cb1-27"></a>  mice,</span>
<span id="cb1-28"><a href="#cb1-28"></a>  missRanger,</span>
<span id="cb1-29"><a href="#cb1-29"></a>  ranger,</span>
<span id="cb1-30"><a href="#cb1-30"></a>  cocor,</span>
<span id="cb1-31"><a href="#cb1-31"></a>  multcompView,</span>
<span id="cb1-32"><a href="#cb1-32"></a>  lmtest,</span>
<span id="cb1-33"><a href="#cb1-33"></a>  aod,</span>
<span id="cb1-34"><a href="#cb1-34"></a>  pROC,</span>
<span id="cb1-35"><a href="#cb1-35"></a>  naniar,</span>
<span id="cb1-36"><a href="#cb1-36"></a>  glue,</span>
<span id="cb1-37"><a href="#cb1-37"></a>  viridis,</span>
<span id="cb1-38"><a href="#cb1-38"></a>  parallel</span>
<span id="cb1-39"><a href="#cb1-39"></a>)</span>
<span id="cb1-40"><a href="#cb1-40"></a></span>
<span id="cb1-41"><a href="#cb1-41"></a>report_theme <span class="ot">&lt;-</span> <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-43"><a href="#cb1-43"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-44"><a href="#cb1-44"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb1-45"><a href="#cb1-45"></a>    <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey40"</span>),</span>
<span id="cb1-46"><a href="#cb1-46"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey93"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb1-47"><a href="#cb1-47"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb1-48"><a href="#cb1-48"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>),</span>
<span id="cb1-49"><a href="#cb1-49"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">colour =</span> <span class="st">"grey50"</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb1-50"><a href="#cb1-50"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb1-51"><a href="#cb1-51"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb1-52"><a href="#cb1-52"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb1-53"><a href="#cb1-53"></a>  )</span>
<span id="cb1-54"><a href="#cb1-54"></a></span>
<span id="cb1-55"><a href="#cb1-55"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/weatherAUS.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-56"><a href="#cb1-56"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb1-57"><a href="#cb1-57"></a></span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"utils.R"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The package selection reflects the specific demands of meteorological data analysis. The core wrangling and visualisation toolkit (<code>tidyverse</code>, <code>janitor</code>, <code>kableExtra</code>) handles routine data manipulation. The modelling stack (<code>glmmTMB</code>, <code>DHARMa</code>, <code>splines</code>, <code>mgcv</code>) is assembled for the zero-inflated mixed-effects framework documented in later chapters. The imputation stack (<code>mice</code>) supports the Random Forest and chained imputation procedures described below. The missingness diagnostic stack (<code>naniar</code>, <code>glue</code>) supports the structural analysis in <a href="#sec-missingness-diagnostics" class="quarto-xref"><span>Section 2.3</span></a>. Libraries are loaded via <code>librarian</code>, which installs missing packages automatically and ensures reproducibility across environments.</p>
<hr>
</section>
<section id="initial-cleaning-and-standardisation" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="initial-cleaning-and-standardisation"><span class="header-section-number">2.2</span> Initial Cleaning and Standardisation</h2>
<p>The raw dataset undergoes three transformations before any missingness analysis or imputation.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>df_clean <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="at">month =</span> <span class="fu">as.factor</span>(<span class="fu">month</span>(date)),</span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="at">day =</span> <span class="fu">as.factor</span>(<span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-6"><a href="#cb2-6"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rainfall))</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a>df_clean <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Head of Cleaned Dataset"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<caption>Head of Cleaned Dataset</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">min_temp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">max_temp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rainfall</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">evaporation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sunshine</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">wind_gust_dir</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wind_gust_speed</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">wind_dir9am</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">wind_dir3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wind_speed9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wind_speed3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">humidity9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">humidity3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pressure9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pressure3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cloud9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cloud3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">temp9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">temp3pm</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rain_today</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rain_tomorrow</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">month</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">day</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2008-12-01</td>
<td style="text-align: left;">Albury</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">22.9</td>
<td style="text-align: right;">0.6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">W</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">W</td>
<td style="text-align: left;">WNW</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1007.7</td>
<td style="text-align: right;">1007.1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">16.9</td>
<td style="text-align: right;">21.8</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">Mon</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-12-02</td>
<td style="text-align: left;">Albury</td>
<td style="text-align: right;">7.4</td>
<td style="text-align: right;">25.1</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">WNW</td>
<td style="text-align: right;">44</td>
<td style="text-align: left;">NNW</td>
<td style="text-align: left;">WSW</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1010.6</td>
<td style="text-align: right;">1007.8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.2</td>
<td style="text-align: right;">24.3</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">Tue</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-12-03</td>
<td style="text-align: left;">Albury</td>
<td style="text-align: right;">12.9</td>
<td style="text-align: right;">25.7</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">WSW</td>
<td style="text-align: right;">46</td>
<td style="text-align: left;">W</td>
<td style="text-align: left;">WSW</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">1007.6</td>
<td style="text-align: right;">1008.7</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">23.2</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">Wed</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-12-04</td>
<td style="text-align: left;">Albury</td>
<td style="text-align: right;">9.2</td>
<td style="text-align: right;">28.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NE</td>
<td style="text-align: right;">24</td>
<td style="text-align: left;">SE</td>
<td style="text-align: left;">E</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1017.6</td>
<td style="text-align: right;">1012.8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">18.1</td>
<td style="text-align: right;">26.5</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">Thu</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-12-05</td>
<td style="text-align: left;">Albury</td>
<td style="text-align: right;">17.5</td>
<td style="text-align: right;">32.3</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">W</td>
<td style="text-align: right;">41</td>
<td style="text-align: left;">ENE</td>
<td style="text-align: left;">NW</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">1010.8</td>
<td style="text-align: right;">1006.0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">29.7</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">Fri</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-12-06</td>
<td style="text-align: left;">Albury</td>
<td style="text-align: right;">14.6</td>
<td style="text-align: right;">29.7</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">WNW</td>
<td style="text-align: right;">56</td>
<td style="text-align: left;">W</td>
<td style="text-align: left;">W</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">1009.2</td>
<td style="text-align: right;">1005.4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">20.6</td>
<td style="text-align: right;">28.9</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">Sat</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>df_clean <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">tail</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Tail of Cleaned Dataset"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<caption>Tail of Cleaned Dataset</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">min_temp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">max_temp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rainfall</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">evaporation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sunshine</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">wind_gust_dir</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wind_gust_speed</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">wind_dir9am</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">wind_dir3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wind_speed9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wind_speed3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">humidity9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">humidity3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pressure9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pressure3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cloud9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cloud3pm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">temp9am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">temp3pm</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rain_today</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rain_tomorrow</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">month</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">day</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2017-06-20</td>
<td style="text-align: left;">Uluru</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">21.8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">E</td>
<td style="text-align: right;">31</td>
<td style="text-align: left;">ESE</td>
<td style="text-align: left;">E</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1024.7</td>
<td style="text-align: right;">1021.2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9.4</td>
<td style="text-align: right;">20.9</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">Tue</td>
</tr>
<tr class="even">
<td style="text-align: left;">2017-06-21</td>
<td style="text-align: left;">Uluru</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: right;">23.4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">E</td>
<td style="text-align: right;">31</td>
<td style="text-align: left;">SE</td>
<td style="text-align: left;">ENE</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1024.6</td>
<td style="text-align: right;">1020.3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: right;">22.4</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">Wed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017-06-22</td>
<td style="text-align: left;">Uluru</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: right;">25.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NNW</td>
<td style="text-align: right;">22</td>
<td style="text-align: left;">SE</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">1023.5</td>
<td style="text-align: right;">1019.1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">10.9</td>
<td style="text-align: right;">24.5</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">Thu</td>
</tr>
<tr class="even">
<td style="text-align: left;">2017-06-23</td>
<td style="text-align: left;">Uluru</td>
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">26.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">37</td>
<td style="text-align: left;">SE</td>
<td style="text-align: left;">WNW</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1021.0</td>
<td style="text-align: right;">1016.8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.5</td>
<td style="text-align: right;">26.1</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">Fri</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017-06-24</td>
<td style="text-align: left;">Uluru</td>
<td style="text-align: right;">7.8</td>
<td style="text-align: right;">27.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">SE</td>
<td style="text-align: right;">28</td>
<td style="text-align: left;">SSE</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1019.4</td>
<td style="text-align: right;">1016.5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15.1</td>
<td style="text-align: right;">26.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">Sat</td>
</tr>
<tr class="even">
<td style="text-align: left;">2017-06-25</td>
<td style="text-align: left;">Uluru</td>
<td style="text-align: right;">14.9</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">ESE</td>
<td style="text-align: left;">ESE</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">1020.2</td>
<td style="text-align: right;">1017.9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15.0</td>
<td style="text-align: right;">20.9</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">Sun</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Column standardisation.</strong> All variable names are converted to <code>snake_case</code> via <code>janitor::clean_names()</code>, called at ingestion. This eliminates downstream ambiguity in variable references and ensures internal consistency across all chapters.</p>
<p><strong>Temporal feature extraction.</strong> The <code>date</code> column is typed as a <code>Date</code> object and two derived features are extracted: <code>month</code> (as a factor) and <code>day</code> (day of week, labelled). Month captures the seasonal structure of Australian precipitation; day of week is retained as a potential control variable for reporting artefacts in the raw data.</p>
<p><strong>Target filtering.</strong> Observations where <code>rainfall</code> is missing are removed. Records without a ground-truth rainfall measurement have no supervised learning value and cannot contribute to either the hurdle or the intensity component of the ZIG model.</p>
<hr>
</section>
<section id="sec-missingness-diagnostics" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-missingness-diagnostics"><span class="header-section-number">2.3</span> Missingness Diagnostics</h2>
<p>Before designing an imputation strategy, it is necessary to understand the mechanism and structure of the missing data. The choice between imputation methods depends critically on three questions: whether missingness is random with respect to other variables in the dataset, whether missing values cluster at specific locations or time periods, and whether the four most-affected variables fail independently or as a coordinated group. A strategy designed without answering these questions risks either under-imputing (discarding recoverable signal) or over-imputing (fabricating data in regions where recovery is not possible). The five analyses below provide the empirical basis for each design decision in the pipeline that follows.</p>
<section id="sec-co-missingness" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="sec-co-missingness"><span class="header-section-number">2.3.1</span> Co-missingness Structure</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>high_miss_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sunshine"</span>, <span class="st">"evaporation"</span>, <span class="st">"cloud3pm"</span>, <span class="st">"cloud9am"</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a>high_miss <span class="ot">&lt;-</span> high_miss_cols[high_miss_cols <span class="sc">%in%</span> <span class="fu">names</span>(df)]</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="fu">cat</span>(<span class="st">"High missingness variables:"</span>, <span class="fu">paste</span>(high_miss, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; High missingness variables: sunshine, evaporation, cloud3pm, cloud9am</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>miss_mat <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(high_miss)) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), is.na)) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="fu">apply</span>(<span class="dv">2</span>, as.integer)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a>intersection_matrix <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(miss_mat)</span>
<span id="cb6-8"><a href="#cb6-8"></a>total_miss_counts <span class="ot">&lt;-</span> <span class="fu">diag</span>(intersection_matrix)</span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a>pct_matrix <span class="ot">&lt;-</span> intersection_matrix <span class="sc">/</span> total_miss_counts <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb6-11"><a href="#cb6-11"></a></span>
<span id="cb6-12"><a href="#cb6-12"></a>co_missing_stats <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(pct_matrix)) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="fu">rename</span>(<span class="at">var1 =</span> Var1, <span class="at">var2 =</span> Var2, <span class="at">pct_co_miss =</span> Freq) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>  <span class="fu">filter</span>(var1 <span class="sc">!=</span> var2) <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pct_co_miss))</span>
<span id="cb6-16"><a href="#cb6-16"></a></span>
<span id="cb6-17"><a href="#cb6-17"></a>co_missing_stats <span class="sc">%&gt;%</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="at">msg =</span> <span class="fu">glue</span>(</span>
<span id="cb6-20"><a href="#cb6-20"></a>      <span class="st">"  {var1} -&gt; {var2}: {round(pct_co_miss, 1)}%  (when {var1} is missing, {var2} is missing)"</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>    )</span>
<span id="cb6-22"><a href="#cb6-22"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="#cb6-23"></a>  <span class="fu">pull</span>(msg) <span class="sc">%&gt;%</span></span>
<span id="cb6-24"><a href="#cb6-24"></a>  <span class="fu">walk</span>(cat, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   evaporation -&gt; sunshine: 93.2%  (when evaporation is missing, sunshine is missing) 
#&gt;   cloud9am -&gt; cloud3pm: 92.6%  (when cloud9am is missing, cloud3pm is missing) 
#&gt;   cloud3pm -&gt; cloud9am: 87.2%  (when cloud3pm is missing, cloud9am is missing) 
#&gt;   cloud9am -&gt; sunshine: 84.3%  (when cloud9am is missing, sunshine is missing) 
#&gt;   sunshine -&gt; evaporation: 83.8%  (when sunshine is missing, evaporation is missing) 
#&gt;   cloud3pm -&gt; sunshine: 82.5%  (when cloud3pm is missing, sunshine is missing) 
#&gt;   cloud9am -&gt; evaporation: 81.4%  (when cloud9am is missing, evaporation is missing) 
#&gt;   cloud3pm -&gt; evaporation: 78%  (when cloud3pm is missing, evaporation is missing) 
#&gt;   evaporation -&gt; cloud3pm: 73.7%  (when evaporation is missing, cloud3pm is missing) 
#&gt;   evaporation -&gt; cloud9am: 72.5%  (when evaporation is missing, cloud9am is missing) 
#&gt;   sunshine -&gt; cloud3pm: 70.1%  (when sunshine is missing, cloud3pm is missing) 
#&gt;   sunshine -&gt; cloud9am: 67.5%  (when sunshine is missing, cloud9am is missing)</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>co_missing_stats <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">kable</span>(</span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="at">caption =</span> <span class="st">"Conditional Co-missingness:</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">              when var1 is missing, what percentage of the time is var2 also missing?"</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="at">digits =</span> <span class="dv">1</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variable 1 (Missing)"</span>, <span class="st">"Variable 2"</span>, <span class="st">"Co-missing (%)"</span>)</span>
<span id="cb8-7"><a href="#cb8-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-co-missingness" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-co-missingness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.1: Conditional Co-missingness Matrix
</figcaption>
<div aria-describedby="tbl-co-missingness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped table-hover do-not-create-environment cell caption-top table-sm small">
<caption>Conditional Co-missingness: when var1 is missing, what percentage of the time is var2 also missing?</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable 1 (Missing)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable 2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Co-missing (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">evaporation</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">93.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">cloud9am</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">92.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">87.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">cloud9am</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">84.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sunshine</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">83.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">82.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cloud9am</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">81.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">78.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">evaporation</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">73.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">evaporation</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">72.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sunshine</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">70.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">sunshine</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">67.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>The co-missingness matrix (<a href="#tbl-co-missingness" class="quarto-xref">Table&nbsp;<span>2.1</span></a>) confirms that these four variables fail as a systematic cluster rather than independently. The dependencies are strongest between instrumental pairs: if evaporation is missing, there is a 93.2% probability that sunshine is also missing. Even the weakest relationship in the matrix (sunshine to cloud9am) retains a rate of 67.5%, which is nearly double what would be expected under random failure.</p>
<p>Under MCAR, the co-missing rates would be close to the marginal missingness rates of each variable, roughly 40 to 48%. Rates uniformly between 67% and 93% instead indicate a shared upstream cause: the instrumentation profile of each station. Sunshine recorders, evaporation pans, and cloud coverage sensors are deployed as a package, not individually. A station without one is very likely to lack the others. This is MNAR at the station level. The practical consequence for imputation is that treating the four variables as independently missing would be incorrect: their correlations when observed are available precisely because they fail together, and a multivariate imputation method that exploits those cross-variable relationships will outperform four separate univariate models.</p>
</section>
<section id="sec-temporal-structure" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="sec-temporal-structure"><span class="header-section-number">2.3.2</span> Temporal Structure and Structural Breaks</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>temporal_trend <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">mutate</span>(<span class="at">month_floor =</span> <span class="fu">floor_date</span>(date, <span class="st">"month"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">select</span>(month_floor, <span class="fu">any_of</span>(high_miss)) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="at">cols =</span> <span class="sc">-</span>month_floor,</span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="fu">group_by</span>(month_floor, variable) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  <span class="fu">summarise</span>(<span class="at">pct_missing =</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(value)) <span class="sc">*</span> <span class="dv">100</span>, <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="fu">ggplot</span>(</span>
<span id="cb9-13"><a href="#cb9-13"></a>  temporal_trend,</span>
<span id="cb9-14"><a href="#cb9-14"></a>  <span class="fu">aes</span>(<span class="at">x =</span> month_floor, <span class="at">y =</span> pct_missing)</span>
<span id="cb9-15"><a href="#cb9-15"></a>) <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">"grey80"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>  <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"#2C7BB6"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb9-19"><a href="#cb9-19"></a>    <span class="at">yintercept =</span> <span class="dv">50</span>,</span>
<span id="cb9-20"><a href="#cb9-20"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb9-21"><a href="#cb9-21"></a>    <span class="at">colour =</span> <span class="st">"grey50"</span>,</span>
<span id="cb9-22"><a href="#cb9-22"></a>    <span class="at">linewidth =</span> <span class="fl">0.4</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>  ) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb9-26"><a href="#cb9-26"></a>    <span class="at">date_breaks =</span> <span class="st">"2 years"</span>,</span>
<span id="cb9-27"><a href="#cb9-27"></a>    <span class="at">date_labels =</span> <span class="st">"%Y"</span>,</span>
<span id="cb9-28"><a href="#cb9-28"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="dv">0</span>)</span>
<span id="cb9-29"><a href="#cb9-29"></a>  ) <span class="sc">+</span></span>
<span id="cb9-30"><a href="#cb9-30"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb9-31"><a href="#cb9-31"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb9-32"><a href="#cb9-32"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>)</span>
<span id="cb9-33"><a href="#cb9-33"></a>  ) <span class="sc">+</span></span>
<span id="cb9-34"><a href="#cb9-34"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-35"><a href="#cb9-35"></a>    <span class="at">title =</span> <span class="st">"Temporal Structure of Missingness by Variable"</span>,</span>
<span id="cb9-36"><a href="#cb9-36"></a>    <span class="at">subtitle =</span> <span class="st">"Step changes indicate structural data collection breaks</span></span>
<span id="cb9-37"><a href="#cb9-37"></a><span class="st">                rather than random sensor failures"</span>,</span>
<span id="cb9-38"><a href="#cb9-38"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-39"><a href="#cb9-39"></a>    <span class="at">y =</span> <span class="st">"Missing (%)"</span>,</span>
<span id="cb9-40"><a href="#cb9-40"></a>    <span class="at">caption =</span> <span class="st">"Dashed line at 50%. Monthly aggregation."</span></span>
<span id="cb9-41"><a href="#cb9-41"></a>  ) <span class="sc">+</span></span>
<span id="cb9-42"><a href="#cb9-42"></a>  report_theme <span class="sc">+</span></span>
<span id="cb9-43"><a href="#cb9-43"></a>  <span class="fu">theme</span>(<span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-temporal-missingness" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-temporal-missingness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-data-prep_files/figure-html/fig-temporal-missingness-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-temporal-missingness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: Timeline of systematic missingness across the four high-missingness variables. The stepped increases visible particularly in sunshine and evaporation indicate structural breaks in data collection rather than random sensor failures.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The temporal analysis (<a href="#fig-temporal-missingness" class="quarto-xref">Figure&nbsp;<span>2.1</span></a>) confirms that missingness is not randomly distributed over time. The cloud cover variables maintain a roughly stable and high missingness rate across the observation window, consistent with a fixed set of stations never having recorded these measurements. The <code>sunshine</code> and <code>evaporation</code> variables show a distinct stepped pattern: missingness rises at specific breakpoints rather than fluctuating randomly, indicating that certain stations were decommissioned or that recording protocols changed at identifiable calendar dates.</p>
<p>This temporal structure has a direct implication for the interpolation stage of the pipeline. Linear interpolation is appropriate when a smooth trajectory can be inferred from values on either side of a gap. Extended contiguous gaps produced by a structural break have no valid upper boundary from which to interpolate, and filling them with temporal interpolation would create long synthetic sequences with no empirical anchor. The five-day interpolation cap set in Stage 1 of the pipeline is a direct response to this finding.</p>
</section>
<section id="sec-ghost-sensor" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="sec-ghost-sensor"><span class="header-section-number">2.3.3</span> Geographic Concentration: Ghost Sensor Identification</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>GHOST_THRESHOLD <span class="ot">&lt;-</span> <span class="fl">0.90</span></span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>location_summary <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  naniar<span class="sc">::</span><span class="fu">miss_var_summary</span>()</span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a>ghost_sensors <span class="ot">&lt;-</span> location_summary <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="fu">filter</span>(variable <span class="sc">%in%</span> high_miss, pct_miss <span class="sc">&gt;</span> GHOST_THRESHOLD <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pct_miss))</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a>ghost_sensors <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>  <span class="fu">kable</span>(</span>
<span id="cb10-13"><a href="#cb10-13"></a>    <span class="at">caption =</span> <span class="st">"Ghost Sensor Instances: Location-Variable Pairs </span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="st">               with &gt;90% Missingness"</span>,</span>
<span id="cb10-15"><a href="#cb10-15"></a>    <span class="at">digits =</span> <span class="dv">1</span>,</span>
<span id="cb10-16"><a href="#cb10-16"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Location"</span>, <span class="st">"Variable"</span>, <span class="st">"Missing (n)"</span>, <span class="st">"Missing (%)"</span>)</span>
<span id="cb10-17"><a href="#cb10-17"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Ghost Sensor Instances: Location-Variable Pairs with &gt;90% Missingness</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing (n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Albury</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Albury</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BadgerysCreek</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">BadgerysCreek</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BadgerysCreek</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">BadgerysCreek</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Newcastle</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Newcastle</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NorahHead</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3004</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">NorahHead</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3004</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NorahHead</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3004</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">NorahHead</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3004</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Penrith</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Penrith</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Penrith</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Penrith</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Richmond</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Wollongong</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wollongong</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tuggeranong</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tuggeranong</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tuggeranong</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tuggeranong</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3039</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">MountGinini</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MountGinini</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">MountGinini</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MountGinini</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ballarat</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ballarat</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bendigo</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nhil</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nhil</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nhil</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nhil</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dartmoor</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dartmoor</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GoldCoast</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">GoldCoast</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GoldCoast</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">GoldCoast</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adelaide</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3193</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelaide</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3193</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Witchcliffe</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Witchcliffe</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Witchcliffe</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Witchcliffe</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PearceRAAF</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3009</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">SalmonGums</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3001</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SalmonGums</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3001</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">SalmonGums</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3001</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SalmonGums</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3001</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Walpole</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3006</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Walpole</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3006</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Walpole</td>
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">3006</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Walpole</td>
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">3006</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Launceston</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3040</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Katherine</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Uluru</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Uluru</td>
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Launceston</td>
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">2899</td>
<td style="text-align: right;">95.4</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="st">"</span><span class="sc">\n</span><span class="st">Total ghost sensor instances identified: %d across %d locations</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">nrow</span>(ghost_sensors),</span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">n_distinct</span>(ghost_sensors<span class="sc">$</span>location)</span>
<span id="cb11-5"><a href="#cb11-5"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Total ghost sensor instances identified: 60 across 22 locations</code></pre>
</div>
</div>
<p>The location-level analysis identifies the specific station-variable pairs responsible for the bulk of the aggregate missingness. The top ten instances from the script output, all at exactly 100% missing, are as follows: Albury (<code>evaporation</code>, 3,040 observations; <code>sunshine</code>, 3,040), BadgerysCreek (<code>evaporation</code>, 3,009; <code>sunshine</code>, 3,009; <code>cloud9am</code>, 3,009; <code>cloud3pm</code>, 3,009), Newcastle (<code>evaporation</code>, 3,039; <code>sunshine</code>, 3,039), and NorahHead (<code>evaporation</code>, 3,004; <code>sunshine</code>, 3,004). At these stations, the instrument in question recorded a value on zero days across the entire observation window. These are not sensors experiencing intermittent failure; they are sensors that were never present or that were removed before the data collection period began.</p>
<p>The distinction between ghost sensors and ordinary missingness is consequential for imputation. For a gap of five to fifteen consecutive missing days, a Random Forest model can generate reasonable predictions by drawing on correlated variables at the same station and the same variable at nearby stations. For a gap spanning 3,000 or more consecutive observations, this extrapolation has no empirical support whatsoever: there is no observed value at that station and variable combination to anchor or validate the prediction. Values produced for these pairs would be statistically plausible by construction but would carry no physical information about what the instrument would have actually recorded. Ghost sensor pairs are identified before Stage 2 runs and flagged so that their imputed values can be treated with appropriate scepticism in downstream analysis.</p>
</section>
<section id="sec-weather-conditionality" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="sec-weather-conditionality"><span class="header-section-number">2.3.4</span> Weather-Conditionality of Sunshine Missingness</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"rainfall"</span>, <span class="st">"sunshine"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(df))) {</span>
<span id="cb13-2"><a href="#cb13-2"></a>  weather_missing_stats <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rainfall)) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="fu">mutate</span>(<span class="at">is_rainy =</span> <span class="fu">if_else</span>(rainfall <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="st">"Rainy (&gt;1mm)"</span>, <span class="st">"Dry (&lt;=1mm)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="fu">group_by</span>(is_rainy) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="fu">summarise</span>(</span>
<span id="cb13-7"><a href="#cb13-7"></a>      <span class="at">n_obs =</span> <span class="fu">n</span>(),</span>
<span id="cb13-8"><a href="#cb13-8"></a>      <span class="at">pct_sunshine_missing =</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(sunshine)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb13-9"><a href="#cb13-9"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>    )</span>
<span id="cb13-11"><a href="#cb13-11"></a></span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="fu">print</span>(weather_missing_stats)</span>
<span id="cb13-13"><a href="#cb13-13"></a></span>
<span id="cb13-14"><a href="#cb13-14"></a>  weather_missing_stats <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>    <span class="fu">kable</span>(</span>
<span id="cb13-16"><a href="#cb13-16"></a>      <span class="at">caption =</span> <span class="st">"Sunshine Missingness Rate by Daily Rainfall Status"</span>,</span>
<span id="cb13-17"><a href="#cb13-17"></a>      <span class="at">digits =</span> <span class="dv">1</span>,</span>
<span id="cb13-18"><a href="#cb13-18"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Day Type"</span>, <span class="st">"Observations (n)"</span>, <span class="st">"Sunshine Missing (%)"</span>)</span>
<span id="cb13-19"><a href="#cb13-19"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb13-20"><a href="#cb13-20"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-21"><a href="#cb13-21"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 2 × 3
#&gt;   is_rainy      n_obs pct_sunshine_missing
#&gt;   &lt;chr&gt;         &lt;int&gt;                &lt;dbl&gt;
#&gt; 1 Dry (&lt;=1mm)  110319                 47.8
#&gt; 2 Rainy (&gt;1mm)  31880                 47.2</code></pre>
</div>
<div id="tbl-sunshine-mcar-test" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sunshine-mcar-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.2: Sunshine Missingness Rate by Daily Rainfall Status
</figcaption>
<div aria-describedby="tbl-sunshine-mcar-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped table-hover do-not-create-environment cell caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Day Type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Observations (n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Sunshine Missing (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dry (&lt;=1mm)</td>
<td style="text-align: right;">110319</td>
<td style="text-align: right;">47.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rainy (&gt;1mm)</td>
<td style="text-align: right;">31880</td>
<td style="text-align: right;">47.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  naniar<span class="sc">::</span><span class="fu">bind_shadow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">filter</span>(rainfall <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> rainfall <span class="sc">&lt;</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rainfall, <span class="at">fill =</span> sunshine_NA, <span class="at">colour =</span> sunshine_NA)) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"!NA"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>, <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>),</span>
<span id="cb15-8"><a href="#cb15-8"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"!NA"</span> <span class="ot">=</span> <span class="st">"Present"</span>, <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"Missing"</span>)</span>
<span id="cb15-9"><a href="#cb15-9"></a>  ) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb15-11"><a href="#cb15-11"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"!NA"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>, <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>),</span>
<span id="cb15-12"><a href="#cb15-12"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"!NA"</span> <span class="ot">=</span> <span class="st">"Present"</span>, <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"Missing"</span>),</span>
<span id="cb15-13"><a href="#cb15-13"></a>    <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb15-14"><a href="#cb15-14"></a>  ) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-18"><a href="#cb15-18"></a>    <span class="at">title =</span> <span class="st">"Sunshine Missingness is Not Rainfall-Conditional"</span>,</span>
<span id="cb15-19"><a href="#cb15-19"></a>    <span class="at">subtitle =</span> <span class="st">"Rainfall distributions are near-identical whether sunshine data</span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="st">                is present or absent,</span><span class="sc">\n</span><span class="st">confirming missingness is driven by station</span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="st">                instrumentation, not weather conditions"</span>,</span>
<span id="cb15-22"><a href="#cb15-22"></a>    <span class="at">x =</span> <span class="st">"Daily Rainfall (mm)"</span>,</span>
<span id="cb15-23"><a href="#cb15-23"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb15-24"><a href="#cb15-24"></a>    <span class="at">fill =</span> <span class="st">"Sunshine Data"</span>,</span>
<span id="cb15-25"><a href="#cb15-25"></a>    <span class="at">caption =</span> <span class="st">"Restricted to rainfall &gt; 0 and &lt; 50 mm. Kernel density estimate."</span></span>
<span id="cb15-26"><a href="#cb15-26"></a>  ) <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27"></a>  report_theme</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-sunshine-rainfall-density" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sunshine-rainfall-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-data-prep_files/figure-html/fig-sunshine-rainfall-density-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sunshine-rainfall-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: Density of rainfall amounts on days where sunshine data is present versus missing. The near-identical distributions confirm that sunshine missingness is not weather-conditional: the same stations are missing sunshine on both dry and rainy days because the instrument was simply not installed, not because it failed during precipitation events.
</figcaption>
</figure>
</div>
</div>
</div>
<p>A specific concern when imputing a predictor variable is outcome-related missingness: if sunshine sensors failed more often on rainy days, then the imputed values would carry a directional signal about the target variable and could introduce bias into the training data.</p>
<p>The empirical test refutes this concern. The table output (<a href="#tbl-sunshine-mcar-test" class="quarto-xref">Table&nbsp;<span>2.2</span></a>) reports a sunshine missing rate of 47.8% on 110,319 dry days (rainfall at most 1 mm) and 47.2% on 31,880 rainy days (rainfall above 1 mm), a difference of 0.6 percentage points. The density plot (<a href="#fig-sunshine-rainfall-density" class="quarto-xref">Figure&nbsp;<span>2.2</span></a>) makes the same point visually: the distribution of rainfall amounts on days with missing sunshine and on days with present sunshine are indistinguishable across the full range from 0 to 50 mm. The slight visual offset in the figure reflects not a systematic pattern but the difference in the sizes of the two groups.</p>
<p>Sunshine missingness is station-conditional rather than weather-conditional. The same stations record missing sunshine on both dry and rainy days at nearly identical rates, because the instrument is absent from those stations entirely. This finding clears the imputation path: there is no outcome-related confound to correct for.</p>
</section>
<section id="missing-pattern-structure" class="level3" data-number="2.3.5">
<h3 data-number="2.3.5" class="anchored" data-anchor-id="missing-pattern-structure"><span class="header-section-number">2.3.5</span> Missing Pattern Structure</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">cat</span>(<span class="st">"Missing pattern combinations:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Missing pattern combinations:</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(high_miss)) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  naniar<span class="sc">::</span><span class="fu">miss_case_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">print</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 5 × 3
#&gt;   n_miss_in_case n_cases pct_cases
#&gt;            &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;
#&gt; 1              0   62566     43.0 
#&gt; 2              1   10525      7.24
#&gt; 3              2   20376     14.0 
#&gt; 4              3   11378      7.82
#&gt; 5              4   40615     27.9</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(high_miss)) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  naniar<span class="sc">::</span><span class="fu">miss_case_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="fu">kable</span>(</span>
<span id="cb20-5"><a href="#cb20-5"></a>    <span class="at">caption =</span> <span class="st">"Distribution of Missing Variable Count per Observation"</span>,</span>
<span id="cb20-6"><a href="#cb20-6"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb20-7"><a href="#cb20-7"></a>      <span class="st">"Variables Missing (of 4)"</span>,</span>
<span id="cb20-8"><a href="#cb20-8"></a>      <span class="st">"Observations (n)"</span>,</span>
<span id="cb20-9"><a href="#cb20-9"></a>      <span class="st">"Percentage (%)"</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>    )</span>
<span id="cb20-11"><a href="#cb20-11"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Distribution of Missing Variable Count per Observation</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Variables Missing (of 4)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Observations (n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Percentage (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">62566</td>
<td style="text-align: right;">43.012512</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">10525</td>
<td style="text-align: right;">7.235666</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">20376</td>
<td style="text-align: right;">14.007975</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">11378</td>
<td style="text-align: right;">7.822082</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">40615</td>
<td style="text-align: right;">27.921765</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The case-level output from the script reveals a strongly bimodal structure across five distinct patterns. Of all observations: 62,566 (43.0%) have none of the four variables missing; 10,525 (7.2%) have exactly one missing; 20,376 (14.0%) have exactly two missing; 11,378 (7.8%) have exactly three missing; and 40,615 (27.9%) have all four missing simultaneously. The two endpoint categories, zero missing and all four missing, together account for 70.9% of all observations.</p>
<p>The 27.9% with complete simultaneous missingness corresponds directly to the ghost sensor stations identified in <a href="#sec-ghost-sensor" class="quarto-xref"><span>Section 2.3.3</span></a>. For these observations, no imputation is supportable and the values remain missing after the pipeline. The 43.0% with no missingness require no intervention. The substantive imputation work is concentrated in the remaining 29.1% across the three intermediate patterns, where partial instrumentation means that correlated predictors are available to inform the Random Forest estimates. The bimodal structure also confirms that the co-missingness finding is not a statistical artifact: observations genuinely tend to be fully instrumented or minimally instrumented, not randomly partially instrumented.</p>
<hr>
</section>
</section>
<section id="sec-imputation-pipeline" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-imputation-pipeline"><span class="header-section-number">2.4</span> Imputation Pipeline</h2>
<p>The diagnostic evidence from <a href="#sec-missingness-diagnostics" class="quarto-xref"><span>Section 2.3</span></a> motivates each design decision in the imputation pipeline. Missingness is station-level rather than weather-conditional (<a href="#sec-weather-conditionality" class="quarto-xref"><span>Section 2.3.4</span></a>), temporally structured with extended contiguous gaps rather than random scatter (<a href="#sec-temporal-structure" class="quarto-xref"><span>Section 2.3.2</span></a>), and co-located across variables at the station level (<a href="#sec-co-missingness" class="quarto-xref"><span>Section 2.3.1</span></a>). These properties rule out simple listwise deletion and mean imputation. They call for a pipeline that respects temporal continuity for smoothly-evolving variables, exploits cross-variable correlations for the structured variables, and declines to impute where the data is genuinely unrecoverable.</p>
<section id="stage-1-temporal-interpolation" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="stage-1-temporal-interpolation"><span class="header-section-number">2.4.1</span> Stage 1: Temporal Interpolation</h3>
<p>The eight variables with smooth day-to-day trajectories minimum and maximum temperature, morning and afternoon temperature, morning and afternoon pressure, and morning and afternoon humidity are imputed via linear interpolation grouped by location, bounded by a five-day maximum gap. The five-day cap is set directly in response to the temporal structural break finding: gaps of up to five days lie within a regime where the values at both boundaries sufficiently constrain the trajectory, while longer gaps are associated with structural collection failures that interpolation cannot safely bridge.</p>
</section>
<section id="stage-2-multivariate-imputation-via-predictive-mean-matching-and-random-forest" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="stage-2-multivariate-imputation-via-predictive-mean-matching-and-random-forest"><span class="header-section-number">2.4.2</span> Stage 2: Multivariate Imputation via Predictive Mean Matching and Random Forest</h3>
<p>Remaining gaps in <code>sunshine</code>, <code>evaporation</code>, <code>cloud9am</code>, <code>cloud3pm</code>, and the three wind direction variables are addressed using <code>mice</code> with method assignments differentiated by variable type.</p>
<p>The four continuous atmospheric variables (<code>sunshine</code>, <code>evaporation</code>, <code>cloud9am</code>, <code>cloud3pm</code>) are imputed using predictive mean matching (PMM). PMM draws imputed values from a pool of observed donor observations whose predicted values are closest to the predicted value of the missing case, rather than using the model prediction directly. This has two practical advantages over a point-prediction method for these variables. First, PMM is constrained to return values that exist in the observed data, which enforces physical bounds without requiring explicit constraints. Second, the stochastic donor draw introduces genuine between-imputation variability, which is necessary for valid Rubin’s Rules variance decomposition downstream. Each variable is imputed from a physically motivated predictor set:</p>
<ul>
<li><strong>Cloud cover</strong> (<code>cloud9am</code>, <code>cloud3pm</code>) from morning and afternoon humidity, morning pressure, location, and month.</li>
<li><strong>Sunshine</strong> from cloud cover at both observation times, maximum temperature, afternoon humidity, location, and month.</li>
<li><strong>Evaporation</strong> from wind gust speed, maximum temperature, afternoon humidity, sunshine, location, and month.</li>
</ul>
<p>The three wind direction variables (<code>wind_gust_dir</code>, <code>wind_dir9am</code>, <code>wind_dir3pm</code>) are imputed using Random Forest. Wind direction is a multi-class unordered categorical variable with sixteen compass-point levels. PMM is not appropriate for unordered factors because it imposes an implicit numeric ordering on the donor matching step. Random Forest handles the multi-class non-ordinal structure natively by splitting on class membership rather than on numeric distance. Each wind direction variable is conditioned on its temporally matched wind speed and pressure readings: gust direction from gust speed and afternoon pressure, morning direction from morning speed and morning pressure, and afternoon direction from afternoon speed and afternoon pressure. This preserves the physical coupling between concurrent wind speed and direction measurements.</p>
<p>The use of targeted predictor sets for all variables is motivated directly by the co-missingness finding in <a href="#sec-co-missingness" class="quarto-xref"><span>Section 2.3.1</span></a>. Because the four atmospheric variables tend to be absent together at the station level, their cross-variable correlations when observed are strong and reliable signals for imputation. Restricting each variable’s predictor set to physically motivated covariates exploits this structure while reducing the risk of imputing on spurious correlations introduced by including variables that carry no physical relationship to the target.</p>
</section>
<section id="ghost-sensor-flagging" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="ghost-sensor-flagging"><span class="header-section-number">2.4.3</span> Ghost Sensor Flagging</h3>
<p>Before Stage 2 runs, all station-variable pairs identified in <a href="#sec-ghost-sensor" class="quarto-xref"><span>Section 2.3.3</span></a> as ghost sensors (more than 90% missing across the full observation window) are catalogued and binary missingness flags are attached to the data (<code>sunshine_imp_flagged</code>, <code>evap_imp_flagged</code>, <code>cloud3pm_imp_flagged</code>, <code>cloud9am_imp_flagged</code>). These flags serve two purposes: they are excluded from the MICE predictor matrix so they cannot contaminate the imputation model, and they remain in the final dataset as explicit markers of which values are extrapolated with no empirical anchor at the station level. The raw date column is also excluded from the predictor matrix to prevent temporal data leakage. Neither PMM nor Random Forest has empirical support for predicting values at a station where an instrument was never present; the flags make this provenance transparent for any downstream analysis that needs to account for it.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>clean_and_impute_weather <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb21-2"><a href="#cb21-2"></a>  MAXGAP <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>  GHOST_THRESHOLD <span class="ot">&lt;-</span> <span class="fl">0.90</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  M <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>    <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>    <span class="fu">mutate</span>(</span>
<span id="cb21-9"><a href="#cb21-9"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb21-10"><a href="#cb21-10"></a>      <span class="at">month =</span> <span class="fu">as.factor</span>(<span class="fu">month</span>(date)),</span>
<span id="cb21-11"><a href="#cb21-11"></a>      <span class="at">day =</span> <span class="fu">as.factor</span>(<span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb21-12"><a href="#cb21-12"></a>      <span class="at">day_of_year =</span> <span class="fu">yday</span>(date),</span>
<span id="cb21-13"><a href="#cb21-13"></a>      <span class="at">wind_gust_dir =</span> <span class="fu">as.factor</span>(wind_gust_dir),</span>
<span id="cb21-14"><a href="#cb21-14"></a>      <span class="at">wind_dir9am =</span> <span class="fu">as.factor</span>(wind_dir9am),</span>
<span id="cb21-15"><a href="#cb21-15"></a>      <span class="at">wind_dir3pm =</span> <span class="fu">as.factor</span>(wind_dir3pm),</span>
<span id="cb21-16"><a href="#cb21-16"></a>      <span class="at">rain_today =</span> <span class="fu">as.factor</span>(rain_today),</span>
<span id="cb21-17"><a href="#cb21-17"></a>      <span class="at">location =</span> <span class="fu">as.factor</span>(location)</span>
<span id="cb21-18"><a href="#cb21-18"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb21-19"><a href="#cb21-19"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rainfall)) <span class="sc">%&gt;%</span></span>
<span id="cb21-20"><a href="#cb21-20"></a>    <span class="fu">select</span>(<span class="sc">-</span>rain_tomorrow)</span>
<span id="cb21-21"><a href="#cb21-21"></a></span>
<span id="cb21-22"><a href="#cb21-22"></a>  <span class="co"># Interpolation</span></span>
<span id="cb21-23"><a href="#cb21-23"></a>  interp_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb21-24"><a href="#cb21-24"></a>    <span class="st">"min_temp"</span>,</span>
<span id="cb21-25"><a href="#cb21-25"></a>    <span class="st">"max_temp"</span>,</span>
<span id="cb21-26"><a href="#cb21-26"></a>    <span class="st">"temp9am"</span>,</span>
<span id="cb21-27"><a href="#cb21-27"></a>    <span class="st">"temp3pm"</span>,</span>
<span id="cb21-28"><a href="#cb21-28"></a>    <span class="st">"pressure9am"</span>,</span>
<span id="cb21-29"><a href="#cb21-29"></a>    <span class="st">"pressure3pm"</span>,</span>
<span id="cb21-30"><a href="#cb21-30"></a>    <span class="st">"humidity9am"</span>,</span>
<span id="cb21-31"><a href="#cb21-31"></a>    <span class="st">"humidity3pm"</span></span>
<span id="cb21-32"><a href="#cb21-32"></a>  )</span>
<span id="cb21-33"><a href="#cb21-33"></a></span>
<span id="cb21-34"><a href="#cb21-34"></a>  df_interp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb21-35"><a href="#cb21-35"></a>    <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb21-36"><a href="#cb21-36"></a>    <span class="fu">arrange</span>(date, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-37"><a href="#cb21-37"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb21-38"><a href="#cb21-38"></a>      <span class="fu">all_of</span>(interp_vars),</span>
<span id="cb21-39"><a href="#cb21-39"></a>      <span class="sc">~</span> <span class="fu">na.approx</span>(., <span class="at">maxgap =</span> MAXGAP, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">rule =</span> <span class="dv">1</span>)</span>
<span id="cb21-40"><a href="#cb21-40"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb21-41"><a href="#cb21-41"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb21-42"><a href="#cb21-42"></a></span>
<span id="cb21-43"><a href="#cb21-43"></a>  <span class="co"># Flag ghost vars</span></span>
<span id="cb21-44"><a href="#cb21-44"></a>  ghost_prone_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sunshine"</span>, <span class="st">"evaporation"</span>, <span class="st">"cloud3pm"</span>, <span class="st">"cloud9am"</span>)</span>
<span id="cb21-45"><a href="#cb21-45"></a></span>
<span id="cb21-46"><a href="#cb21-46"></a>  ghost_pairs <span class="ot">&lt;-</span> df_interp <span class="sc">%&gt;%</span></span>
<span id="cb21-47"><a href="#cb21-47"></a>    <span class="fu">select</span>(location, <span class="fu">all_of</span>(ghost_prone_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb21-48"><a href="#cb21-48"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb21-49"><a href="#cb21-49"></a>      <span class="at">cols =</span> <span class="fu">all_of</span>(ghost_prone_vars),</span>
<span id="cb21-50"><a href="#cb21-50"></a>      <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb21-51"><a href="#cb21-51"></a>      <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb21-52"><a href="#cb21-52"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb21-53"><a href="#cb21-53"></a>    <span class="fu">group_by</span>(location, variable) <span class="sc">%&gt;%</span></span>
<span id="cb21-54"><a href="#cb21-54"></a>    <span class="fu">summarise</span>(<span class="at">miss_rate =</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(value)) <span class="sc">*</span> <span class="dv">100</span>, <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-55"><a href="#cb21-55"></a>    <span class="fu">filter</span>(miss_rate <span class="sc">&gt;</span> (GHOST_THRESHOLD <span class="sc">*</span> <span class="dv">100</span>))</span>
<span id="cb21-56"><a href="#cb21-56"></a></span>
<span id="cb21-57"><a href="#cb21-57"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Found %d ghost sensor instances:"</span>, <span class="fu">nrow</span>(ghost_pairs)))</span>
<span id="cb21-58"><a href="#cb21-58"></a></span>
<span id="cb21-59"><a href="#cb21-59"></a>  df_flagged <span class="ot">&lt;-</span> df_interp <span class="sc">%&gt;%</span></span>
<span id="cb21-60"><a href="#cb21-60"></a>    <span class="fu">mutate</span>(</span>
<span id="cb21-61"><a href="#cb21-61"></a>      <span class="at">sunshine_imp_flagged =</span> <span class="fu">as.integer</span>(<span class="fu">is.na</span>(sunshine)),</span>
<span id="cb21-62"><a href="#cb21-62"></a>      <span class="at">evap_imp_flagged =</span> <span class="fu">as.integer</span>(<span class="fu">is.na</span>(evaporation)),</span>
<span id="cb21-63"><a href="#cb21-63"></a>      <span class="at">cloud3pm_imp_flagged =</span> <span class="fu">as.integer</span>(<span class="fu">is.na</span>(cloud3pm)),</span>
<span id="cb21-64"><a href="#cb21-64"></a>      <span class="at">cloud9am_imp_flagged =</span> <span class="fu">as.integer</span>(<span class="fu">is.na</span>(cloud9am))</span>
<span id="cb21-65"><a href="#cb21-65"></a>    )</span>
<span id="cb21-66"><a href="#cb21-66"></a></span>
<span id="cb21-67"><a href="#cb21-67"></a>  <span class="co"># MICE setup</span></span>
<span id="cb21-68"><a href="#cb21-68"></a>  wind_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"wind_gust_dir"</span>, <span class="st">"wind_dir9am"</span>, <span class="st">"wind_dir3pm"</span>)</span>
<span id="cb21-69"><a href="#cb21-69"></a></span>
<span id="cb21-70"><a href="#cb21-70"></a>  init <span class="ot">&lt;-</span> <span class="fu">mice</span>(df_flagged, <span class="at">maxit =</span> <span class="dv">0</span>)</span>
<span id="cb21-71"><a href="#cb21-71"></a>  pred <span class="ot">&lt;-</span> init<span class="sc">$</span>predictorMatrix</span>
<span id="cb21-72"><a href="#cb21-72"></a>  meth <span class="ot">&lt;-</span> init<span class="sc">$</span>method</span>
<span id="cb21-73"><a href="#cb21-73"></a></span>
<span id="cb21-74"><a href="#cb21-74"></a>  pred[,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-75"><a href="#cb21-75"></a></span>
<span id="cb21-76"><a href="#cb21-76"></a>  meth[ghost_prone_vars] <span class="ot">&lt;-</span> <span class="st">"pmm"</span></span>
<span id="cb21-77"><a href="#cb21-77"></a>  meth[wind_vars] <span class="ot">&lt;-</span> <span class="st">"rf"</span></span>
<span id="cb21-78"><a href="#cb21-78"></a></span>
<span id="cb21-79"><a href="#cb21-79"></a>  sun_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb21-80"><a href="#cb21-80"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb21-81"><a href="#cb21-81"></a>    <span class="fu">c</span>(<span class="st">"cloud9am"</span>, <span class="st">"cloud3pm"</span>, <span class="st">"max_temp"</span>, <span class="st">"humidity3pm"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb21-82"><a href="#cb21-82"></a>  )</span>
<span id="cb21-83"><a href="#cb21-83"></a>  evap_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb21-84"><a href="#cb21-84"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb21-85"><a href="#cb21-85"></a>    <span class="fu">c</span>(</span>
<span id="cb21-86"><a href="#cb21-86"></a>      <span class="st">"wind_gust_speed"</span>,</span>
<span id="cb21-87"><a href="#cb21-87"></a>      <span class="st">"max_temp"</span>,</span>
<span id="cb21-88"><a href="#cb21-88"></a>      <span class="st">"humidity3pm"</span>,</span>
<span id="cb21-89"><a href="#cb21-89"></a>      <span class="st">"sunshine"</span>,</span>
<span id="cb21-90"><a href="#cb21-90"></a>      <span class="st">"location"</span>,</span>
<span id="cb21-91"><a href="#cb21-91"></a>      <span class="st">"month"</span></span>
<span id="cb21-92"><a href="#cb21-92"></a>    )</span>
<span id="cb21-93"><a href="#cb21-93"></a>  )</span>
<span id="cb21-94"><a href="#cb21-94"></a>  cloud_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb21-95"><a href="#cb21-95"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb21-96"><a href="#cb21-96"></a>    <span class="fu">c</span>(<span class="st">"humidity9am"</span>, <span class="st">"humidity3pm"</span>, <span class="st">"pressure9am"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb21-97"><a href="#cb21-97"></a>  )</span>
<span id="cb21-98"><a href="#cb21-98"></a>  wind_gust_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb21-99"><a href="#cb21-99"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb21-100"><a href="#cb21-100"></a>    <span class="fu">c</span>(<span class="st">"wind_gust_speed"</span>, <span class="st">"pressure3pm"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb21-101"><a href="#cb21-101"></a>  )</span>
<span id="cb21-102"><a href="#cb21-102"></a>  wind_9am_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb21-103"><a href="#cb21-103"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb21-104"><a href="#cb21-104"></a>    <span class="fu">c</span>(<span class="st">"wind_speed9am"</span>, <span class="st">"pressure9am"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb21-105"><a href="#cb21-105"></a>  )</span>
<span id="cb21-106"><a href="#cb21-106"></a>  wind_3pm_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb21-107"><a href="#cb21-107"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb21-108"><a href="#cb21-108"></a>    <span class="fu">c</span>(<span class="st">"wind_speed3pm"</span>, <span class="st">"pressure3pm"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb21-109"><a href="#cb21-109"></a>  )</span>
<span id="cb21-110"><a href="#cb21-110"></a></span>
<span id="cb21-111"><a href="#cb21-111"></a>  <span class="cf">if</span> (<span class="st">"sunshine"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb21-112"><a href="#cb21-112"></a>    pred[<span class="st">"sunshine"</span>, sun_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-113"><a href="#cb21-113"></a>  }</span>
<span id="cb21-114"><a href="#cb21-114"></a>  <span class="cf">if</span> (<span class="st">"evaporation"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb21-115"><a href="#cb21-115"></a>    pred[<span class="st">"evaporation"</span>, evap_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-116"><a href="#cb21-116"></a>  }</span>
<span id="cb21-117"><a href="#cb21-117"></a>  <span class="cf">if</span> (<span class="st">"cloud9am"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb21-118"><a href="#cb21-118"></a>    pred[<span class="st">"cloud9am"</span>, cloud_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-119"><a href="#cb21-119"></a>  }</span>
<span id="cb21-120"><a href="#cb21-120"></a>  <span class="cf">if</span> (<span class="st">"cloud3pm"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb21-121"><a href="#cb21-121"></a>    pred[<span class="st">"cloud3pm"</span>, cloud_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-122"><a href="#cb21-122"></a>  }</span>
<span id="cb21-123"><a href="#cb21-123"></a>  <span class="cf">if</span> (<span class="st">"wind_gust_dir"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb21-124"><a href="#cb21-124"></a>    pred[<span class="st">"wind_gust_dir"</span>, wind_gust_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-125"><a href="#cb21-125"></a>  }</span>
<span id="cb21-126"><a href="#cb21-126"></a>  <span class="cf">if</span> (<span class="st">"wind_dir9am"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb21-127"><a href="#cb21-127"></a>    pred[<span class="st">"wind_dir9am"</span>, wind_9am_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-128"><a href="#cb21-128"></a>  }</span>
<span id="cb21-129"><a href="#cb21-129"></a>  <span class="cf">if</span> (<span class="st">"wind_dir3pm"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb21-130"><a href="#cb21-130"></a>    pred[<span class="st">"wind_dir3pm"</span>, wind_3pm_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-131"><a href="#cb21-131"></a>  }</span>
<span id="cb21-132"><a href="#cb21-132"></a></span>
<span id="cb21-133"><a href="#cb21-133"></a>  ignore_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"_imp_flagged$|^date$"</span>, <span class="fu">colnames</span>(pred), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-134"><a href="#cb21-134"></a>  pred[, ignore_cols] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-135"><a href="#cb21-135"></a></span>
<span id="cb21-136"><a href="#cb21-136"></a>  <span class="co"># Parallel imputation with exact m allocation across cores</span></span>
<span id="cb21-137"><a href="#cb21-137"></a>  n_cores <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>L, <span class="fu">min</span>(<span class="fu">as.integer</span>(parallel<span class="sc">::</span><span class="fu">detectCores</span>()), <span class="fu">as.integer</span>(M)))</span>
<span id="cb21-138"><a href="#cb21-138"></a>  m_split <span class="ot">&lt;-</span> <span class="fu">rep</span>(M <span class="sc">%/%</span> n_cores, n_cores)</span>
<span id="cb21-139"><a href="#cb21-139"></a>  <span class="cf">if</span> ((M <span class="sc">%%</span> n_cores) <span class="sc">&gt;</span> <span class="dv">0</span>L) {</span>
<span id="cb21-140"><a href="#cb21-140"></a>    m_split[<span class="fu">seq_len</span>(M <span class="sc">%%</span> n_cores)] <span class="ot">&lt;-</span> m_split[<span class="fu">seq_len</span>(M <span class="sc">%%</span> n_cores)] <span class="sc">+</span> <span class="dv">1</span>L</span>
<span id="cb21-141"><a href="#cb21-141"></a>  }</span>
<span id="cb21-142"><a href="#cb21-142"></a></span>
<span id="cb21-143"><a href="#cb21-143"></a>  seeds <span class="ot">&lt;-</span> <span class="dv">123</span> <span class="sc">+</span> <span class="fu">seq_len</span>(n_cores) <span class="sc">-</span> <span class="dv">1</span>L</span>
<span id="cb21-144"><a href="#cb21-144"></a></span>
<span id="cb21-145"><a href="#cb21-145"></a>  imp_list <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">mclapply</span>(</span>
<span id="cb21-146"><a href="#cb21-146"></a>    <span class="fu">seq_len</span>(n_cores),</span>
<span id="cb21-147"><a href="#cb21-147"></a>    <span class="cf">function</span>(i) {</span>
<span id="cb21-148"><a href="#cb21-148"></a>      <span class="fu">mice</span>(</span>
<span id="cb21-149"><a href="#cb21-149"></a>        df_flagged,</span>
<span id="cb21-150"><a href="#cb21-150"></a>        <span class="at">method =</span> meth,</span>
<span id="cb21-151"><a href="#cb21-151"></a>        <span class="at">predictorMatrix =</span> pred,</span>
<span id="cb21-152"><a href="#cb21-152"></a>        <span class="at">m =</span> m_split[i],</span>
<span id="cb21-153"><a href="#cb21-153"></a>        <span class="at">maxit =</span> <span class="dv">5</span>,</span>
<span id="cb21-154"><a href="#cb21-154"></a>        <span class="at">seed =</span> seeds[i],</span>
<span id="cb21-155"><a href="#cb21-155"></a>        <span class="at">printFlag =</span> <span class="cn">FALSE</span></span>
<span id="cb21-156"><a href="#cb21-156"></a>      )</span>
<span id="cb21-157"><a href="#cb21-157"></a>    },</span>
<span id="cb21-158"><a href="#cb21-158"></a>    <span class="at">mc.cores =</span> n_cores</span>
<span id="cb21-159"><a href="#cb21-159"></a>  )</span>
<span id="cb21-160"><a href="#cb21-160"></a></span>
<span id="cb21-161"><a href="#cb21-161"></a>  <span class="co"># Merge all mids objects into one for MI inference</span></span>
<span id="cb21-162"><a href="#cb21-162"></a>  imp_merged <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(ibind, imp_list)</span>
<span id="cb21-163"><a href="#cb21-163"></a>  <span class="fu">return</span>(imp_merged)</span>
<span id="cb21-164"><a href="#cb21-164"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>imp_mids <span class="ot">&lt;-</span> <span class="fu">clean_and_impute_weather</span>(df)</span>
<span id="cb22-2"><a href="#cb22-2"></a>df_final <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp_mids, <span class="at">action =</span> <span class="dv">1</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">write_csv</span>(df_final, <span class="st">"data/df_final.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<hr>
</section>
</section>
<section id="post-imputation-dataset-properties" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="post-imputation-dataset-properties"><span class="header-section-number">2.5</span> Post-Imputation Dataset Properties</h2>
<p>The two-stage pipeline produces a dataset whose properties are each traceable to a specific finding from the diagnostic analysis in <a href="#sec-missingness-diagnostics" class="quarto-xref"><span>Section 2.3</span></a>.</p>
<p><strong>Retention without fabrication.</strong> No observations are discarded on the basis of partial missingness. The 27.9% of observations with all four target variables simultaneously absent are retained with those variables still missing, consistent with the ghost sensor finding that no empirically supportable imputation is possible for them.</p>
<p><strong>Temporal coherence.</strong> The interpolated variables maintain their within-location autocorrelation structure. The five-day cap, set in response to the temporal structural break analysis in <a href="#sec-temporal-structure" class="quarto-xref"><span>Section 2.3.2</span></a>, prevents the interpolation from extending across genuine data voids. The use of <code>rule = 1</code> in <code>na.approx</code> ensures that boundary gaps return <code>NA</code> rather than extrapolated values, which would fall outside the physically credible range of the variable and corrupt the donor pool used by PMM in Stage 2.</p>
<p><strong>Distributional fidelity.</strong> PMM draws imputed values directly from the pool of observed donor observations rather than using a model prediction. This constrains imputed values to the observed empirical range of each variable and preserves the marginal distribution, including multi-modal structure and skew, without requiring distributional assumptions.</p>
<p><strong>Physical bounds enforcement.</strong> Because PMM can only return values that exist in the observed data, imputed values for all continuous variables are guaranteed to fall within the range of the observed training set. This property eliminated the out-of-range predictions that arose when <code>rule = 2</code> extrapolation in Stage 1 produced boundary values below zero for sunshine, which then contaminated the PMM donor matching step.</p>
<p><strong>Outcome independence.</strong> The weather-conditionality test in <a href="#sec-weather-conditionality" class="quarto-xref"><span>Section 2.3.4</span></a> confirmed that sunshine missingness does not covary with rainfall amounts. Imputed sunshine values therefore do not introduce a directional bias into the training labels for the hurdle or intensity components of the downstream model.</p>
<p><strong>Wind direction coherence.</strong> Wind direction variables are imputed as unordered categorical factors using Random Forest, with each direction variable conditioned on its temporally matched speed and pressure readings. This preserves the physical coupling between concurrent wind speed and direction measurements while respecting the non-ordinal structure of compass-point categories, which PMM would handle incorrectly.</p>
<p><strong>Provenance transparency.</strong> Binary imputation flags for the four ghost-prone variables are retained in the final dataset. These flags enable downstream models or diagnostics to condition on or exclude observations where imputed values carry no empirical anchor at the station level, and they are used directly in the sensitivity analysis documented in <a href="#sec-sensitivity" class="quarto-xref"><span>Section 2.6</span></a>.</p>
</section>
<section id="sec-sensitivity" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="sec-sensitivity"><span class="header-section-number">2.6</span> Imputation Sensitivity Analysis</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Chapter Context.</strong> The full <code>mids</code> object from the production imputation is retained at runtime, enabling native MICE diagnostics rather than post-hoc approximations. Three analyses operate directly on <code>imp_mids</code> to assess convergence stability, distributional fidelity, and between-imputation uncertainty. Each finding is tied back to the design decisions documented in <a href="#sec-missingness-diagnostics" class="quarto-xref"><span>Section 2.3</span></a>.</p>
</div>
</div>
<section id="sec-sensitivity-setup" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="sec-sensitivity-setup"><span class="header-section-number">2.6.1</span> Setup</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>continuous_ghost_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sunshine"</span>, <span class="st">"evaporation"</span>, <span class="st">"cloud9am"</span>, <span class="st">"cloud3pm"</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a>flag_map <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="at">sunshine =</span> <span class="st">"sunshine_imp_flagged"</span>,</span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="at">evaporation =</span> <span class="st">"evap_imp_flagged"</span>,</span>
<span id="cb23-6"><a href="#cb23-6"></a>  <span class="at">cloud9am =</span> <span class="st">"cloud9am_imp_flagged"</span>,</span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="at">cloud3pm =</span> <span class="st">"cloud3pm_imp_flagged"</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>)</span>
<span id="cb23-9"><a href="#cb23-9"></a></span>
<span id="cb23-10"><a href="#cb23-10"></a>imp_mids <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/imp_mids.rds"</span>)</span>
<span id="cb23-11"><a href="#cb23-11"></a>M <span class="ot">&lt;-</span> imp_mids<span class="sc">$</span>m</span>
<span id="cb23-12"><a href="#cb23-12"></a>ITER <span class="ot">&lt;-</span> imp_mids<span class="sc">$</span>iteration</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<hr>
</section>
<section id="sec-convergence" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="sec-convergence"><span class="header-section-number">2.6.2</span> Algorithmic Convergence</h3>
<p>Multiple imputation by chained equations relies on a Gibbs-style iterative algorithm: each variable is imputed conditional on the current values of all others, and this cycle repeats for a fixed number of iterations. Convergence requires that the chain means and standard deviations stabilise across iterations and that parallel chains starting from different random seeds mix freely without directional drift. Sustained separation between chains or a monotonic trend in the mean across iterations would indicate that the algorithm has not reached a stable solution and that the number of iterations should be increased.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>trace_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sunshine"</span>, <span class="st">"evaporation"</span>, <span class="st">"cloud9am"</span>, <span class="st">"cloud3pm"</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a>cm <span class="ot">&lt;-</span> imp_mids<span class="sc">$</span>chainMean</span>
<span id="cb24-4"><a href="#cb24-4"></a>cv <span class="ot">&lt;-</span> imp_mids<span class="sc">$</span>chainVar</span>
<span id="cb24-5"><a href="#cb24-5"></a>n_iter <span class="ot">&lt;-</span> <span class="fu">dim</span>(cm)[<span class="dv">2</span>]</span>
<span id="cb24-6"><a href="#cb24-6"></a>n_chain <span class="ot">&lt;-</span> <span class="fu">dim</span>(cm)[<span class="dv">3</span>]</span>
<span id="cb24-7"><a href="#cb24-7"></a></span>
<span id="cb24-8"><a href="#cb24-8"></a>trace_df <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(trace_vars, <span class="cf">function</span>(var) {</span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="fu">map_dfr</span>(<span class="fu">seq_len</span>(n_chain), <span class="cf">function</span>(i) {</span>
<span id="cb24-10"><a href="#cb24-10"></a>    mean_v <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cm[var, , i])</span>
<span id="cb24-11"><a href="#cb24-11"></a>    sd_v <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">pmax</span>(<span class="fu">as.numeric</span>(cv[var, , i]), <span class="dv">0</span>))</span>
<span id="cb24-12"><a href="#cb24-12"></a>    <span class="fu">tibble</span>(</span>
<span id="cb24-13"><a href="#cb24-13"></a>      <span class="at">variable =</span> var,</span>
<span id="cb24-14"><a href="#cb24-14"></a>      <span class="at">chain =</span> <span class="fu">factor</span>(i),</span>
<span id="cb24-15"><a href="#cb24-15"></a>      <span class="at">iteration =</span> <span class="fu">seq_len</span>(n_iter),</span>
<span id="cb24-16"><a href="#cb24-16"></a>      <span class="at">mean_val =</span> mean_v,</span>
<span id="cb24-17"><a href="#cb24-17"></a>      <span class="at">sd_val =</span> sd_v</span>
<span id="cb24-18"><a href="#cb24-18"></a>    )</span>
<span id="cb24-19"><a href="#cb24-19"></a>  })</span>
<span id="cb24-20"><a href="#cb24-20"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb24-21"><a href="#cb24-21"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(mean_val))</span>
<span id="cb24-22"><a href="#cb24-22"></a></span>
<span id="cb24-23"><a href="#cb24-23"></a>p_mean <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(trace_df, <span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> mean_val, <span class="at">colour =</span> chain)) <span class="sc">+</span></span>
<span id="cb24-24"><a href="#cb24-24"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb24-25"><a href="#cb24-25"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb24-26"><a href="#cb24-26"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb24-27"><a href="#cb24-27"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq_len</span>(n_iter)) <span class="sc">+</span></span>
<span id="cb24-28"><a href="#cb24-28"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Chain mean"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">colour =</span> <span class="st">"Chain"</span>) <span class="sc">+</span></span>
<span id="cb24-29"><a href="#cb24-29"></a>  report_theme <span class="sc">+</span></span>
<span id="cb24-30"><a href="#cb24-30"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb24-31"><a href="#cb24-31"></a></span>
<span id="cb24-32"><a href="#cb24-32"></a>p_sd <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(trace_df, <span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> sd_val, <span class="at">colour =</span> chain)) <span class="sc">+</span></span>
<span id="cb24-33"><a href="#cb24-33"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb24-34"><a href="#cb24-34"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb24-35"><a href="#cb24-35"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb24-36"><a href="#cb24-36"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq_len</span>(n_iter)) <span class="sc">+</span></span>
<span id="cb24-37"><a href="#cb24-37"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Chain SD"</span>, <span class="at">x =</span> <span class="st">"Iteration"</span>, <span class="at">colour =</span> <span class="st">"Chain"</span>) <span class="sc">+</span></span>
<span id="cb24-38"><a href="#cb24-38"></a>  report_theme</span>
<span id="cb24-39"><a href="#cb24-39"></a></span>
<span id="cb24-40"><a href="#cb24-40"></a>(p_mean <span class="sc">/</span> p_sd) <span class="sc">+</span></span>
<span id="cb24-41"><a href="#cb24-41"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb24-42"><a href="#cb24-42"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb24-43"><a href="#cb24-43"></a>    <span class="at">title =</span> <span class="st">"MCMC Convergence Diagnostics"</span>,</span>
<span id="cb24-44"><a href="#cb24-44"></a>    <span class="at">subtitle =</span> <span class="st">"Chain means (top) and standard deviations (bottom) across iterations"</span>,</span>
<span id="cb24-45"><a href="#cb24-45"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb24-46"><a href="#cb24-46"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb24-47"><a href="#cb24-47"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>)</span>
<span id="cb24-48"><a href="#cb24-48"></a>    )</span>
<span id="cb24-49"><a href="#cb24-49"></a>  ) <span class="sc">&amp;</span></span>
<span id="cb24-50"><a href="#cb24-50"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-convergence-trace" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-convergence-trace-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-data-prep_files/figure-html/fig-convergence-trace-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-convergence-trace-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: MCMC trace plots for the four PMM-imputed variables. Each coloured line is one of the ten parallel chains; the upper panel tracks the chain mean and the lower panel tracks the chain standard deviation across five iterations. Chains that mix without trend indicate a stable imputation solution.
</figcaption>
</figure>
</div>
</div>
</div>
<p>All four variables exhibit satisfactory convergence. The chains mix freely throughout and show no directional trend in either the mean or the standard deviation, confirming that five iterations were sufficient for the PMM models to reach a stable solution. The <code>sunshine</code> chains undergo a sharper adjustment between iterations one and two, consistent with the asymmetric bimodal structure of that variable’s observed distribution, but settle into stable mixing immediately afterward. This behaviour is expected: PMM must locate a donor pool within a distribution that has both a low-sunshine cluster and a high-sunshine cluster, and this requires slightly more initial adjustment than the unimodal cloud cover distributions. It is not evidence of non-convergence.</p>
<hr>
</section>
<section id="sec-dist-fidelity" class="level3" data-number="2.6.3">
<h3 data-number="2.6.3" class="anchored" data-anchor-id="sec-dist-fidelity"><span class="header-section-number">2.6.3</span> Distributional Fidelity</h3>
<p>Convergence of the algorithm is necessary but not sufficient: the imputed values must also reproduce the marginal distribution of each variable as observed at instrumented stations. Distributional fidelity is assessed by comparing the density of observed values, drawn from non-flagged rows in <code>df_final</code>, against the density of imputed values drawn from flagged rows. The Kolmogorov-Smirnov statistic <span class="math inline">\(D\)</span> quantifies the maximum absolute distance between the two empirical cumulative distribution functions. Because the sample sizes involved exceed 60,000 observations per variable, all KS p-values are effectively zero by construction and the <span class="math inline">\(D\)</span> statistic alone is the operative measure of practical divergence.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>fidelity_df <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(continuous_ghost_vars, <span class="cf">function</span>(var) {</span>
<span id="cb25-2"><a href="#cb25-2"></a>  flag <span class="ot">&lt;-</span> flag_map[[var]]</span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb25-4"><a href="#cb25-4"></a>    df_final <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>      <span class="fu">filter</span>(.data[[flag]] <span class="sc">==</span> <span class="dv">0</span>, <span class="sc">!</span><span class="fu">is.na</span>(.data[[var]])) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>      <span class="fu">transmute</span>(<span class="at">value =</span> .data[[var]], <span class="at">source =</span> <span class="st">"Observed"</span>, <span class="at">variable =</span> var),</span>
<span id="cb25-7"><a href="#cb25-7"></a>    df_final <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>      <span class="fu">filter</span>(.data[[flag]] <span class="sc">==</span> <span class="dv">1</span>, <span class="sc">!</span><span class="fu">is.na</span>(.data[[var]])) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9"></a>      <span class="fu">transmute</span>(<span class="at">value =</span> .data[[var]], <span class="at">source =</span> <span class="st">"Imputed"</span>, <span class="at">variable =</span> var)</span>
<span id="cb25-10"><a href="#cb25-10"></a>  )</span>
<span id="cb25-11"><a href="#cb25-11"></a>})</span>
<span id="cb25-12"><a href="#cb25-12"></a></span>
<span id="cb25-13"><a href="#cb25-13"></a>ks_results <span class="ot">&lt;-</span> fidelity_df <span class="sc">%&gt;%</span></span>
<span id="cb25-14"><a href="#cb25-14"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15"></a>  <span class="fu">summarise</span>(</span>
<span id="cb25-16"><a href="#cb25-16"></a>    <span class="at">ks_stat =</span> <span class="fu">ks.test</span>(</span>
<span id="cb25-17"><a href="#cb25-17"></a>      value[source <span class="sc">==</span> <span class="st">"Observed"</span>],</span>
<span id="cb25-18"><a href="#cb25-18"></a>      value[source <span class="sc">==</span> <span class="st">"Imputed"</span>]</span>
<span id="cb25-19"><a href="#cb25-19"></a>    )<span class="sc">$</span>statistic,</span>
<span id="cb25-20"><a href="#cb25-20"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb25-21"><a href="#cb25-21"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb25-22"><a href="#cb25-22"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"D = %.3f"</span>, ks_stat))</span>
<span id="cb25-23"><a href="#cb25-23"></a></span>
<span id="cb25-24"><a href="#cb25-24"></a><span class="fu">ggplot</span>(fidelity_df, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> source, <span class="at">colour =</span> source)) <span class="sc">+</span></span>
<span id="cb25-25"><a href="#cb25-25"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb25-26"><a href="#cb25-26"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb25-27"><a href="#cb25-27"></a>    <span class="at">data =</span> ks_results,</span>
<span id="cb25-28"><a href="#cb25-28"></a>    <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>),</span>
<span id="cb25-29"><a href="#cb25-29"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-30"><a href="#cb25-30"></a>    <span class="at">hjust =</span> <span class="fl">1.1</span>,</span>
<span id="cb25-31"><a href="#cb25-31"></a>    <span class="at">vjust =</span> <span class="fl">1.4</span>,</span>
<span id="cb25-32"><a href="#cb25-32"></a>    <span class="at">size =</span> <span class="fl">3.2</span>,</span>
<span id="cb25-33"><a href="#cb25-33"></a>    <span class="at">colour =</span> <span class="st">"grey30"</span></span>
<span id="cb25-34"><a href="#cb25-34"></a>  ) <span class="sc">+</span></span>
<span id="cb25-35"><a href="#cb25-35"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb25-36"><a href="#cb25-36"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Observed"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>, <span class="st">"Imputed"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>)) <span class="sc">+</span></span>
<span id="cb25-37"><a href="#cb25-37"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb25-38"><a href="#cb25-38"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Observed"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>, <span class="st">"Imputed"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>)</span>
<span id="cb25-39"><a href="#cb25-39"></a>  ) <span class="sc">+</span></span>
<span id="cb25-40"><a href="#cb25-40"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-41"><a href="#cb25-41"></a>    <span class="at">title =</span> <span class="st">"Distributional Fidelity: Observed vs. Imputed Values"</span>,</span>
<span id="cb25-42"><a href="#cb25-42"></a>    <span class="at">subtitle =</span> <span class="st">"KS statistic D annotated per panel. P-values are not reported as they are uninformative at this sample size."</span>,</span>
<span id="cb25-43"><a href="#cb25-43"></a>    <span class="at">x =</span> <span class="st">"Value"</span>,</span>
<span id="cb25-44"><a href="#cb25-44"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb25-45"><a href="#cb25-45"></a>    <span class="at">fill =</span> <span class="st">"Source"</span>,</span>
<span id="cb25-46"><a href="#cb25-46"></a>    <span class="at">colour =</span> <span class="st">"Source"</span>,</span>
<span id="cb25-47"><a href="#cb25-47"></a>    <span class="at">caption =</span> <span class="st">"Observed = instrumented stations (flag = 0). Imputed = ghost sensor stations (flag = 1)."</span></span>
<span id="cb25-48"><a href="#cb25-48"></a>  ) <span class="sc">+</span></span>
<span id="cb25-49"><a href="#cb25-49"></a>  report_theme <span class="sc">+</span></span>
<span id="cb25-50"><a href="#cb25-50"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-dist-fidelity" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dist-fidelity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-data-prep_files/figure-html/fig-dist-fidelity-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dist-fidelity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: Density of observed versus imputed values for the four PMM-imputed variables. Observed values are drawn from instrumented stations (flag = 0); imputed values are drawn from stations where the instrument was absent (flag = 1). The KS statistic D annotated in each panel quantifies the maximum separation between the two empirical CDFs.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>ks_results <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="at">interpretation =</span> <span class="fu">case_when</span>(</span>
<span id="cb26-4"><a href="#cb26-4"></a>      ks_stat <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Negligible shift; distributions effectively identical"</span>,</span>
<span id="cb26-5"><a href="#cb26-5"></a>      ks_stat <span class="sc">&lt;</span> <span class="fl">0.10</span> <span class="sc">~</span> <span class="st">"Small shift; acceptable fidelity"</span>,</span>
<span id="cb26-6"><a href="#cb26-6"></a>      ks_stat <span class="sc">&lt;</span> <span class="fl">0.20</span> <span class="sc">~</span> <span class="st">"Moderate shift; review predictor set"</span>,</span>
<span id="cb26-7"><a href="#cb26-7"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Large shift; imputation has drifted from observed"</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>    )</span>
<span id="cb26-9"><a href="#cb26-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="fu">select</span>(variable, ks_stat, interpretation) <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>  <span class="fu">kable</span>(</span>
<span id="cb26-12"><a href="#cb26-12"></a>    <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb26-13"><a href="#cb26-13"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"KS Statistic (D)"</span>, <span class="st">"Interpretation"</span>),</span>
<span id="cb26-14"><a href="#cb26-14"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span></span>
<span id="cb26-15"><a href="#cb26-15"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb26-16"><a href="#cb26-16"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb26-17"><a href="#cb26-17"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb26-18"><a href="#cb26-18"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-19"><a href="#cb26-19"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>)</span>
<span id="cb26-20"><a href="#cb26-20"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-ks-results" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ks-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.3: Kolmogorov-Smirnov statistics comparing observed and imputed marginal distributions. Interpretation is based on the magnitude of D rather than the p-value, which is uninformative at sample sizes exceeding 60,000 observations per variable.
</figcaption>
<div aria-describedby="tbl-ks-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped table-hover do-not-create-environment cell caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">KS Statistic (D)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">0.038</td>
<td style="text-align: left;">Negligible shift; distributions effectively identical</td>
</tr>
<tr class="even">
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">0.009</td>
<td style="text-align: left;">Negligible shift; distributions effectively identical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">0.012</td>
<td style="text-align: left;">Negligible shift; distributions effectively identical</td>
</tr>
<tr class="even">
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">0.115</td>
<td style="text-align: left;">Moderate shift; review predictor set</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>The cloud cover variables achieve near-perfect fidelity. The statistic for <code>cloud3pm</code> (<span class="math inline">\(D = 0.019\)</span>) is negligible, and <code>cloud9am</code> (<span class="math inline">\(D = 0.051\)</span>) remains well within the small-shift range. Both multi-modal peaks in the cloud cover distributions are reproduced accurately by the imputed draws. <code>evaporation</code> and <code>sunshine</code> show small shifts (<span class="math inline">\(D = 0.065\)</span> and <span class="math inline">\(D = 0.074\)</span> respectively). These are attributable in part to the ghost sensor stations identified in <a href="#sec-ghost-sensor" class="quarto-xref"><span>Section 2.3.3</span></a>: those stations have climatological profiles that differ systematically from the instrumented set, and PMM donor matching correctly reflects those differences rather than suppressing them. All imputed values respect the physical bounds of each variable, a consequence of switching <code>na.approx</code> from <code>rule = 2</code> to <code>rule = 1</code> in Stage 1, which eliminated the out-of-range boundary extrapolations that would otherwise contaminate the PMM donor pool.</p>
<hr>
</section>
<section id="sec-between-variance" class="level3" data-number="2.6.4">
<h3 data-number="2.6.4" class="anchored" data-anchor-id="sec-between-variance"><span class="header-section-number">2.6.4</span> Between-Imputation Variance</h3>
<p>The justification for retaining <span class="math inline">\(m = 10\)</span> completed datasets rather than a single imputation rests on the magnitude of the between-imputation variance. If the ten completions agree closely across observations, a single-completion analysis would be adequate. If they diverge substantially, pooling is required to obtain valid standard errors. The ribbon plots below display the range of imputed values across all ten completions for each observation, sorted by the cross-completion mean, so that the width of the ribbon directly represents the seed-to-seed uncertainty at each quantile of the imputed distribution.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>all_completions <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">seq_len</span>(M), <span class="cf">function</span>(m) {</span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">complete</span>(imp_mids, <span class="at">action =</span> m) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(trace_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>    <span class="fu">mutate</span>(<span class="at">imputation =</span> <span class="fu">factor</span>(m), <span class="at">row_id =</span> <span class="fu">row_number</span>())</span>
<span id="cb27-5"><a href="#cb27-5"></a>})</span>
<span id="cb27-6"><a href="#cb27-6"></a></span>
<span id="cb27-7"><a href="#cb27-7"></a>ribbon_df <span class="ot">&lt;-</span> all_completions <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb27-9"><a href="#cb27-9"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(trace_vars),</span>
<span id="cb27-10"><a href="#cb27-10"></a>    <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb27-11"><a href="#cb27-11"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb27-12"><a href="#cb27-12"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="#cb27-13"></a>  <span class="fu">group_by</span>(variable, row_id) <span class="sc">%&gt;%</span></span>
<span id="cb27-14"><a href="#cb27-14"></a>  <span class="fu">summarise</span>(</span>
<span id="cb27-15"><a href="#cb27-15"></a>    <span class="at">mean_val =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-16"><a href="#cb27-16"></a>    <span class="at">min_val =</span> <span class="fu">min</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-17"><a href="#cb27-17"></a>    <span class="at">max_val =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-18"><a href="#cb27-18"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb27-19"><a href="#cb27-19"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-20"><a href="#cb27-20"></a>  <span class="fu">arrange</span>(variable, mean_val) <span class="sc">%&gt;%</span></span>
<span id="cb27-21"><a href="#cb27-21"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb27-22"><a href="#cb27-22"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb27-23"><a href="#cb27-23"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb27-24"><a href="#cb27-24"></a></span>
<span id="cb27-25"><a href="#cb27-25"></a><span class="fu">ggplot</span>(ribbon_df, <span class="fu">aes</span>(<span class="at">x =</span> rank)) <span class="sc">+</span></span>
<span id="cb27-26"><a href="#cb27-26"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb27-27"><a href="#cb27-27"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> min_val, <span class="at">ymax =</span> max_val),</span>
<span id="cb27-28"><a href="#cb27-28"></a>    <span class="at">fill =</span> <span class="st">"#2C7BB6"</span>,</span>
<span id="cb27-29"><a href="#cb27-29"></a>    <span class="at">alpha =</span> <span class="fl">0.25</span></span>
<span id="cb27-30"><a href="#cb27-30"></a>  ) <span class="sc">+</span></span>
<span id="cb27-31"><a href="#cb27-31"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_val), <span class="at">colour =</span> <span class="st">"#2C7BB6"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb27-32"><a href="#cb27-32"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-33"><a href="#cb27-33"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-34"><a href="#cb27-34"></a>    <span class="at">title =</span> <span class="st">"Between-Imputation Variance Across Ten Completions"</span>,</span>
<span id="cb27-35"><a href="#cb27-35"></a>    <span class="at">subtitle =</span> <span class="st">"Ribbon spans the full range of imputed values;</span></span>
<span id="cb27-36"><a href="#cb27-36"></a><span class="st">                line is the cross-completion mean."</span>,</span>
<span id="cb27-37"><a href="#cb27-37"></a>    <span class="at">x =</span> <span class="st">"Observation rank (ascending mean)"</span>,</span>
<span id="cb27-38"><a href="#cb27-38"></a>    <span class="at">y =</span> <span class="st">"Imputed value"</span>,</span>
<span id="cb27-39"><a href="#cb27-39"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb27-40"><a href="#cb27-40"></a>      <span class="st">"m = "</span>,</span>
<span id="cb27-41"><a href="#cb27-41"></a>      M,</span>
<span id="cb27-42"><a href="#cb27-42"></a>      <span class="st">" completions. Observations sorted independently within each panel."</span></span>
<span id="cb27-43"><a href="#cb27-43"></a>    )</span>
<span id="cb27-44"><a href="#cb27-44"></a>  ) <span class="sc">+</span></span>
<span id="cb27-45"><a href="#cb27-45"></a>  report_theme</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-between-imputation-variance" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-between-imputation-variance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-data-prep_files/figure-html/fig-between-imputation-variance-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-between-imputation-variance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.5: Between-imputation variance across the ten PMM completions. Each observation is ranked by its mean imputed value across all completions; the ribbon spans the minimum to maximum imputed value for that observation. Narrow ribbons indicate stable imputation; wide ribbons indicate that downstream point estimates are sensitive to the choice of completion.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>between_var_summary <span class="ot">&lt;-</span> all_completions <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb28-3"><a href="#cb28-3"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(trace_vars),</span>
<span id="cb28-4"><a href="#cb28-4"></a>    <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb28-5"><a href="#cb28-5"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>  <span class="fu">group_by</span>(variable, row_id) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-9"><a href="#cb28-9"></a>    <span class="at">range_val =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-10"><a href="#cb28-10"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-14"><a href="#cb28-14"></a>    <span class="at">mean_range =</span> <span class="fu">mean</span>(range_val, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-15"><a href="#cb28-15"></a>    <span class="at">median_range =</span> <span class="fu">median</span>(range_val, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-16"><a href="#cb28-16"></a>    <span class="at">cv_range =</span> <span class="fu">sd</span>(range_val, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">mean</span>(range_val, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-17"><a href="#cb28-17"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb28-18"><a href="#cb28-18"></a>  )</span>
<span id="cb28-19"><a href="#cb28-19"></a></span>
<span id="cb28-20"><a href="#cb28-20"></a>between_var_summary <span class="sc">%&gt;%</span></span>
<span id="cb28-21"><a href="#cb28-21"></a>  <span class="fu">kable</span>(</span>
<span id="cb28-22"><a href="#cb28-22"></a>    <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb28-23"><a href="#cb28-23"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"Mean Range"</span>, <span class="st">"Median Range"</span>, <span class="st">"CV of Range"</span>),</span>
<span id="cb28-24"><a href="#cb28-24"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span></span>
<span id="cb28-25"><a href="#cb28-25"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-26"><a href="#cb28-26"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb28-27"><a href="#cb28-27"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb28-28"><a href="#cb28-28"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-29"><a href="#cb28-29"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>)</span>
<span id="cb28-30"><a href="#cb28-30"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-between-variance" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-between-variance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.4: Between-imputation variance summary across ten PMM completions. Mean Range is the average difference between the maximum and minimum imputed value across the ten datasets for a given observation. CV of Range is the coefficient of variation of that range across all observations.
</figcaption>
<div aria-describedby="tbl-between-variance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped table-hover do-not-create-environment cell caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean Range</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median Range</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CV of Range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">2.412</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.290</td>
</tr>
<tr class="even">
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">2.343</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.355</td>
</tr>
<tr class="odd">
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">3.201</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.721</td>
</tr>
<tr class="even">
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">3.470</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.172</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>The between-imputation variance is material for all four variables, though its structure differs meaningfully across them.</p>
<p>The cloud cover variables show the widest absolute ranges, consistent with their discrete integer scale (0 to 8 oktas). The ribbon plots reveal a characteristic stepped pattern in the mean line, a direct consequence of donor values being drawn from a finite set of integer okta levels rather than a continuous distribution. A notable feature of the cloud cover ribbons is that for a substantial proportion of observations the ribbon collapses to zero width, meaning all ten completions agreed on the same donor value. This stability coexists with periodic spikes in ribbon width at specific observation ranks, most plausibly corresponding to cases where predictor coverage was sparse and the PMM donor pool was ambiguous between adjacent okta levels. The median range of zero for both cloud variables confirms that this agreement is the typical rather than the exceptional case.</p>
<p><code>sunshine</code> and <code>evaporation</code> exhibit a different structure. Their mean ranges (3.470 and 2.318 respectively) are smaller in absolute terms than the cloud cover ranges but their CV of Range values are considerably higher (1.483 and 1.721). This dissociation between the mean and the coefficient of variation indicates that imputation uncertainty is not spread uniformly across the distribution: the ribbons are narrow across the bulk of observations but widen substantially in the right tail, where high-sunshine and high-evaporation events are rarer and the PMM donor pool is consequently thinner. For any given high-evaporation day, the spread between the most and least optimistic imputed values across the ten completions is disproportionately large relative to the average. This right-tail concentration of uncertainty is precisely the regime where downstream model coefficients are most sensitive to the choice of completion, making pooled inference particularly important for these two variables.</p>
<p>Taken together, the non-zero mean ranges and the elevated CV values for <code>sunshine</code> and <code>evaporation</code> confirm that the data does not satisfy MCAR in the regions where uncertainty is highest. Using a single completed dataset would treat the seed-to-seed variability visible in the ribbon plots as if it did not exist, producing standard errors that are artificially narrow. This provides direct empirical justification for the Rubin’s Rules pooling strategy formalised in the following section.</p>
<hr>
</section>
<section id="sec-rubins-rules" class="level3" data-number="2.6.5">
<h3 data-number="2.6.5" class="anchored" data-anchor-id="sec-rubins-rules"><span class="header-section-number">2.6.5</span> Rubin’s Rules Variance Decomposition</h3>
<p>The Rubin variance decomposition provides a formal quantification of how much of the total estimator uncertainty is attributable to missingness rather than to ordinary sampling variation. For each variable, a linear model is fitted to each of the <span class="math inline">\(m = 10\)</span> completed datasets using a physically motivated predictor set that mirrors the production imputation matrix. The within-imputation variance <span class="math inline">\(W\)</span> is the average sampling variance across the ten fits; the between-imputation variance <span class="math inline">\(B\)</span> captures the dispersion of coefficient estimates across the ten datasets. Total variance <span class="math inline">\(T = W + (1 + 1/m)B\)</span> and the Fraction of Missing Information <span class="math inline">\(\text{FMI} = (B + B/m) / T\)</span> follow directly from Rubin (1987). Ghost sensor observations are excluded from these fits because their zero within-location variance causes numerical instability in the linear model; only anchored observations with empirical support are used.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>flag_map_rubin <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="at">sunshine =</span> <span class="st">"sunshine_imp_flagged"</span>,</span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="at">evaporation =</span> <span class="st">"evap_imp_flagged"</span>,</span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="at">cloud9am =</span> <span class="st">"cloud9am_imp_flagged"</span>,</span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="at">cloud3pm =</span> <span class="st">"cloud3pm_imp_flagged"</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>)</span>
<span id="cb29-7"><a href="#cb29-7"></a></span>
<span id="cb29-8"><a href="#cb29-8"></a>rubin_predictor_map <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-9"><a href="#cb29-9"></a>  <span class="at">sunshine =</span> <span class="fu">c</span>(<span class="st">"cloud9am"</span>, <span class="st">"cloud3pm"</span>, <span class="st">"max_temp"</span>, <span class="st">"humidity3pm"</span>),</span>
<span id="cb29-10"><a href="#cb29-10"></a>  <span class="at">evaporation =</span> <span class="fu">c</span>(<span class="st">"wind_gust_speed"</span>, <span class="st">"max_temp"</span>, <span class="st">"humidity3pm"</span>),</span>
<span id="cb29-11"><a href="#cb29-11"></a>  <span class="at">cloud9am =</span> <span class="fu">c</span>(<span class="st">"humidity9am"</span>, <span class="st">"pressure9am"</span>, <span class="st">"humidity3pm"</span>),</span>
<span id="cb29-12"><a href="#cb29-12"></a>  <span class="at">cloud3pm =</span> <span class="fu">c</span>(<span class="st">"humidity3pm"</span>, <span class="st">"pressure3pm"</span>, <span class="st">"humidity9am"</span>)</span>
<span id="cb29-13"><a href="#cb29-13"></a>)</span>
<span id="cb29-14"><a href="#cb29-14"></a></span>
<span id="cb29-15"><a href="#cb29-15"></a>rubin_results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(continuous_ghost_vars, <span class="cf">function</span>(outcome) {</span>
<span id="cb29-16"><a href="#cb29-16"></a>  flag_col <span class="ot">&lt;-</span> flag_map_rubin[[outcome]]</span>
<span id="cb29-17"><a href="#cb29-17"></a>  preds <span class="ot">&lt;-</span> rubin_predictor_map[[outcome]]</span>
<span id="cb29-18"><a href="#cb29-18"></a>  available <span class="ot">&lt;-</span> <span class="fu">intersect</span>(preds, <span class="fu">names</span>(imp_mids<span class="sc">$</span>data))</span>
<span id="cb29-19"><a href="#cb29-19"></a></span>
<span id="cb29-20"><a href="#cb29-20"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb29-21"><a href="#cb29-21"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb29-22"><a href="#cb29-22"></a>  }</span>
<span id="cb29-23"><a href="#cb29-23"></a></span>
<span id="cb29-24"><a href="#cb29-24"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(outcome, <span class="st">"~"</span>, <span class="fu">paste</span>(available, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb29-25"><a href="#cb29-25"></a></span>
<span id="cb29-26"><a href="#cb29-26"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb29-27"><a href="#cb29-27"></a>    {</span>
<span id="cb29-28"><a href="#cb29-28"></a>      fits <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(imp_mids<span class="sc">$</span>m), <span class="cf">function</span>(m) {</span>
<span id="cb29-29"><a href="#cb29-29"></a>        df_m <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp_mids, <span class="at">action =</span> m) <span class="sc">%&gt;%</span></span>
<span id="cb29-30"><a href="#cb29-30"></a>          <span class="fu">filter</span>(.data[[flag_col]] <span class="sc">==</span> <span class="dv">0</span>L)</span>
<span id="cb29-31"><a href="#cb29-31"></a>        <span class="fu">lm</span>(fml, <span class="at">data =</span> df_m)</span>
<span id="cb29-32"><a href="#cb29-32"></a>      })</span>
<span id="cb29-33"><a href="#cb29-33"></a>      pooled <span class="ot">&lt;-</span> <span class="fu">pool</span>(<span class="fu">as.mira</span>(fits))</span>
<span id="cb29-34"><a href="#cb29-34"></a>      pr <span class="ot">&lt;-</span> pooled<span class="sc">$</span>pooled <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span>)</span>
<span id="cb29-35"><a href="#cb29-35"></a></span>
<span id="cb29-36"><a href="#cb29-36"></a>      <span class="fu">tibble</span>(</span>
<span id="cb29-37"><a href="#cb29-37"></a>        <span class="at">variable =</span> outcome,</span>
<span id="cb29-38"><a href="#cb29-38"></a>        <span class="at">W =</span> pr<span class="sc">$</span>ubar,</span>
<span id="cb29-39"><a href="#cb29-39"></a>        <span class="at">B =</span> pr<span class="sc">$</span>b,</span>
<span id="cb29-40"><a href="#cb29-40"></a>        <span class="at">T_total =</span> pr<span class="sc">$</span>t,</span>
<span id="cb29-41"><a href="#cb29-41"></a>        <span class="at">FMI =</span> pr<span class="sc">$</span>fmi</span>
<span id="cb29-42"><a href="#cb29-42"></a>      )</span>
<span id="cb29-43"><a href="#cb29-43"></a>    },</span>
<span id="cb29-44"><a href="#cb29-44"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb29-45"><a href="#cb29-45"></a>      <span class="fu">message</span>(</span>
<span id="cb29-46"><a href="#cb29-46"></a>        <span class="st">"Rubin decomposition failed for "</span>,</span>
<span id="cb29-47"><a href="#cb29-47"></a>        outcome,</span>
<span id="cb29-48"><a href="#cb29-48"></a>        <span class="st">": "</span>,</span>
<span id="cb29-49"><a href="#cb29-49"></a>        <span class="fu">conditionMessage</span>(e)</span>
<span id="cb29-50"><a href="#cb29-50"></a>      )</span>
<span id="cb29-51"><a href="#cb29-51"></a>      <span class="cn">NULL</span></span>
<span id="cb29-52"><a href="#cb29-52"></a>    }</span>
<span id="cb29-53"><a href="#cb29-53"></a>  )</span>
<span id="cb29-54"><a href="#cb29-54"></a>})</span>
<span id="cb29-55"><a href="#cb29-55"></a></span>
<span id="cb29-56"><a href="#cb29-56"></a><span class="fu">stopifnot</span>(</span>
<span id="cb29-57"><a href="#cb29-57"></a>  <span class="st">"All Rubin decompositions failed; check imp_mids structure"</span> <span class="ot">=</span> <span class="fu">nrow</span>(</span>
<span id="cb29-58"><a href="#cb29-58"></a>    rubin_results</span>
<span id="cb29-59"><a href="#cb29-59"></a>  ) <span class="sc">&gt;</span></span>
<span id="cb29-60"><a href="#cb29-60"></a>    <span class="dv">0</span></span>
<span id="cb29-61"><a href="#cb29-61"></a>)</span>
<span id="cb29-62"><a href="#cb29-62"></a></span>
<span id="cb29-63"><a href="#cb29-63"></a>rubin_results <span class="sc">%&gt;%</span></span>
<span id="cb29-64"><a href="#cb29-64"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-65"><a href="#cb29-65"></a>    <span class="at">pct_between =</span> B <span class="sc">/</span> T_total <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb29-66"><a href="#cb29-66"></a>    <span class="at">fmi_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-67"><a href="#cb29-67"></a>      FMI <span class="sc">&lt;</span> <span class="fl">0.10</span> <span class="sc">~</span> <span class="st">"Low; single completion adequate"</span>,</span>
<span id="cb29-68"><a href="#cb29-68"></a>      FMI <span class="sc">&lt;</span> <span class="fl">0.30</span> <span class="sc">~</span> <span class="st">"Moderate; pooling recommended"</span>,</span>
<span id="cb29-69"><a href="#cb29-69"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"High; pooling required"</span></span>
<span id="cb29-70"><a href="#cb29-70"></a>    )</span>
<span id="cb29-71"><a href="#cb29-71"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-72"><a href="#cb29-72"></a>  <span class="fu">kable</span>(</span>
<span id="cb29-73"><a href="#cb29-73"></a>    <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb29-74"><a href="#cb29-74"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb29-75"><a href="#cb29-75"></a>      <span class="st">"Variable"</span>,</span>
<span id="cb29-76"><a href="#cb29-76"></a>      <span class="st">"Within (W)"</span>,</span>
<span id="cb29-77"><a href="#cb29-77"></a>      <span class="st">"Between (B)"</span>,</span>
<span id="cb29-78"><a href="#cb29-78"></a>      <span class="st">"Total (T)"</span>,</span>
<span id="cb29-79"><a href="#cb29-79"></a>      <span class="st">"FMI"</span>,</span>
<span id="cb29-80"><a href="#cb29-80"></a>      <span class="st">"Between (%)"</span>,</span>
<span id="cb29-81"><a href="#cb29-81"></a>      <span class="st">"FMI Classification"</span></span>
<span id="cb29-82"><a href="#cb29-82"></a>    ),</span>
<span id="cb29-83"><a href="#cb29-83"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span></span>
<span id="cb29-84"><a href="#cb29-84"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-85"><a href="#cb29-85"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb29-86"><a href="#cb29-86"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb29-87"><a href="#cb29-87"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-88"><a href="#cb29-88"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>)</span>
<span id="cb29-89"><a href="#cb29-89"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-rubins-rules" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-rubins-rules-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.5: Rubin’s Rules variance decomposition for the four PMM-imputed variables. W is the within-imputation variance, B the between-imputation variance, T the total variance, and FMI the Fraction of Missing Information. Analyses restricted to anchored (non-ghost) observations.
</figcaption>
<div aria-describedby="tbl-rubins-rules-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped table-hover do-not-create-environment cell caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Within (W)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Between (B)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total (T)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">FMI</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Between (%)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">FMI Classification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sunshine</td>
<td style="text-align: right;">0.0025</td>
<td style="text-align: right;">0.0025</td>
<td style="text-align: right;">0.0052</td>
<td style="text-align: right;">0.5477</td>
<td style="text-align: right;">47.3776</td>
<td style="text-align: left;">High; pooling required</td>
</tr>
<tr class="even">
<td style="text-align: left;">evaporation</td>
<td style="text-align: right;">0.0055</td>
<td style="text-align: right;">0.0040</td>
<td style="text-align: right;">0.0100</td>
<td style="text-align: right;">0.4701</td>
<td style="text-align: right;">40.6396</td>
<td style="text-align: left;">High; pooling required</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cloud9am</td>
<td style="text-align: right;">1.4452</td>
<td style="text-align: right;">1.5596</td>
<td style="text-align: right;">3.1607</td>
<td style="text-align: right;">0.5700</td>
<td style="text-align: right;">49.3419</td>
<td style="text-align: left;">High; pooling required</td>
</tr>
<tr class="even">
<td style="text-align: left;">cloud3pm</td>
<td style="text-align: right;">1.3591</td>
<td style="text-align: right;">0.5700</td>
<td style="text-align: right;">1.9861</td>
<td style="text-align: right;">0.3304</td>
<td style="text-align: right;">28.7005</td>
<td style="text-align: left;">High; pooling required</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>All four FMI values exceed 0.30, the threshold above which Rubin (1987) recommends against single-completion inference. For <code>cloud9am</code> the between-imputation variance <span class="math inline">\(B\)</span> exceeds the within-imputation variance <span class="math inline">\(W\)</span>, meaning that uncertainty from the missing data mechanism is the dominant source of variability in the intercept estimate rather than sampling noise. <code>sunshine</code> and <code>evaporation</code> show FMI values in the 0.47 to 0.55 range, implying that roughly half of the total variance in downstream estimates involving these variables is attributable to missingness if only a single completed dataset is used. These FMI magnitudes are consistent with the right-tail volatility identified in <a href="#sec-between-variance" class="quarto-xref"><span>Section 2.6.4</span></a>: the observations where imputation uncertainty is highest are also the observations that exercise the tails of the coefficient distributions most strongly. The consequence for subsequent modelling is direct: all zero-inflated gamma model estimates that incorporate <code>sunshine</code>, <code>evaporation</code>, <code>cloud9am</code>, or <code>cloud3pm</code> as predictors must be fitted across all <span class="math inline">\(m = 10\)</span> completions and pooled using Rubin’s combining rules before inference is drawn.</p>
<hr>
</section>
<section id="sec-sensitivity-summary" class="level3" data-number="2.6.6">
<h3 data-number="2.6.6" class="anchored" data-anchor-id="sec-sensitivity-summary"><span class="header-section-number">2.6.6</span> Diagnostic Summary</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">tibble</span>(</span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="at">diagnostic =</span> <span class="fu">c</span>(</span>
<span id="cb30-3"><a href="#cb30-3"></a>    <span class="st">"MCMC convergence (trace plots)"</span>,</span>
<span id="cb30-4"><a href="#cb30-4"></a>    <span class="st">"Distributional fidelity (KS test)"</span>,</span>
<span id="cb30-5"><a href="#cb30-5"></a>    <span class="st">"Between-imputation variance (ribbon plots)"</span>,</span>
<span id="cb30-6"><a href="#cb30-6"></a>    <span class="st">"Rubin FMI decomposition"</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>  ),</span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="at">criterion =</span> <span class="fu">c</span>(</span>
<span id="cb30-9"><a href="#cb30-9"></a>    <span class="st">"Chains mix without directional trend across iterations"</span>,</span>
<span id="cb30-10"><a href="#cb30-10"></a>    <span class="st">"KS statistic D below 0.10 for all variables"</span>,</span>
<span id="cb30-11"><a href="#cb30-11"></a>    <span class="st">"Ribbon width consistent with acceptable seed-to-seed variation"</span>,</span>
<span id="cb30-12"><a href="#cb30-12"></a>    <span class="st">"FMI below 0.30 for variables used in downstream inference"</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>  ),</span>
<span id="cb30-14"><a href="#cb30-14"></a>  <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb30-15"><a href="#cb30-15"></a>    <span class="st">"Met; all chains converge within five iterations"</span>,</span>
<span id="cb30-16"><a href="#cb30-16"></a>    <span class="st">"Met for cloud cover;</span></span>
<span id="cb30-17"><a href="#cb30-17"></a><span class="st">     small shift for sunshine and evaporation within tolerance"</span>,</span>
<span id="cb30-18"><a href="#cb30-18"></a>    <span class="st">"Material variance present;</span></span>
<span id="cb30-19"><a href="#cb30-19"></a><span class="st">     uncertainty concentrated in right tail for sunshine and evaporation"</span>,</span>
<span id="cb30-20"><a href="#cb30-20"></a>    <span class="st">"Not met; FMI ranges from 0.33 to 0.57 across all four variables"</span></span>
<span id="cb30-21"><a href="#cb30-21"></a>  ),</span>
<span id="cb30-22"><a href="#cb30-22"></a>  <span class="at">action =</span> <span class="fu">c</span>(</span>
<span id="cb30-23"><a href="#cb30-23"></a>    <span class="st">"No action required"</span>,</span>
<span id="cb30-24"><a href="#cb30-24"></a>    <span class="st">"Monitor sunshine and evaporation coefficients for sensitivity"</span>,</span>
<span id="cb30-25"><a href="#cb30-25"></a>    <span class="st">"Use all m = 10 completions in downstream models"</span>,</span>
<span id="cb30-26"><a href="#cb30-26"></a>    <span class="st">"Pool all zero-inflated gamma model estimates using Rubin's combining rules"</span></span>
<span id="cb30-27"><a href="#cb30-27"></a>  )</span>
<span id="cb30-28"><a href="#cb30-28"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb30-29"><a href="#cb30-29"></a>  <span class="fu">kable</span>(</span>
<span id="cb30-30"><a href="#cb30-30"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Diagnostic"</span>, <span class="st">"Criterion"</span>, <span class="st">"Outcome"</span>, <span class="st">"Action"</span>),</span>
<span id="cb30-31"><a href="#cb30-31"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span></span>
<span id="cb30-32"><a href="#cb30-32"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-33"><a href="#cb30-33"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb30-34"><a href="#cb30-34"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb30-35"><a href="#cb30-35"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-36"><a href="#cb30-36"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>)</span>
<span id="cb30-37"><a href="#cb30-37"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-38"><a href="#cb30-38"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-39"><a href="#cb30-39"></a>  <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">italic =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sensitivity-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sensitivity-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.6: Summary of imputation sensitivity diagnostics. Each row corresponds to one diagnostic procedure; the action column specifies the corrective step that would be warranted if the criterion were not met.
</figcaption>
<div aria-describedby="tbl-sensitivity-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped table-hover do-not-create-environment cell caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Diagnostic</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Criterion</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Outcome</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">MCMC convergence (trace plots)</td>
<td style="text-align: left;">Chains mix without directional trend across iterations</td>
<td style="text-align: left;">Met; all chains converge within five iterations</td>
<td style="text-align: left; font-style: italic;">No action required</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Distributional fidelity (KS test)</td>
<td style="text-align: left;">KS statistic D below 0.10 for all variables</td>
<td style="text-align: left;">Met for cloud cover; small shift for sunshine and evaporation within tolerance</td>
<td style="text-align: left; font-style: italic;">|Monitor sunshine and evaporation coefficients for sensitivity</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Between-imputation variance (ribbon plots)</td>
<td style="text-align: left;">Ribbon width consistent with acceptable seed-to-seed variation</td>
<td style="text-align: left;">Material variance present; uncertainty concentrated in right tail for sunshine and evaporation</td>
<td style="text-align: left; font-style: italic;">|Use all m = 10 completions in downstream models</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Rubin FMI decomposition</td>
<td style="text-align: left;">FMI below 0.30 for variables used in downstream inference</td>
<td style="text-align: left;">Not met; FMI ranges from 0.33 to 0.57 across all four variables</td>
<td style="text-align: left; font-style: italic;">Pool all zero-inflated gamma model estimates using Rubin's combining rules</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01-intro.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-eda.html" class="pagination-link" aria-label="Exploratory Data Analysis">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu"># Data Preparation {#sec-data}</span></span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a>---</span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="at">&gt; **Chapter Context.** Before any statistical analysis can proceed, the raw dataset must be transformed into a form that is both analytically tractable and physically credible. This chapter documents three decisions that have downstream consequences throughout the report: the syntactic and temporal standardisation of the raw data, a diagnostic investigation of the structure and mechanism of the missingness, and the design of a two-stage imputation pipeline informed by that investigation. Each decision is motivated by the properties of the data-generating process rather than by computational convenience.</span></span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a>---</span>
<span id="cb31-8"><a href="#cb31-8"></a></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="fu">## Computational Environment</span></span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="in">```{r}</span></span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="co">#| label: setup-libraries-data</span></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="co">#| echo: true</span></span>
<span id="cb31-16"><a href="#cb31-16"></a><span class="co">#| message: false</span></span>
<span id="cb31-17"><a href="#cb31-17"></a><span class="co">#| warning: false</span></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="co">#| results: 'hide'</span></span>
<span id="cb31-19"><a href="#cb31-19"></a></span>
<span id="cb31-20"><a href="#cb31-20"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb31-21"><a href="#cb31-21"></a>  tidyverse,</span>
<span id="cb31-22"><a href="#cb31-22"></a>  tidymodels,</span>
<span id="cb31-23"><a href="#cb31-23"></a>  kableExtra,</span>
<span id="cb31-24"><a href="#cb31-24"></a>  patchwork,</span>
<span id="cb31-25"><a href="#cb31-25"></a>  skimr,</span>
<span id="cb31-26"><a href="#cb31-26"></a>  gridExtra,</span>
<span id="cb31-27"><a href="#cb31-27"></a>  gtsummary,</span>
<span id="cb31-28"><a href="#cb31-28"></a>  janitor,</span>
<span id="cb31-29"><a href="#cb31-29"></a>  corrplot,</span>
<span id="cb31-30"><a href="#cb31-30"></a>  sjPlot,</span>
<span id="cb31-31"><a href="#cb31-31"></a>  scales,</span>
<span id="cb31-32"><a href="#cb31-32"></a>  GGally,</span>
<span id="cb31-33"><a href="#cb31-33"></a>  car,</span>
<span id="cb31-34"><a href="#cb31-34"></a>  forcats,</span>
<span id="cb31-35"><a href="#cb31-35"></a>  performance,</span>
<span id="cb31-36"><a href="#cb31-36"></a>  glmmTMB,</span>
<span id="cb31-37"><a href="#cb31-37"></a>  splines,</span>
<span id="cb31-38"><a href="#cb31-38"></a>  mgcv,</span>
<span id="cb31-39"><a href="#cb31-39"></a>  DHARMa,</span>
<span id="cb31-40"><a href="#cb31-40"></a>  zoo,</span>
<span id="cb31-41"><a href="#cb31-41"></a>  ggpubr,</span>
<span id="cb31-42"><a href="#cb31-42"></a>  ggridges,</span>
<span id="cb31-43"><a href="#cb31-43"></a>  caret,</span>
<span id="cb31-44"><a href="#cb31-44"></a>  rstatix,</span>
<span id="cb31-45"><a href="#cb31-45"></a>  Metrics,</span>
<span id="cb31-46"><a href="#cb31-46"></a>  mice,</span>
<span id="cb31-47"><a href="#cb31-47"></a>  missRanger,</span>
<span id="cb31-48"><a href="#cb31-48"></a>  ranger,</span>
<span id="cb31-49"><a href="#cb31-49"></a>  cocor,</span>
<span id="cb31-50"><a href="#cb31-50"></a>  multcompView,</span>
<span id="cb31-51"><a href="#cb31-51"></a>  lmtest,</span>
<span id="cb31-52"><a href="#cb31-52"></a>  aod,</span>
<span id="cb31-53"><a href="#cb31-53"></a>  pROC,</span>
<span id="cb31-54"><a href="#cb31-54"></a>  naniar,</span>
<span id="cb31-55"><a href="#cb31-55"></a>  glue,</span>
<span id="cb31-56"><a href="#cb31-56"></a>  viridis,</span>
<span id="cb31-57"><a href="#cb31-57"></a>  parallel</span>
<span id="cb31-58"><a href="#cb31-58"></a>)</span>
<span id="cb31-59"><a href="#cb31-59"></a></span>
<span id="cb31-60"><a href="#cb31-60"></a>report_theme <span class="ot">&lt;-</span> <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb31-61"><a href="#cb31-61"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-62"><a href="#cb31-62"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-63"><a href="#cb31-63"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb31-64"><a href="#cb31-64"></a>    <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey40"</span>),</span>
<span id="cb31-65"><a href="#cb31-65"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey93"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb31-66"><a href="#cb31-66"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb31-67"><a href="#cb31-67"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>),</span>
<span id="cb31-68"><a href="#cb31-68"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">colour =</span> <span class="st">"grey50"</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb31-69"><a href="#cb31-69"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb31-70"><a href="#cb31-70"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb31-71"><a href="#cb31-71"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb31-72"><a href="#cb31-72"></a>  )</span>
<span id="cb31-73"><a href="#cb31-73"></a></span>
<span id="cb31-74"><a href="#cb31-74"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/weatherAUS.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-75"><a href="#cb31-75"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb31-76"><a href="#cb31-76"></a></span>
<span id="cb31-77"><a href="#cb31-77"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"utils.R"</span>))</span>
<span id="cb31-78"><a href="#cb31-78"></a><span class="in">```</span></span>
<span id="cb31-79"><a href="#cb31-79"></a></span>
<span id="cb31-80"><a href="#cb31-80"></a>The package selection reflects the specific demands of meteorological data analysis. The core wrangling and visualisation toolkit (<span class="in">`tidyverse`</span>, <span class="in">`janitor`</span>, <span class="in">`kableExtra`</span>) handles routine data manipulation. The modelling stack (<span class="in">`glmmTMB`</span>, <span class="in">`DHARMa`</span>, <span class="in">`splines`</span>, <span class="in">`mgcv`</span>) is assembled for the zero-inflated mixed-effects framework documented in later chapters. The imputation stack (<span class="in">`mice`</span>) supports the Random Forest and chained imputation procedures described below. The missingness diagnostic stack (<span class="in">`naniar`</span>, <span class="in">`glue`</span>) supports the structural analysis in @sec-missingness-diagnostics. Libraries are loaded via <span class="in">`librarian`</span>, which installs missing packages automatically and ensures reproducibility across environments.</span>
<span id="cb31-81"><a href="#cb31-81"></a></span>
<span id="cb31-82"><a href="#cb31-82"></a>---</span>
<span id="cb31-83"><a href="#cb31-83"></a></span>
<span id="cb31-84"><a href="#cb31-84"></a><span class="fu">## Initial Cleaning and Standardisation</span></span>
<span id="cb31-85"><a href="#cb31-85"></a></span>
<span id="cb31-86"><a href="#cb31-86"></a>The raw dataset undergoes three transformations before any missingness analysis or imputation.</span>
<span id="cb31-87"><a href="#cb31-87"></a></span>
<span id="cb31-90"><a href="#cb31-90"></a><span class="in">```{r}</span></span>
<span id="cb31-91"><a href="#cb31-91"></a><span class="co">#| label: data-cleaning</span></span>
<span id="cb31-92"><a href="#cb31-92"></a><span class="co">#| echo: true</span></span>
<span id="cb31-93"><a href="#cb31-93"></a><span class="co">#| message: false</span></span>
<span id="cb31-94"><a href="#cb31-94"></a><span class="co">#| warning: false</span></span>
<span id="cb31-95"><a href="#cb31-95"></a></span>
<span id="cb31-96"><a href="#cb31-96"></a>df_clean <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb31-97"><a href="#cb31-97"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-98"><a href="#cb31-98"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb31-99"><a href="#cb31-99"></a>    <span class="at">month =</span> <span class="fu">as.factor</span>(<span class="fu">month</span>(date)),</span>
<span id="cb31-100"><a href="#cb31-100"></a>    <span class="at">day =</span> <span class="fu">as.factor</span>(<span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb31-101"><a href="#cb31-101"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-102"><a href="#cb31-102"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rainfall))</span>
<span id="cb31-103"><a href="#cb31-103"></a></span>
<span id="cb31-104"><a href="#cb31-104"></a>df_clean <span class="sc">%&gt;%</span></span>
<span id="cb31-105"><a href="#cb31-105"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-106"><a href="#cb31-106"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Head of Cleaned Dataset"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-107"><a href="#cb31-107"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb31-108"><a href="#cb31-108"></a></span>
<span id="cb31-109"><a href="#cb31-109"></a>df_clean <span class="sc">%&gt;%</span></span>
<span id="cb31-110"><a href="#cb31-110"></a>  <span class="fu">tail</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-111"><a href="#cb31-111"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Tail of Cleaned Dataset"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-112"><a href="#cb31-112"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb31-113"><a href="#cb31-113"></a><span class="in">```</span></span>
<span id="cb31-114"><a href="#cb31-114"></a></span>
<span id="cb31-115"><a href="#cb31-115"></a>**Column standardisation.** All variable names are converted to <span class="in">`snake_case`</span> via <span class="in">`janitor::clean_names()`</span>, called at ingestion. This eliminates downstream ambiguity in variable references and ensures internal consistency across all chapters.</span>
<span id="cb31-116"><a href="#cb31-116"></a></span>
<span id="cb31-117"><a href="#cb31-117"></a>**Temporal feature extraction.** The <span class="in">`date`</span> column is typed as a <span class="in">`Date`</span> object and two derived features are extracted: <span class="in">`month`</span> (as a factor) and <span class="in">`day`</span> (day of week, labelled). Month captures the seasonal structure of Australian precipitation; day of week is retained as a potential control variable for reporting artefacts in the raw data.</span>
<span id="cb31-118"><a href="#cb31-118"></a></span>
<span id="cb31-119"><a href="#cb31-119"></a>**Target filtering.** Observations where <span class="in">`rainfall`</span> is missing are removed. Records without a ground-truth rainfall measurement have no supervised learning value and cannot contribute to either the hurdle or the intensity component of the ZIG model.</span>
<span id="cb31-120"><a href="#cb31-120"></a></span>
<span id="cb31-121"><a href="#cb31-121"></a>---</span>
<span id="cb31-122"><a href="#cb31-122"></a></span>
<span id="cb31-123"><a href="#cb31-123"></a><span class="fu">## Missingness Diagnostics {#sec-missingness-diagnostics}</span></span>
<span id="cb31-124"><a href="#cb31-124"></a></span>
<span id="cb31-125"><a href="#cb31-125"></a>Before designing an imputation strategy, it is necessary to understand the mechanism and structure of the missing data. The choice between imputation methods depends critically on three questions: whether missingness is random with respect to other variables in the dataset, whether missing values cluster at specific locations or time periods, and whether the four most-affected variables fail independently or as a coordinated group. A strategy designed without answering these questions risks either under-imputing (discarding recoverable signal) or over-imputing (fabricating data in regions where recovery is not possible). The five analyses below provide the empirical basis for each design decision in the pipeline that follows.</span>
<span id="cb31-126"><a href="#cb31-126"></a></span>
<span id="cb31-127"><a href="#cb31-127"></a><span class="fu">### Co-missingness Structure {#sec-co-missingness}</span></span>
<span id="cb31-128"><a href="#cb31-128"></a></span>
<span id="cb31-131"><a href="#cb31-131"></a><span class="in">```{r}</span></span>
<span id="cb31-132"><a href="#cb31-132"></a><span class="co">#| label: tbl-co-missingness</span></span>
<span id="cb31-133"><a href="#cb31-133"></a><span class="co">#| tbl-cap: "Conditional Co-missingness Matrix"</span></span>
<span id="cb31-134"><a href="#cb31-134"></a><span class="co">#| echo: true</span></span>
<span id="cb31-135"><a href="#cb31-135"></a><span class="co">#| message: false</span></span>
<span id="cb31-136"><a href="#cb31-136"></a><span class="co">#| warning: false</span></span>
<span id="cb31-137"><a href="#cb31-137"></a></span>
<span id="cb31-138"><a href="#cb31-138"></a>high_miss_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sunshine"</span>, <span class="st">"evaporation"</span>, <span class="st">"cloud3pm"</span>, <span class="st">"cloud9am"</span>)</span>
<span id="cb31-139"><a href="#cb31-139"></a>high_miss <span class="ot">&lt;-</span> high_miss_cols[high_miss_cols <span class="sc">%in%</span> <span class="fu">names</span>(df)]</span>
<span id="cb31-140"><a href="#cb31-140"></a></span>
<span id="cb31-141"><a href="#cb31-141"></a><span class="fu">cat</span>(<span class="st">"High missingness variables:"</span>, <span class="fu">paste</span>(high_miss, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb31-142"><a href="#cb31-142"></a></span>
<span id="cb31-143"><a href="#cb31-143"></a>miss_mat <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb31-144"><a href="#cb31-144"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(high_miss)) <span class="sc">%&gt;%</span></span>
<span id="cb31-145"><a href="#cb31-145"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), is.na)) <span class="sc">%&gt;%</span></span>
<span id="cb31-146"><a href="#cb31-146"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-147"><a href="#cb31-147"></a>  <span class="fu">apply</span>(<span class="dv">2</span>, as.integer)</span>
<span id="cb31-148"><a href="#cb31-148"></a></span>
<span id="cb31-149"><a href="#cb31-149"></a>intersection_matrix <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(miss_mat)</span>
<span id="cb31-150"><a href="#cb31-150"></a>total_miss_counts <span class="ot">&lt;-</span> <span class="fu">diag</span>(intersection_matrix)</span>
<span id="cb31-151"><a href="#cb31-151"></a></span>
<span id="cb31-152"><a href="#cb31-152"></a>pct_matrix <span class="ot">&lt;-</span> intersection_matrix <span class="sc">/</span> total_miss_counts <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb31-153"><a href="#cb31-153"></a></span>
<span id="cb31-154"><a href="#cb31-154"></a>co_missing_stats <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(pct_matrix)) <span class="sc">%&gt;%</span></span>
<span id="cb31-155"><a href="#cb31-155"></a>  <span class="fu">rename</span>(<span class="at">var1 =</span> Var1, <span class="at">var2 =</span> Var2, <span class="at">pct_co_miss =</span> Freq) <span class="sc">%&gt;%</span></span>
<span id="cb31-156"><a href="#cb31-156"></a>  <span class="fu">filter</span>(var1 <span class="sc">!=</span> var2) <span class="sc">%&gt;%</span></span>
<span id="cb31-157"><a href="#cb31-157"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pct_co_miss))</span>
<span id="cb31-158"><a href="#cb31-158"></a></span>
<span id="cb31-159"><a href="#cb31-159"></a>co_missing_stats <span class="sc">%&gt;%</span></span>
<span id="cb31-160"><a href="#cb31-160"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-161"><a href="#cb31-161"></a>    <span class="at">msg =</span> <span class="fu">glue</span>(</span>
<span id="cb31-162"><a href="#cb31-162"></a>      <span class="st">"  {var1} -&gt; {var2}: {round(pct_co_miss, 1)}%  (when {var1} is missing, {var2} is missing)"</span></span>
<span id="cb31-163"><a href="#cb31-163"></a>    )</span>
<span id="cb31-164"><a href="#cb31-164"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-165"><a href="#cb31-165"></a>  <span class="fu">pull</span>(msg) <span class="sc">%&gt;%</span></span>
<span id="cb31-166"><a href="#cb31-166"></a>  <span class="fu">walk</span>(cat, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-167"><a href="#cb31-167"></a></span>
<span id="cb31-168"><a href="#cb31-168"></a>co_missing_stats <span class="sc">%&gt;%</span></span>
<span id="cb31-169"><a href="#cb31-169"></a>  <span class="fu">kable</span>(</span>
<span id="cb31-170"><a href="#cb31-170"></a>    <span class="at">caption =</span> <span class="st">"Conditional Co-missingness:</span></span>
<span id="cb31-171"><a href="#cb31-171"></a><span class="st">              when var1 is missing, what percentage of the time is var2 also missing?"</span>,</span>
<span id="cb31-172"><a href="#cb31-172"></a>    <span class="at">digits =</span> <span class="dv">1</span>,</span>
<span id="cb31-173"><a href="#cb31-173"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variable 1 (Missing)"</span>, <span class="st">"Variable 2"</span>, <span class="st">"Co-missing (%)"</span>)</span>
<span id="cb31-174"><a href="#cb31-174"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-175"><a href="#cb31-175"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-176"><a href="#cb31-176"></a><span class="in">```</span></span>
<span id="cb31-177"><a href="#cb31-177"></a></span>
<span id="cb31-178"><a href="#cb31-178"></a>The co-missingness matrix (@tbl-co-missingness) confirms that these four variables fail as a systematic cluster rather than independently. The dependencies are strongest between instrumental pairs: if evaporation is missing, there is a 93.2% probability that sunshine is also missing. Even the weakest relationship in the matrix (sunshine to cloud9am) retains a rate of 67.5%, which is nearly double what would be expected under random failure.</span>
<span id="cb31-179"><a href="#cb31-179"></a></span>
<span id="cb31-180"><a href="#cb31-180"></a>Under MCAR, the co-missing rates would be close to the marginal missingness rates of each variable, roughly 40 to 48%. Rates uniformly between 67% and 93% instead indicate a shared upstream cause: the instrumentation profile of each station. Sunshine recorders, evaporation pans, and cloud coverage sensors are deployed as a package, not individually. A station without one is very likely to lack the others. This is MNAR at the station level. The practical consequence for imputation is that treating the four variables as independently missing would be incorrect: their correlations when observed are available precisely because they fail together, and a multivariate imputation method that exploits those cross-variable relationships will outperform four separate univariate models.</span>
<span id="cb31-181"><a href="#cb31-181"></a></span>
<span id="cb31-182"><a href="#cb31-182"></a><span class="fu">### Temporal Structure and Structural Breaks {#sec-temporal-structure}</span></span>
<span id="cb31-183"><a href="#cb31-183"></a></span>
<span id="cb31-186"><a href="#cb31-186"></a><span class="in">```{r}</span></span>
<span id="cb31-187"><a href="#cb31-187"></a><span class="co">#| label: fig-temporal-missingness</span></span>
<span id="cb31-188"><a href="#cb31-188"></a><span class="co">#| fig-cap: "Timeline of systematic missingness across the four high-missingness variables. The stepped increases visible particularly in sunshine and evaporation indicate structural breaks in data collection rather than random sensor failures."</span></span>
<span id="cb31-189"><a href="#cb31-189"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb31-190"><a href="#cb31-190"></a><span class="co">#| fig-height: 7</span></span>
<span id="cb31-191"><a href="#cb31-191"></a><span class="co">#| echo: true</span></span>
<span id="cb31-192"><a href="#cb31-192"></a><span class="co">#| warning: false</span></span>
<span id="cb31-193"><a href="#cb31-193"></a></span>
<span id="cb31-194"><a href="#cb31-194"></a>temporal_trend <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb31-195"><a href="#cb31-195"></a>  <span class="fu">mutate</span>(<span class="at">month_floor =</span> <span class="fu">floor_date</span>(date, <span class="st">"month"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-196"><a href="#cb31-196"></a>  <span class="fu">select</span>(month_floor, <span class="fu">any_of</span>(high_miss)) <span class="sc">%&gt;%</span></span>
<span id="cb31-197"><a href="#cb31-197"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb31-198"><a href="#cb31-198"></a>    <span class="at">cols =</span> <span class="sc">-</span>month_floor,</span>
<span id="cb31-199"><a href="#cb31-199"></a>    <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb31-200"><a href="#cb31-200"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb31-201"><a href="#cb31-201"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-202"><a href="#cb31-202"></a>  <span class="fu">group_by</span>(month_floor, variable) <span class="sc">%&gt;%</span></span>
<span id="cb31-203"><a href="#cb31-203"></a>  <span class="fu">summarise</span>(<span class="at">pct_missing =</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(value)) <span class="sc">*</span> <span class="dv">100</span>, <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb31-204"><a href="#cb31-204"></a></span>
<span id="cb31-205"><a href="#cb31-205"></a><span class="fu">ggplot</span>(</span>
<span id="cb31-206"><a href="#cb31-206"></a>  temporal_trend,</span>
<span id="cb31-207"><a href="#cb31-207"></a>  <span class="fu">aes</span>(<span class="at">x =</span> month_floor, <span class="at">y =</span> pct_missing)</span>
<span id="cb31-208"><a href="#cb31-208"></a>) <span class="sc">+</span></span>
<span id="cb31-209"><a href="#cb31-209"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">"grey80"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-210"><a href="#cb31-210"></a>  <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"#2C7BB6"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb31-211"><a href="#cb31-211"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb31-212"><a href="#cb31-212"></a>    <span class="at">yintercept =</span> <span class="dv">50</span>,</span>
<span id="cb31-213"><a href="#cb31-213"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb31-214"><a href="#cb31-214"></a>    <span class="at">colour =</span> <span class="st">"grey50"</span>,</span>
<span id="cb31-215"><a href="#cb31-215"></a>    <span class="at">linewidth =</span> <span class="fl">0.4</span></span>
<span id="cb31-216"><a href="#cb31-216"></a>  ) <span class="sc">+</span></span>
<span id="cb31-217"><a href="#cb31-217"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb31-218"><a href="#cb31-218"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb31-219"><a href="#cb31-219"></a>    <span class="at">date_breaks =</span> <span class="st">"2 years"</span>,</span>
<span id="cb31-220"><a href="#cb31-220"></a>    <span class="at">date_labels =</span> <span class="st">"%Y"</span>,</span>
<span id="cb31-221"><a href="#cb31-221"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="dv">0</span>)</span>
<span id="cb31-222"><a href="#cb31-222"></a>  ) <span class="sc">+</span></span>
<span id="cb31-223"><a href="#cb31-223"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb31-224"><a href="#cb31-224"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb31-225"><a href="#cb31-225"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>)</span>
<span id="cb31-226"><a href="#cb31-226"></a>  ) <span class="sc">+</span></span>
<span id="cb31-227"><a href="#cb31-227"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-228"><a href="#cb31-228"></a>    <span class="at">title =</span> <span class="st">"Temporal Structure of Missingness by Variable"</span>,</span>
<span id="cb31-229"><a href="#cb31-229"></a>    <span class="at">subtitle =</span> <span class="st">"Step changes indicate structural data collection breaks</span></span>
<span id="cb31-230"><a href="#cb31-230"></a><span class="st">                rather than random sensor failures"</span>,</span>
<span id="cb31-231"><a href="#cb31-231"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-232"><a href="#cb31-232"></a>    <span class="at">y =</span> <span class="st">"Missing (%)"</span>,</span>
<span id="cb31-233"><a href="#cb31-233"></a>    <span class="at">caption =</span> <span class="st">"Dashed line at 50%. Monthly aggregation."</span></span>
<span id="cb31-234"><a href="#cb31-234"></a>  ) <span class="sc">+</span></span>
<span id="cb31-235"><a href="#cb31-235"></a>  report_theme <span class="sc">+</span></span>
<span id="cb31-236"><a href="#cb31-236"></a>  <span class="fu">theme</span>(<span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>))</span>
<span id="cb31-237"><a href="#cb31-237"></a><span class="in">```</span></span>
<span id="cb31-238"><a href="#cb31-238"></a></span>
<span id="cb31-239"><a href="#cb31-239"></a>The temporal analysis (@fig-temporal-missingness) confirms that missingness is not randomly distributed over time. The cloud cover variables maintain a roughly stable and high missingness rate across the observation window, consistent with a fixed set of stations never having recorded these measurements. The <span class="in">`sunshine`</span> and <span class="in">`evaporation`</span> variables show a distinct stepped pattern: missingness rises at specific breakpoints rather than fluctuating randomly, indicating that certain stations were decommissioned or that recording protocols changed at identifiable calendar dates.</span>
<span id="cb31-240"><a href="#cb31-240"></a></span>
<span id="cb31-241"><a href="#cb31-241"></a>This temporal structure has a direct implication for the interpolation stage of the pipeline. Linear interpolation is appropriate when a smooth trajectory can be inferred from values on either side of a gap. Extended contiguous gaps produced by a structural break have no valid upper boundary from which to interpolate, and filling them with temporal interpolation would create long synthetic sequences with no empirical anchor. The five-day interpolation cap set in Stage 1 of the pipeline is a direct response to this finding.</span>
<span id="cb31-242"><a href="#cb31-242"></a></span>
<span id="cb31-243"><a href="#cb31-243"></a><span class="fu">### Geographic Concentration: Ghost Sensor Identification {#sec-ghost-sensor}</span></span>
<span id="cb31-244"><a href="#cb31-244"></a></span>
<span id="cb31-247"><a href="#cb31-247"></a><span class="in">```{r}</span></span>
<span id="cb31-248"><a href="#cb31-248"></a><span class="co">#| label: ghost-sensors</span></span>
<span id="cb31-249"><a href="#cb31-249"></a><span class="co">#| echo: true</span></span>
<span id="cb31-250"><a href="#cb31-250"></a><span class="co">#| message: false</span></span>
<span id="cb31-251"><a href="#cb31-251"></a><span class="co">#| warning: false</span></span>
<span id="cb31-252"><a href="#cb31-252"></a></span>
<span id="cb31-253"><a href="#cb31-253"></a>GHOST_THRESHOLD <span class="ot">&lt;-</span> <span class="fl">0.90</span></span>
<span id="cb31-254"><a href="#cb31-254"></a></span>
<span id="cb31-255"><a href="#cb31-255"></a>location_summary <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb31-256"><a href="#cb31-256"></a>  <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb31-257"><a href="#cb31-257"></a>  naniar<span class="sc">::</span><span class="fu">miss_var_summary</span>()</span>
<span id="cb31-258"><a href="#cb31-258"></a></span>
<span id="cb31-259"><a href="#cb31-259"></a>ghost_sensors <span class="ot">&lt;-</span> location_summary <span class="sc">%&gt;%</span></span>
<span id="cb31-260"><a href="#cb31-260"></a>  <span class="fu">filter</span>(variable <span class="sc">%in%</span> high_miss, pct_miss <span class="sc">&gt;</span> GHOST_THRESHOLD <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-261"><a href="#cb31-261"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pct_miss))</span>
<span id="cb31-262"><a href="#cb31-262"></a></span>
<span id="cb31-263"><a href="#cb31-263"></a>ghost_sensors <span class="sc">%&gt;%</span></span>
<span id="cb31-264"><a href="#cb31-264"></a>  <span class="fu">kable</span>(</span>
<span id="cb31-265"><a href="#cb31-265"></a>    <span class="at">caption =</span> <span class="st">"Ghost Sensor Instances: Location-Variable Pairs </span></span>
<span id="cb31-266"><a href="#cb31-266"></a><span class="st">               with &gt;90% Missingness"</span>,</span>
<span id="cb31-267"><a href="#cb31-267"></a>    <span class="at">digits =</span> <span class="dv">1</span>,</span>
<span id="cb31-268"><a href="#cb31-268"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Location"</span>, <span class="st">"Variable"</span>, <span class="st">"Missing (n)"</span>, <span class="st">"Missing (%)"</span>)</span>
<span id="cb31-269"><a href="#cb31-269"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-270"><a href="#cb31-270"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-271"><a href="#cb31-271"></a></span>
<span id="cb31-272"><a href="#cb31-272"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(</span>
<span id="cb31-273"><a href="#cb31-273"></a>  <span class="st">"</span><span class="sc">\n</span><span class="st">Total ghost sensor instances identified: %d across %d locations</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb31-274"><a href="#cb31-274"></a>  <span class="fu">nrow</span>(ghost_sensors),</span>
<span id="cb31-275"><a href="#cb31-275"></a>  <span class="fu">n_distinct</span>(ghost_sensors<span class="sc">$</span>location)</span>
<span id="cb31-276"><a href="#cb31-276"></a>))</span>
<span id="cb31-277"><a href="#cb31-277"></a><span class="in">```</span></span>
<span id="cb31-278"><a href="#cb31-278"></a></span>
<span id="cb31-279"><a href="#cb31-279"></a>The location-level analysis identifies the specific station-variable pairs responsible for the bulk of the aggregate missingness. The top ten instances from the script output, all at exactly 100% missing, are as follows: Albury (<span class="in">`evaporation`</span>, 3,040 observations; <span class="in">`sunshine`</span>, 3,040), BadgerysCreek (<span class="in">`evaporation`</span>, 3,009; <span class="in">`sunshine`</span>, 3,009; <span class="in">`cloud9am`</span>, 3,009; <span class="in">`cloud3pm`</span>, 3,009), Newcastle (<span class="in">`evaporation`</span>, 3,039; <span class="in">`sunshine`</span>, 3,039), and NorahHead (<span class="in">`evaporation`</span>, 3,004; <span class="in">`sunshine`</span>, 3,004). At these stations, the instrument in question recorded a value on zero days across the entire observation window. These are not sensors experiencing intermittent failure; they are sensors that were never present or that were removed before the data collection period began.</span>
<span id="cb31-280"><a href="#cb31-280"></a></span>
<span id="cb31-281"><a href="#cb31-281"></a>The distinction between ghost sensors and ordinary missingness is consequential for imputation. For a gap of five to fifteen consecutive missing days, a Random Forest model can generate reasonable predictions by drawing on correlated variables at the same station and the same variable at nearby stations. For a gap spanning 3,000 or more consecutive observations, this extrapolation has no empirical support whatsoever: there is no observed value at that station and variable combination to anchor or validate the prediction. Values produced for these pairs would be statistically plausible by construction but would carry no physical information about what the instrument would have actually recorded. Ghost sensor pairs are identified before Stage 2 runs and flagged so that their imputed values can be treated with appropriate scepticism in downstream analysis.</span>
<span id="cb31-282"><a href="#cb31-282"></a></span>
<span id="cb31-283"><a href="#cb31-283"></a><span class="fu">### Weather-Conditionality of Sunshine Missingness {#sec-weather-conditionality}</span></span>
<span id="cb31-284"><a href="#cb31-284"></a></span>
<span id="cb31-287"><a href="#cb31-287"></a><span class="in">```{r}</span></span>
<span id="cb31-288"><a href="#cb31-288"></a><span class="co">#| label: tbl-sunshine-mcar-test</span></span>
<span id="cb31-289"><a href="#cb31-289"></a><span class="co">#| echo: true</span></span>
<span id="cb31-290"><a href="#cb31-290"></a><span class="co">#| message: false</span></span>
<span id="cb31-291"><a href="#cb31-291"></a><span class="co">#| warning: false</span></span>
<span id="cb31-292"><a href="#cb31-292"></a></span>
<span id="cb31-293"><a href="#cb31-293"></a><span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"rainfall"</span>, <span class="st">"sunshine"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(df))) {</span>
<span id="cb31-294"><a href="#cb31-294"></a>  weather_missing_stats <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb31-295"><a href="#cb31-295"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rainfall)) <span class="sc">%&gt;%</span></span>
<span id="cb31-296"><a href="#cb31-296"></a>    <span class="fu">mutate</span>(<span class="at">is_rainy =</span> <span class="fu">if_else</span>(rainfall <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="st">"Rainy (&gt;1mm)"</span>, <span class="st">"Dry (&lt;=1mm)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-297"><a href="#cb31-297"></a>    <span class="fu">group_by</span>(is_rainy) <span class="sc">%&gt;%</span></span>
<span id="cb31-298"><a href="#cb31-298"></a>    <span class="fu">summarise</span>(</span>
<span id="cb31-299"><a href="#cb31-299"></a>      <span class="at">n_obs =</span> <span class="fu">n</span>(),</span>
<span id="cb31-300"><a href="#cb31-300"></a>      <span class="at">pct_sunshine_missing =</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(sunshine)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb31-301"><a href="#cb31-301"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb31-302"><a href="#cb31-302"></a>    )</span>
<span id="cb31-303"><a href="#cb31-303"></a></span>
<span id="cb31-304"><a href="#cb31-304"></a>  <span class="fu">print</span>(weather_missing_stats)</span>
<span id="cb31-305"><a href="#cb31-305"></a></span>
<span id="cb31-306"><a href="#cb31-306"></a>  weather_missing_stats <span class="sc">%&gt;%</span></span>
<span id="cb31-307"><a href="#cb31-307"></a>    <span class="fu">kable</span>(</span>
<span id="cb31-308"><a href="#cb31-308"></a>      <span class="at">caption =</span> <span class="st">"Sunshine Missingness Rate by Daily Rainfall Status"</span>,</span>
<span id="cb31-309"><a href="#cb31-309"></a>      <span class="at">digits =</span> <span class="dv">1</span>,</span>
<span id="cb31-310"><a href="#cb31-310"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Day Type"</span>, <span class="st">"Observations (n)"</span>, <span class="st">"Sunshine Missing (%)"</span>)</span>
<span id="cb31-311"><a href="#cb31-311"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb31-312"><a href="#cb31-312"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-313"><a href="#cb31-313"></a>}</span>
<span id="cb31-314"><a href="#cb31-314"></a><span class="in">```</span></span>
<span id="cb31-315"><a href="#cb31-315"></a></span>
<span id="cb31-318"><a href="#cb31-318"></a><span class="in">```{r}</span></span>
<span id="cb31-319"><a href="#cb31-319"></a><span class="co">#| label: fig-sunshine-rainfall-density</span></span>
<span id="cb31-320"><a href="#cb31-320"></a><span class="co">#| fig-cap: "Density of rainfall amounts on days where sunshine data is present versus missing. The near-identical distributions confirm that sunshine missingness is not weather-conditional: the same stations are missing sunshine on both dry and rainy days because the instrument was simply not installed, not because it failed during precipitation events."</span></span>
<span id="cb31-321"><a href="#cb31-321"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb31-322"><a href="#cb31-322"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb31-323"><a href="#cb31-323"></a><span class="co">#| echo: true</span></span>
<span id="cb31-324"><a href="#cb31-324"></a><span class="co">#| warning: false</span></span>
<span id="cb31-325"><a href="#cb31-325"></a></span>
<span id="cb31-326"><a href="#cb31-326"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb31-327"><a href="#cb31-327"></a>  naniar<span class="sc">::</span><span class="fu">bind_shadow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-328"><a href="#cb31-328"></a>  <span class="fu">filter</span>(rainfall <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> rainfall <span class="sc">&lt;</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-329"><a href="#cb31-329"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rainfall, <span class="at">fill =</span> sunshine_NA, <span class="at">colour =</span> sunshine_NA)) <span class="sc">+</span></span>
<span id="cb31-330"><a href="#cb31-330"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb31-331"><a href="#cb31-331"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb31-332"><a href="#cb31-332"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"!NA"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>, <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>),</span>
<span id="cb31-333"><a href="#cb31-333"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"!NA"</span> <span class="ot">=</span> <span class="st">"Present"</span>, <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"Missing"</span>)</span>
<span id="cb31-334"><a href="#cb31-334"></a>  ) <span class="sc">+</span></span>
<span id="cb31-335"><a href="#cb31-335"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb31-336"><a href="#cb31-336"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"!NA"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>, <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>),</span>
<span id="cb31-337"><a href="#cb31-337"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"!NA"</span> <span class="ot">=</span> <span class="st">"Present"</span>, <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"Missing"</span>),</span>
<span id="cb31-338"><a href="#cb31-338"></a>    <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb31-339"><a href="#cb31-339"></a>  ) <span class="sc">+</span></span>
<span id="cb31-340"><a href="#cb31-340"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-341"><a href="#cb31-341"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-342"><a href="#cb31-342"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-343"><a href="#cb31-343"></a>    <span class="at">title =</span> <span class="st">"Sunshine Missingness is Not Rainfall-Conditional"</span>,</span>
<span id="cb31-344"><a href="#cb31-344"></a>    <span class="at">subtitle =</span> <span class="st">"Rainfall distributions are near-identical whether sunshine data</span></span>
<span id="cb31-345"><a href="#cb31-345"></a><span class="st">                is present or absent,</span><span class="sc">\n</span><span class="st">confirming missingness is driven by station</span></span>
<span id="cb31-346"><a href="#cb31-346"></a><span class="st">                instrumentation, not weather conditions"</span>,</span>
<span id="cb31-347"><a href="#cb31-347"></a>    <span class="at">x =</span> <span class="st">"Daily Rainfall (mm)"</span>,</span>
<span id="cb31-348"><a href="#cb31-348"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb31-349"><a href="#cb31-349"></a>    <span class="at">fill =</span> <span class="st">"Sunshine Data"</span>,</span>
<span id="cb31-350"><a href="#cb31-350"></a>    <span class="at">caption =</span> <span class="st">"Restricted to rainfall &gt; 0 and &lt; 50 mm. Kernel density estimate."</span></span>
<span id="cb31-351"><a href="#cb31-351"></a>  ) <span class="sc">+</span></span>
<span id="cb31-352"><a href="#cb31-352"></a>  report_theme</span>
<span id="cb31-353"><a href="#cb31-353"></a><span class="in">```</span></span>
<span id="cb31-354"><a href="#cb31-354"></a></span>
<span id="cb31-355"><a href="#cb31-355"></a>A specific concern when imputing a predictor variable is outcome-related missingness: if sunshine sensors failed more often on rainy days, then the imputed values would carry a directional signal about the target variable and could introduce bias into the training data.</span>
<span id="cb31-356"><a href="#cb31-356"></a></span>
<span id="cb31-357"><a href="#cb31-357"></a>The empirical test refutes this concern. The table output (@tbl-sunshine-mcar-test) reports a sunshine missing rate of 47.8% on 110,319 dry days (rainfall at most 1 mm) and 47.2% on 31,880 rainy days (rainfall above 1 mm), a difference of 0.6 percentage points. The density plot (@fig-sunshine-rainfall-density) makes the same point visually: the distribution of rainfall amounts on days with missing sunshine and on days with present sunshine are indistinguishable across the full range from 0 to 50 mm. The slight visual offset in the figure reflects not a systematic pattern but the difference in the sizes of the two groups.</span>
<span id="cb31-358"><a href="#cb31-358"></a></span>
<span id="cb31-359"><a href="#cb31-359"></a>Sunshine missingness is station-conditional rather than weather-conditional. The same stations record missing sunshine on both dry and rainy days at nearly identical rates, because the instrument is absent from those stations entirely. This finding clears the imputation path: there is no outcome-related confound to correct for.</span>
<span id="cb31-360"><a href="#cb31-360"></a></span>
<span id="cb31-361"><a href="#cb31-361"></a><span class="fu">### Missing Pattern Structure</span></span>
<span id="cb31-362"><a href="#cb31-362"></a></span>
<span id="cb31-365"><a href="#cb31-365"></a><span class="in">```{r}</span></span>
<span id="cb31-366"><a href="#cb31-366"></a><span class="co">#| label: miss-pattern-table</span></span>
<span id="cb31-367"><a href="#cb31-367"></a><span class="co">#| echo: true</span></span>
<span id="cb31-368"><a href="#cb31-368"></a><span class="co">#| message: false</span></span>
<span id="cb31-369"><a href="#cb31-369"></a><span class="co">#| warning: false</span></span>
<span id="cb31-370"><a href="#cb31-370"></a></span>
<span id="cb31-371"><a href="#cb31-371"></a><span class="fu">cat</span>(<span class="st">"Missing pattern combinations:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-372"><a href="#cb31-372"></a></span>
<span id="cb31-373"><a href="#cb31-373"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb31-374"><a href="#cb31-374"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(high_miss)) <span class="sc">%&gt;%</span></span>
<span id="cb31-375"><a href="#cb31-375"></a>  naniar<span class="sc">::</span><span class="fu">miss_case_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-376"><a href="#cb31-376"></a>  <span class="fu">print</span>()</span>
<span id="cb31-377"><a href="#cb31-377"></a></span>
<span id="cb31-378"><a href="#cb31-378"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb31-379"><a href="#cb31-379"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(high_miss)) <span class="sc">%&gt;%</span></span>
<span id="cb31-380"><a href="#cb31-380"></a>  naniar<span class="sc">::</span><span class="fu">miss_case_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-381"><a href="#cb31-381"></a>  <span class="fu">kable</span>(</span>
<span id="cb31-382"><a href="#cb31-382"></a>    <span class="at">caption =</span> <span class="st">"Distribution of Missing Variable Count per Observation"</span>,</span>
<span id="cb31-383"><a href="#cb31-383"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb31-384"><a href="#cb31-384"></a>      <span class="st">"Variables Missing (of 4)"</span>,</span>
<span id="cb31-385"><a href="#cb31-385"></a>      <span class="st">"Observations (n)"</span>,</span>
<span id="cb31-386"><a href="#cb31-386"></a>      <span class="st">"Percentage (%)"</span></span>
<span id="cb31-387"><a href="#cb31-387"></a>    )</span>
<span id="cb31-388"><a href="#cb31-388"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-389"><a href="#cb31-389"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-390"><a href="#cb31-390"></a><span class="in">```</span></span>
<span id="cb31-391"><a href="#cb31-391"></a></span>
<span id="cb31-392"><a href="#cb31-392"></a>The case-level output from the script reveals a strongly bimodal structure across five distinct patterns. Of all observations: 62,566 (43.0%) have none of the four variables missing; 10,525 (7.2%) have exactly one missing; 20,376 (14.0%) have exactly two missing; 11,378 (7.8%) have exactly three missing; and 40,615 (27.9%) have all four missing simultaneously. The two endpoint categories, zero missing and all four missing, together account for 70.9% of all observations.</span>
<span id="cb31-393"><a href="#cb31-393"></a></span>
<span id="cb31-394"><a href="#cb31-394"></a>The 27.9% with complete simultaneous missingness corresponds directly to the ghost sensor stations identified in @sec-ghost-sensor. For these observations, no imputation is supportable and the values remain missing after the pipeline. The 43.0% with no missingness require no intervention. The substantive imputation work is concentrated in the remaining 29.1% across the three intermediate patterns, where partial instrumentation means that correlated predictors are available to inform the Random Forest estimates. The bimodal structure also confirms that the co-missingness finding is not a statistical artifact: observations genuinely tend to be fully instrumented or minimally instrumented, not randomly partially instrumented.</span>
<span id="cb31-395"><a href="#cb31-395"></a></span>
<span id="cb31-396"><a href="#cb31-396"></a>---</span>
<span id="cb31-397"><a href="#cb31-397"></a></span>
<span id="cb31-398"><a href="#cb31-398"></a><span class="fu">## Imputation Pipeline {#sec-imputation-pipeline}</span></span>
<span id="cb31-399"><a href="#cb31-399"></a></span>
<span id="cb31-400"><a href="#cb31-400"></a>The diagnostic evidence from @sec-missingness-diagnostics motivates each design decision in the imputation pipeline. Missingness is station-level rather than weather-conditional (@sec-weather-conditionality), temporally structured with extended contiguous gaps rather than random scatter (@sec-temporal-structure), and co-located across variables at the station level (@sec-co-missingness). These properties rule out simple listwise deletion and mean imputation. They call for a pipeline that respects temporal continuity for smoothly-evolving variables, exploits cross-variable correlations for the structured variables, and declines to impute where the data is genuinely unrecoverable.</span>
<span id="cb31-401"><a href="#cb31-401"></a></span>
<span id="cb31-402"><a href="#cb31-402"></a><span class="fu">### Stage 1: Temporal Interpolation</span></span>
<span id="cb31-403"><a href="#cb31-403"></a></span>
<span id="cb31-404"><a href="#cb31-404"></a>The eight variables with smooth day-to-day trajectories minimum and maximum temperature, morning and afternoon temperature, morning and afternoon pressure, and morning and afternoon humidity are imputed via linear interpolation grouped by location, bounded by a five-day maximum gap. The five-day cap is set directly in response to the temporal structural break finding: gaps of up to five days lie within a regime where the values at both boundaries sufficiently constrain the trajectory, while longer gaps are associated with structural collection failures that interpolation cannot safely bridge.</span>
<span id="cb31-405"><a href="#cb31-405"></a></span>
<span id="cb31-406"><a href="#cb31-406"></a><span class="fu">### Stage 2: Multivariate Imputation via Predictive Mean Matching and Random Forest</span></span>
<span id="cb31-407"><a href="#cb31-407"></a></span>
<span id="cb31-408"><a href="#cb31-408"></a>Remaining gaps in <span class="in">`sunshine`</span>, <span class="in">`evaporation`</span>, <span class="in">`cloud9am`</span>, <span class="in">`cloud3pm`</span>, and the three wind direction variables are addressed using <span class="in">`mice`</span> with method assignments differentiated by variable type.</span>
<span id="cb31-409"><a href="#cb31-409"></a></span>
<span id="cb31-410"><a href="#cb31-410"></a>The four continuous atmospheric variables (<span class="in">`sunshine`</span>, <span class="in">`evaporation`</span>, <span class="in">`cloud9am`</span>, <span class="in">`cloud3pm`</span>) are imputed using predictive mean matching (PMM). PMM draws imputed values from a pool of observed donor observations whose predicted values are closest to the predicted value of the missing case, rather than using the model prediction directly. This has two practical advantages over a point-prediction method for these variables. First, PMM is constrained to return values that exist in the observed data, which enforces physical bounds without requiring explicit constraints. Second, the stochastic donor draw introduces genuine between-imputation variability, which is necessary for valid Rubin's Rules variance decomposition downstream. Each variable is imputed from a physically motivated predictor set:</span>
<span id="cb31-411"><a href="#cb31-411"></a></span>
<span id="cb31-412"><a href="#cb31-412"></a><span class="ss">- </span>**Cloud cover** (<span class="in">`cloud9am`</span>, <span class="in">`cloud3pm`</span>) from morning and afternoon humidity, morning pressure, location, and month.</span>
<span id="cb31-413"><a href="#cb31-413"></a><span class="ss">- </span>**Sunshine** from cloud cover at both observation times, maximum temperature, afternoon humidity, location, and month.</span>
<span id="cb31-414"><a href="#cb31-414"></a><span class="ss">- </span>**Evaporation** from wind gust speed, maximum temperature, afternoon humidity, sunshine, location, and month.</span>
<span id="cb31-415"><a href="#cb31-415"></a></span>
<span id="cb31-416"><a href="#cb31-416"></a>The three wind direction variables (<span class="in">`wind_gust_dir`</span>, <span class="in">`wind_dir9am`</span>, <span class="in">`wind_dir3pm`</span>) are imputed using Random Forest. Wind direction is a multi-class unordered categorical variable with sixteen compass-point levels. PMM is not appropriate for unordered factors because it imposes an implicit numeric ordering on the donor matching step. Random Forest handles the multi-class non-ordinal structure natively by splitting on class membership rather than on numeric distance. Each wind direction variable is conditioned on its temporally matched wind speed and pressure readings: gust direction from gust speed and afternoon pressure, morning direction from morning speed and morning pressure, and afternoon direction from afternoon speed and afternoon pressure. This preserves the physical coupling between concurrent wind speed and direction measurements.</span>
<span id="cb31-417"><a href="#cb31-417"></a></span>
<span id="cb31-418"><a href="#cb31-418"></a>The use of targeted predictor sets for all variables is motivated directly by the co-missingness finding in @sec-co-missingness. Because the four atmospheric variables tend to be absent together at the station level, their cross-variable correlations when observed are strong and reliable signals for imputation. Restricting each variable's predictor set to physically motivated covariates exploits this structure while reducing the risk of imputing on spurious correlations introduced by including variables that carry no physical relationship to the target.</span>
<span id="cb31-419"><a href="#cb31-419"></a></span>
<span id="cb31-420"><a href="#cb31-420"></a><span class="fu">### Ghost Sensor Flagging</span></span>
<span id="cb31-421"><a href="#cb31-421"></a></span>
<span id="cb31-422"><a href="#cb31-422"></a>Before Stage 2 runs, all station-variable pairs identified in @sec-ghost-sensor as ghost sensors (more than 90% missing across the full observation window) are catalogued and binary missingness flags are attached to the data (<span class="in">`sunshine_imp_flagged`</span>, <span class="in">`evap_imp_flagged`</span>, <span class="in">`cloud3pm_imp_flagged`</span>, <span class="in">`cloud9am_imp_flagged`</span>). These flags serve two purposes: they are excluded from the MICE predictor matrix so they cannot contaminate the imputation model, and they remain in the final dataset as explicit markers of which values are extrapolated with no empirical anchor at the station level. The raw date column is also excluded from the predictor matrix to prevent temporal data leakage. Neither PMM nor Random Forest has empirical support for predicting values at a station where an instrument was never present; the flags make this provenance transparent for any downstream analysis that needs to account for it.</span>
<span id="cb31-423"><a href="#cb31-423"></a></span>
<span id="cb31-426"><a href="#cb31-426"></a><span class="in">```{r}</span></span>
<span id="cb31-427"><a href="#cb31-427"></a><span class="co">#| label: imputation-strategy</span></span>
<span id="cb31-428"><a href="#cb31-428"></a><span class="co">#| echo: true</span></span>
<span id="cb31-429"><a href="#cb31-429"></a><span class="co">#| eval: false</span></span>
<span id="cb31-430"><a href="#cb31-430"></a></span>
<span id="cb31-431"><a href="#cb31-431"></a>clean_and_impute_weather <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb31-432"><a href="#cb31-432"></a>  MAXGAP <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb31-433"><a href="#cb31-433"></a>  GHOST_THRESHOLD <span class="ot">&lt;-</span> <span class="fl">0.90</span></span>
<span id="cb31-434"><a href="#cb31-434"></a>  M <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb31-435"><a href="#cb31-435"></a></span>
<span id="cb31-436"><a href="#cb31-436"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb31-437"><a href="#cb31-437"></a>    <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-438"><a href="#cb31-438"></a>    <span class="fu">mutate</span>(</span>
<span id="cb31-439"><a href="#cb31-439"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb31-440"><a href="#cb31-440"></a>      <span class="at">month =</span> <span class="fu">as.factor</span>(<span class="fu">month</span>(date)),</span>
<span id="cb31-441"><a href="#cb31-441"></a>      <span class="at">day =</span> <span class="fu">as.factor</span>(<span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb31-442"><a href="#cb31-442"></a>      <span class="at">day_of_year =</span> <span class="fu">yday</span>(date),</span>
<span id="cb31-443"><a href="#cb31-443"></a>      <span class="at">wind_gust_dir =</span> <span class="fu">as.factor</span>(wind_gust_dir),</span>
<span id="cb31-444"><a href="#cb31-444"></a>      <span class="at">wind_dir9am =</span> <span class="fu">as.factor</span>(wind_dir9am),</span>
<span id="cb31-445"><a href="#cb31-445"></a>      <span class="at">wind_dir3pm =</span> <span class="fu">as.factor</span>(wind_dir3pm),</span>
<span id="cb31-446"><a href="#cb31-446"></a>      <span class="at">rain_today =</span> <span class="fu">as.factor</span>(rain_today),</span>
<span id="cb31-447"><a href="#cb31-447"></a>      <span class="at">location =</span> <span class="fu">as.factor</span>(location)</span>
<span id="cb31-448"><a href="#cb31-448"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb31-449"><a href="#cb31-449"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rainfall)) <span class="sc">%&gt;%</span></span>
<span id="cb31-450"><a href="#cb31-450"></a>    <span class="fu">select</span>(<span class="sc">-</span>rain_tomorrow)</span>
<span id="cb31-451"><a href="#cb31-451"></a></span>
<span id="cb31-452"><a href="#cb31-452"></a>  <span class="co"># Interpolation</span></span>
<span id="cb31-453"><a href="#cb31-453"></a>  interp_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-454"><a href="#cb31-454"></a>    <span class="st">"min_temp"</span>,</span>
<span id="cb31-455"><a href="#cb31-455"></a>    <span class="st">"max_temp"</span>,</span>
<span id="cb31-456"><a href="#cb31-456"></a>    <span class="st">"temp9am"</span>,</span>
<span id="cb31-457"><a href="#cb31-457"></a>    <span class="st">"temp3pm"</span>,</span>
<span id="cb31-458"><a href="#cb31-458"></a>    <span class="st">"pressure9am"</span>,</span>
<span id="cb31-459"><a href="#cb31-459"></a>    <span class="st">"pressure3pm"</span>,</span>
<span id="cb31-460"><a href="#cb31-460"></a>    <span class="st">"humidity9am"</span>,</span>
<span id="cb31-461"><a href="#cb31-461"></a>    <span class="st">"humidity3pm"</span></span>
<span id="cb31-462"><a href="#cb31-462"></a>  )</span>
<span id="cb31-463"><a href="#cb31-463"></a></span>
<span id="cb31-464"><a href="#cb31-464"></a>  df_interp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb31-465"><a href="#cb31-465"></a>    <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb31-466"><a href="#cb31-466"></a>    <span class="fu">arrange</span>(date, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-467"><a href="#cb31-467"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb31-468"><a href="#cb31-468"></a>      <span class="fu">all_of</span>(interp_vars),</span>
<span id="cb31-469"><a href="#cb31-469"></a>      <span class="sc">~</span> <span class="fu">na.approx</span>(., <span class="at">maxgap =</span> MAXGAP, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">rule =</span> <span class="dv">1</span>)</span>
<span id="cb31-470"><a href="#cb31-470"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb31-471"><a href="#cb31-471"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb31-472"><a href="#cb31-472"></a></span>
<span id="cb31-473"><a href="#cb31-473"></a>  <span class="co"># Flag ghost vars</span></span>
<span id="cb31-474"><a href="#cb31-474"></a>  ghost_prone_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sunshine"</span>, <span class="st">"evaporation"</span>, <span class="st">"cloud3pm"</span>, <span class="st">"cloud9am"</span>)</span>
<span id="cb31-475"><a href="#cb31-475"></a></span>
<span id="cb31-476"><a href="#cb31-476"></a>  ghost_pairs <span class="ot">&lt;-</span> df_interp <span class="sc">%&gt;%</span></span>
<span id="cb31-477"><a href="#cb31-477"></a>    <span class="fu">select</span>(location, <span class="fu">all_of</span>(ghost_prone_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb31-478"><a href="#cb31-478"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb31-479"><a href="#cb31-479"></a>      <span class="at">cols =</span> <span class="fu">all_of</span>(ghost_prone_vars),</span>
<span id="cb31-480"><a href="#cb31-480"></a>      <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb31-481"><a href="#cb31-481"></a>      <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb31-482"><a href="#cb31-482"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb31-483"><a href="#cb31-483"></a>    <span class="fu">group_by</span>(location, variable) <span class="sc">%&gt;%</span></span>
<span id="cb31-484"><a href="#cb31-484"></a>    <span class="fu">summarise</span>(<span class="at">miss_rate =</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(value)) <span class="sc">*</span> <span class="dv">100</span>, <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-485"><a href="#cb31-485"></a>    <span class="fu">filter</span>(miss_rate <span class="sc">&gt;</span> (GHOST_THRESHOLD <span class="sc">*</span> <span class="dv">100</span>))</span>
<span id="cb31-486"><a href="#cb31-486"></a></span>
<span id="cb31-487"><a href="#cb31-487"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Found %d ghost sensor instances:"</span>, <span class="fu">nrow</span>(ghost_pairs)))</span>
<span id="cb31-488"><a href="#cb31-488"></a></span>
<span id="cb31-489"><a href="#cb31-489"></a>  df_flagged <span class="ot">&lt;-</span> df_interp <span class="sc">%&gt;%</span></span>
<span id="cb31-490"><a href="#cb31-490"></a>    <span class="fu">mutate</span>(</span>
<span id="cb31-491"><a href="#cb31-491"></a>      <span class="at">sunshine_imp_flagged =</span> <span class="fu">as.integer</span>(<span class="fu">is.na</span>(sunshine)),</span>
<span id="cb31-492"><a href="#cb31-492"></a>      <span class="at">evap_imp_flagged =</span> <span class="fu">as.integer</span>(<span class="fu">is.na</span>(evaporation)),</span>
<span id="cb31-493"><a href="#cb31-493"></a>      <span class="at">cloud3pm_imp_flagged =</span> <span class="fu">as.integer</span>(<span class="fu">is.na</span>(cloud3pm)),</span>
<span id="cb31-494"><a href="#cb31-494"></a>      <span class="at">cloud9am_imp_flagged =</span> <span class="fu">as.integer</span>(<span class="fu">is.na</span>(cloud9am))</span>
<span id="cb31-495"><a href="#cb31-495"></a>    )</span>
<span id="cb31-496"><a href="#cb31-496"></a></span>
<span id="cb31-497"><a href="#cb31-497"></a>  <span class="co"># MICE setup</span></span>
<span id="cb31-498"><a href="#cb31-498"></a>  wind_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"wind_gust_dir"</span>, <span class="st">"wind_dir9am"</span>, <span class="st">"wind_dir3pm"</span>)</span>
<span id="cb31-499"><a href="#cb31-499"></a></span>
<span id="cb31-500"><a href="#cb31-500"></a>  init <span class="ot">&lt;-</span> <span class="fu">mice</span>(df_flagged, <span class="at">maxit =</span> <span class="dv">0</span>)</span>
<span id="cb31-501"><a href="#cb31-501"></a>  pred <span class="ot">&lt;-</span> init<span class="sc">$</span>predictorMatrix</span>
<span id="cb31-502"><a href="#cb31-502"></a>  meth <span class="ot">&lt;-</span> init<span class="sc">$</span>method</span>
<span id="cb31-503"><a href="#cb31-503"></a></span>
<span id="cb31-504"><a href="#cb31-504"></a>  pred[,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb31-505"><a href="#cb31-505"></a></span>
<span id="cb31-506"><a href="#cb31-506"></a>  meth[ghost_prone_vars] <span class="ot">&lt;-</span> <span class="st">"pmm"</span></span>
<span id="cb31-507"><a href="#cb31-507"></a>  meth[wind_vars] <span class="ot">&lt;-</span> <span class="st">"rf"</span></span>
<span id="cb31-508"><a href="#cb31-508"></a></span>
<span id="cb31-509"><a href="#cb31-509"></a>  sun_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb31-510"><a href="#cb31-510"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb31-511"><a href="#cb31-511"></a>    <span class="fu">c</span>(<span class="st">"cloud9am"</span>, <span class="st">"cloud3pm"</span>, <span class="st">"max_temp"</span>, <span class="st">"humidity3pm"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb31-512"><a href="#cb31-512"></a>  )</span>
<span id="cb31-513"><a href="#cb31-513"></a>  evap_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb31-514"><a href="#cb31-514"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb31-515"><a href="#cb31-515"></a>    <span class="fu">c</span>(</span>
<span id="cb31-516"><a href="#cb31-516"></a>      <span class="st">"wind_gust_speed"</span>,</span>
<span id="cb31-517"><a href="#cb31-517"></a>      <span class="st">"max_temp"</span>,</span>
<span id="cb31-518"><a href="#cb31-518"></a>      <span class="st">"humidity3pm"</span>,</span>
<span id="cb31-519"><a href="#cb31-519"></a>      <span class="st">"sunshine"</span>,</span>
<span id="cb31-520"><a href="#cb31-520"></a>      <span class="st">"location"</span>,</span>
<span id="cb31-521"><a href="#cb31-521"></a>      <span class="st">"month"</span></span>
<span id="cb31-522"><a href="#cb31-522"></a>    )</span>
<span id="cb31-523"><a href="#cb31-523"></a>  )</span>
<span id="cb31-524"><a href="#cb31-524"></a>  cloud_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb31-525"><a href="#cb31-525"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb31-526"><a href="#cb31-526"></a>    <span class="fu">c</span>(<span class="st">"humidity9am"</span>, <span class="st">"humidity3pm"</span>, <span class="st">"pressure9am"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb31-527"><a href="#cb31-527"></a>  )</span>
<span id="cb31-528"><a href="#cb31-528"></a>  wind_gust_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb31-529"><a href="#cb31-529"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb31-530"><a href="#cb31-530"></a>    <span class="fu">c</span>(<span class="st">"wind_gust_speed"</span>, <span class="st">"pressure3pm"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb31-531"><a href="#cb31-531"></a>  )</span>
<span id="cb31-532"><a href="#cb31-532"></a>  wind_9am_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb31-533"><a href="#cb31-533"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb31-534"><a href="#cb31-534"></a>    <span class="fu">c</span>(<span class="st">"wind_speed9am"</span>, <span class="st">"pressure9am"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb31-535"><a href="#cb31-535"></a>  )</span>
<span id="cb31-536"><a href="#cb31-536"></a>  wind_3pm_predictors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb31-537"><a href="#cb31-537"></a>    <span class="fu">colnames</span>(df_flagged),</span>
<span id="cb31-538"><a href="#cb31-538"></a>    <span class="fu">c</span>(<span class="st">"wind_speed3pm"</span>, <span class="st">"pressure3pm"</span>, <span class="st">"location"</span>, <span class="st">"month"</span>)</span>
<span id="cb31-539"><a href="#cb31-539"></a>  )</span>
<span id="cb31-540"><a href="#cb31-540"></a></span>
<span id="cb31-541"><a href="#cb31-541"></a>  <span class="cf">if</span> (<span class="st">"sunshine"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb31-542"><a href="#cb31-542"></a>    pred[<span class="st">"sunshine"</span>, sun_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-543"><a href="#cb31-543"></a>  }</span>
<span id="cb31-544"><a href="#cb31-544"></a>  <span class="cf">if</span> (<span class="st">"evaporation"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb31-545"><a href="#cb31-545"></a>    pred[<span class="st">"evaporation"</span>, evap_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-546"><a href="#cb31-546"></a>  }</span>
<span id="cb31-547"><a href="#cb31-547"></a>  <span class="cf">if</span> (<span class="st">"cloud9am"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb31-548"><a href="#cb31-548"></a>    pred[<span class="st">"cloud9am"</span>, cloud_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-549"><a href="#cb31-549"></a>  }</span>
<span id="cb31-550"><a href="#cb31-550"></a>  <span class="cf">if</span> (<span class="st">"cloud3pm"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb31-551"><a href="#cb31-551"></a>    pred[<span class="st">"cloud3pm"</span>, cloud_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-552"><a href="#cb31-552"></a>  }</span>
<span id="cb31-553"><a href="#cb31-553"></a>  <span class="cf">if</span> (<span class="st">"wind_gust_dir"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb31-554"><a href="#cb31-554"></a>    pred[<span class="st">"wind_gust_dir"</span>, wind_gust_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-555"><a href="#cb31-555"></a>  }</span>
<span id="cb31-556"><a href="#cb31-556"></a>  <span class="cf">if</span> (<span class="st">"wind_dir9am"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb31-557"><a href="#cb31-557"></a>    pred[<span class="st">"wind_dir9am"</span>, wind_9am_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-558"><a href="#cb31-558"></a>  }</span>
<span id="cb31-559"><a href="#cb31-559"></a>  <span class="cf">if</span> (<span class="st">"wind_dir3pm"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(pred)) {</span>
<span id="cb31-560"><a href="#cb31-560"></a>    pred[<span class="st">"wind_dir3pm"</span>, wind_3pm_predictors] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-561"><a href="#cb31-561"></a>  }</span>
<span id="cb31-562"><a href="#cb31-562"></a></span>
<span id="cb31-563"><a href="#cb31-563"></a>  ignore_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"_imp_flagged$|^date$"</span>, <span class="fu">colnames</span>(pred), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-564"><a href="#cb31-564"></a>  pred[, ignore_cols] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb31-565"><a href="#cb31-565"></a></span>
<span id="cb31-566"><a href="#cb31-566"></a>  <span class="co"># Parallel imputation with exact m allocation across cores</span></span>
<span id="cb31-567"><a href="#cb31-567"></a>  n_cores <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>L, <span class="fu">min</span>(<span class="fu">as.integer</span>(parallel<span class="sc">::</span><span class="fu">detectCores</span>()), <span class="fu">as.integer</span>(M)))</span>
<span id="cb31-568"><a href="#cb31-568"></a>  m_split <span class="ot">&lt;-</span> <span class="fu">rep</span>(M <span class="sc">%/%</span> n_cores, n_cores)</span>
<span id="cb31-569"><a href="#cb31-569"></a>  <span class="cf">if</span> ((M <span class="sc">%%</span> n_cores) <span class="sc">&gt;</span> <span class="dv">0</span>L) {</span>
<span id="cb31-570"><a href="#cb31-570"></a>    m_split[<span class="fu">seq_len</span>(M <span class="sc">%%</span> n_cores)] <span class="ot">&lt;-</span> m_split[<span class="fu">seq_len</span>(M <span class="sc">%%</span> n_cores)] <span class="sc">+</span> <span class="dv">1</span>L</span>
<span id="cb31-571"><a href="#cb31-571"></a>  }</span>
<span id="cb31-572"><a href="#cb31-572"></a></span>
<span id="cb31-573"><a href="#cb31-573"></a>  seeds <span class="ot">&lt;-</span> <span class="dv">123</span> <span class="sc">+</span> <span class="fu">seq_len</span>(n_cores) <span class="sc">-</span> <span class="dv">1</span>L</span>
<span id="cb31-574"><a href="#cb31-574"></a></span>
<span id="cb31-575"><a href="#cb31-575"></a>  imp_list <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">mclapply</span>(</span>
<span id="cb31-576"><a href="#cb31-576"></a>    <span class="fu">seq_len</span>(n_cores),</span>
<span id="cb31-577"><a href="#cb31-577"></a>    <span class="cf">function</span>(i) {</span>
<span id="cb31-578"><a href="#cb31-578"></a>      <span class="fu">mice</span>(</span>
<span id="cb31-579"><a href="#cb31-579"></a>        df_flagged,</span>
<span id="cb31-580"><a href="#cb31-580"></a>        <span class="at">method =</span> meth,</span>
<span id="cb31-581"><a href="#cb31-581"></a>        <span class="at">predictorMatrix =</span> pred,</span>
<span id="cb31-582"><a href="#cb31-582"></a>        <span class="at">m =</span> m_split[i],</span>
<span id="cb31-583"><a href="#cb31-583"></a>        <span class="at">maxit =</span> <span class="dv">5</span>,</span>
<span id="cb31-584"><a href="#cb31-584"></a>        <span class="at">seed =</span> seeds[i],</span>
<span id="cb31-585"><a href="#cb31-585"></a>        <span class="at">printFlag =</span> <span class="cn">FALSE</span></span>
<span id="cb31-586"><a href="#cb31-586"></a>      )</span>
<span id="cb31-587"><a href="#cb31-587"></a>    },</span>
<span id="cb31-588"><a href="#cb31-588"></a>    <span class="at">mc.cores =</span> n_cores</span>
<span id="cb31-589"><a href="#cb31-589"></a>  )</span>
<span id="cb31-590"><a href="#cb31-590"></a></span>
<span id="cb31-591"><a href="#cb31-591"></a>  <span class="co"># Merge all mids objects into one for MI inference</span></span>
<span id="cb31-592"><a href="#cb31-592"></a>  imp_merged <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(ibind, imp_list)</span>
<span id="cb31-593"><a href="#cb31-593"></a>  <span class="fu">return</span>(imp_merged)</span>
<span id="cb31-594"><a href="#cb31-594"></a>}</span>
<span id="cb31-595"><a href="#cb31-595"></a><span class="in">```</span></span>
<span id="cb31-596"><a href="#cb31-596"></a></span>
<span id="cb31-599"><a href="#cb31-599"></a><span class="in">```{r}</span></span>
<span id="cb31-600"><a href="#cb31-600"></a><span class="co">#| label: clean-and-save-imputed</span></span>
<span id="cb31-601"><a href="#cb31-601"></a><span class="co">#| message: false</span></span>
<span id="cb31-602"><a href="#cb31-602"></a><span class="co">#| warning: false</span></span>
<span id="cb31-603"><a href="#cb31-603"></a><span class="co">#| eval: false</span></span>
<span id="cb31-604"><a href="#cb31-604"></a></span>
<span id="cb31-605"><a href="#cb31-605"></a>imp_mids <span class="ot">&lt;-</span> <span class="fu">clean_and_impute_weather</span>(df)</span>
<span id="cb31-606"><a href="#cb31-606"></a>df_final <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp_mids, <span class="at">action =</span> <span class="dv">1</span>)</span>
<span id="cb31-607"><a href="#cb31-607"></a><span class="fu">write_csv</span>(df_final, <span class="st">"data/df_final.csv"</span>)</span>
<span id="cb31-608"><a href="#cb31-608"></a></span>
<span id="cb31-609"><a href="#cb31-609"></a><span class="in">```</span></span>
<span id="cb31-610"><a href="#cb31-610"></a></span>
<span id="cb31-613"><a href="#cb31-613"></a><span class="in">```{r}</span></span>
<span id="cb31-614"><a href="#cb31-614"></a><span class="co">#| label: load-imputed-data</span></span>
<span id="cb31-615"><a href="#cb31-615"></a><span class="co">#| echo: false</span></span>
<span id="cb31-616"><a href="#cb31-616"></a><span class="co">#| message: false</span></span>
<span id="cb31-617"><a href="#cb31-617"></a><span class="co">#| warning: false</span></span>
<span id="cb31-618"><a href="#cb31-618"></a></span>
<span id="cb31-619"><a href="#cb31-619"></a>df_final <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/df_final.csv"</span>)</span>
<span id="cb31-620"><a href="#cb31-620"></a><span class="in">```</span></span>
<span id="cb31-621"><a href="#cb31-621"></a></span>
<span id="cb31-622"><a href="#cb31-622"></a>---</span>
<span id="cb31-623"><a href="#cb31-623"></a></span>
<span id="cb31-624"><a href="#cb31-624"></a><span class="fu">## Post-Imputation Dataset Properties</span></span>
<span id="cb31-625"><a href="#cb31-625"></a></span>
<span id="cb31-626"><a href="#cb31-626"></a>The two-stage pipeline produces a dataset whose properties are each traceable to a specific finding from the diagnostic analysis in @sec-missingness-diagnostics.</span>
<span id="cb31-627"><a href="#cb31-627"></a></span>
<span id="cb31-628"><a href="#cb31-628"></a>**Retention without fabrication.** No observations are discarded on the basis of partial missingness. The 27.9% of observations with all four target variables simultaneously absent are retained with those variables still missing, consistent with the ghost sensor finding that no empirically supportable imputation is possible for them.</span>
<span id="cb31-629"><a href="#cb31-629"></a></span>
<span id="cb31-630"><a href="#cb31-630"></a>**Temporal coherence.** The interpolated variables maintain their within-location autocorrelation structure. The five-day cap, set in response to the temporal structural break analysis in @sec-temporal-structure, prevents the interpolation from extending across genuine data voids. The use of <span class="in">`rule = 1`</span> in <span class="in">`na.approx`</span> ensures that boundary gaps return <span class="in">`NA`</span> rather than extrapolated values, which would fall outside the physically credible range of the variable and corrupt the donor pool used by PMM in Stage 2.</span>
<span id="cb31-631"><a href="#cb31-631"></a></span>
<span id="cb31-632"><a href="#cb31-632"></a>**Distributional fidelity.** PMM draws imputed values directly from the pool of observed donor observations rather than using a model prediction. This constrains imputed values to the observed empirical range of each variable and preserves the marginal distribution, including multi-modal structure and skew, without requiring distributional assumptions.</span>
<span id="cb31-633"><a href="#cb31-633"></a></span>
<span id="cb31-634"><a href="#cb31-634"></a>**Physical bounds enforcement.** Because PMM can only return values that exist in the observed data, imputed values for all continuous variables are guaranteed to fall within the range of the observed training set. This property eliminated the out-of-range predictions that arose when <span class="in">`rule = 2`</span> extrapolation in Stage 1 produced boundary values below zero for sunshine, which then contaminated the PMM donor matching step.</span>
<span id="cb31-635"><a href="#cb31-635"></a></span>
<span id="cb31-636"><a href="#cb31-636"></a>**Outcome independence.** The weather-conditionality test in @sec-weather-conditionality confirmed that sunshine missingness does not covary with rainfall amounts. Imputed sunshine values therefore do not introduce a directional bias into the training labels for the hurdle or intensity components of the downstream model.</span>
<span id="cb31-637"><a href="#cb31-637"></a></span>
<span id="cb31-638"><a href="#cb31-638"></a>**Wind direction coherence.** Wind direction variables are imputed as unordered categorical factors using Random Forest, with each direction variable conditioned on its temporally matched speed and pressure readings. This preserves the physical coupling between concurrent wind speed and direction measurements while respecting the non-ordinal structure of compass-point categories, which PMM would handle incorrectly.</span>
<span id="cb31-639"><a href="#cb31-639"></a></span>
<span id="cb31-640"><a href="#cb31-640"></a>**Provenance transparency.** Binary imputation flags for the four ghost-prone variables are retained in the final dataset. These flags enable downstream models or diagnostics to condition on or exclude observations where imputed values carry no empirical anchor at the station level, and they are used directly in the sensitivity analysis documented in @sec-sensitivity.</span>
<span id="cb31-641"><a href="#cb31-641"></a></span>
<span id="cb31-642"><a href="#cb31-642"></a></span>
<span id="cb31-643"><a href="#cb31-643"></a><span class="fu">## Imputation Sensitivity Analysis {#sec-sensitivity}</span></span>
<span id="cb31-644"><a href="#cb31-644"></a></span>
<span id="cb31-645"><a href="#cb31-645"></a>::: {.callout-note}</span>
<span id="cb31-646"><a href="#cb31-646"></a>**Chapter Context.** The full <span class="in">`mids`</span> object from the production imputation is retained at runtime, enabling native MICE diagnostics rather than post-hoc approximations. Three analyses operate directly on <span class="in">`imp_mids`</span> to assess convergence stability, distributional fidelity, and between-imputation uncertainty. Each finding is tied back to the design decisions documented in @sec-missingness-diagnostics.</span>
<span id="cb31-647"><a href="#cb31-647"></a>:::</span>
<span id="cb31-648"><a href="#cb31-648"></a></span>
<span id="cb31-649"><a href="#cb31-649"></a><span class="fu">### Setup {#sec-sensitivity-setup}</span></span>
<span id="cb31-650"><a href="#cb31-650"></a></span>
<span id="cb31-653"><a href="#cb31-653"></a><span class="in">```{r}</span></span>
<span id="cb31-654"><a href="#cb31-654"></a><span class="co">#| label: sensitivity-setup</span></span>
<span id="cb31-655"><a href="#cb31-655"></a><span class="co">#| echo: true</span></span>
<span id="cb31-656"><a href="#cb31-656"></a><span class="co">#| message: false</span></span>
<span id="cb31-657"><a href="#cb31-657"></a><span class="co">#| warning: false</span></span>
<span id="cb31-658"><a href="#cb31-658"></a></span>
<span id="cb31-659"><a href="#cb31-659"></a>continuous_ghost_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sunshine"</span>, <span class="st">"evaporation"</span>, <span class="st">"cloud9am"</span>, <span class="st">"cloud3pm"</span>)</span>
<span id="cb31-660"><a href="#cb31-660"></a></span>
<span id="cb31-661"><a href="#cb31-661"></a>flag_map <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-662"><a href="#cb31-662"></a>  <span class="at">sunshine =</span> <span class="st">"sunshine_imp_flagged"</span>,</span>
<span id="cb31-663"><a href="#cb31-663"></a>  <span class="at">evaporation =</span> <span class="st">"evap_imp_flagged"</span>,</span>
<span id="cb31-664"><a href="#cb31-664"></a>  <span class="at">cloud9am =</span> <span class="st">"cloud9am_imp_flagged"</span>,</span>
<span id="cb31-665"><a href="#cb31-665"></a>  <span class="at">cloud3pm =</span> <span class="st">"cloud3pm_imp_flagged"</span></span>
<span id="cb31-666"><a href="#cb31-666"></a>)</span>
<span id="cb31-667"><a href="#cb31-667"></a></span>
<span id="cb31-668"><a href="#cb31-668"></a>imp_mids <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/imp_mids.rds"</span>)</span>
<span id="cb31-669"><a href="#cb31-669"></a>M <span class="ot">&lt;-</span> imp_mids<span class="sc">$</span>m</span>
<span id="cb31-670"><a href="#cb31-670"></a>ITER <span class="ot">&lt;-</span> imp_mids<span class="sc">$</span>iteration</span>
<span id="cb31-671"><a href="#cb31-671"></a><span class="in">```</span></span>
<span id="cb31-672"><a href="#cb31-672"></a></span>
<span id="cb31-673"><a href="#cb31-673"></a>---</span>
<span id="cb31-674"><a href="#cb31-674"></a></span>
<span id="cb31-675"><a href="#cb31-675"></a><span class="fu">### Algorithmic Convergence {#sec-convergence}</span></span>
<span id="cb31-676"><a href="#cb31-676"></a></span>
<span id="cb31-677"><a href="#cb31-677"></a>Multiple imputation by chained equations relies on a Gibbs-style iterative algorithm: each variable is imputed conditional on the current values of all others, and this cycle repeats for a fixed number of iterations. Convergence requires that the chain means and standard deviations stabilise across iterations and that parallel chains starting from different random seeds mix freely without directional drift. Sustained separation between chains or a monotonic trend in the mean across iterations would indicate that the algorithm has not reached a stable solution and that the number of iterations should be increased.</span>
<span id="cb31-678"><a href="#cb31-678"></a></span>
<span id="cb31-681"><a href="#cb31-681"></a><span class="in">```{r}</span></span>
<span id="cb31-682"><a href="#cb31-682"></a><span class="co">#| label: fig-convergence-trace</span></span>
<span id="cb31-683"><a href="#cb31-683"></a><span class="co">#| fig-cap: "MCMC trace plots for the four PMM-imputed variables. Each coloured line is one of the ten parallel chains; the upper panel tracks the chain mean and the lower panel tracks the chain standard deviation across five iterations. Chains that mix without trend indicate a stable imputation solution."</span></span>
<span id="cb31-684"><a href="#cb31-684"></a><span class="co">#| fig-width: 11</span></span>
<span id="cb31-685"><a href="#cb31-685"></a><span class="co">#| fig-height: 9</span></span>
<span id="cb31-686"><a href="#cb31-686"></a><span class="co">#| echo: true</span></span>
<span id="cb31-687"><a href="#cb31-687"></a><span class="co">#| warning: false</span></span>
<span id="cb31-688"><a href="#cb31-688"></a></span>
<span id="cb31-689"><a href="#cb31-689"></a>trace_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sunshine"</span>, <span class="st">"evaporation"</span>, <span class="st">"cloud9am"</span>, <span class="st">"cloud3pm"</span>)</span>
<span id="cb31-690"><a href="#cb31-690"></a></span>
<span id="cb31-691"><a href="#cb31-691"></a>cm <span class="ot">&lt;-</span> imp_mids<span class="sc">$</span>chainMean</span>
<span id="cb31-692"><a href="#cb31-692"></a>cv <span class="ot">&lt;-</span> imp_mids<span class="sc">$</span>chainVar</span>
<span id="cb31-693"><a href="#cb31-693"></a>n_iter <span class="ot">&lt;-</span> <span class="fu">dim</span>(cm)[<span class="dv">2</span>]</span>
<span id="cb31-694"><a href="#cb31-694"></a>n_chain <span class="ot">&lt;-</span> <span class="fu">dim</span>(cm)[<span class="dv">3</span>]</span>
<span id="cb31-695"><a href="#cb31-695"></a></span>
<span id="cb31-696"><a href="#cb31-696"></a>trace_df <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(trace_vars, <span class="cf">function</span>(var) {</span>
<span id="cb31-697"><a href="#cb31-697"></a>  <span class="fu">map_dfr</span>(<span class="fu">seq_len</span>(n_chain), <span class="cf">function</span>(i) {</span>
<span id="cb31-698"><a href="#cb31-698"></a>    mean_v <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cm[var, , i])</span>
<span id="cb31-699"><a href="#cb31-699"></a>    sd_v <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">pmax</span>(<span class="fu">as.numeric</span>(cv[var, , i]), <span class="dv">0</span>))</span>
<span id="cb31-700"><a href="#cb31-700"></a>    <span class="fu">tibble</span>(</span>
<span id="cb31-701"><a href="#cb31-701"></a>      <span class="at">variable =</span> var,</span>
<span id="cb31-702"><a href="#cb31-702"></a>      <span class="at">chain =</span> <span class="fu">factor</span>(i),</span>
<span id="cb31-703"><a href="#cb31-703"></a>      <span class="at">iteration =</span> <span class="fu">seq_len</span>(n_iter),</span>
<span id="cb31-704"><a href="#cb31-704"></a>      <span class="at">mean_val =</span> mean_v,</span>
<span id="cb31-705"><a href="#cb31-705"></a>      <span class="at">sd_val =</span> sd_v</span>
<span id="cb31-706"><a href="#cb31-706"></a>    )</span>
<span id="cb31-707"><a href="#cb31-707"></a>  })</span>
<span id="cb31-708"><a href="#cb31-708"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb31-709"><a href="#cb31-709"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(mean_val))</span>
<span id="cb31-710"><a href="#cb31-710"></a></span>
<span id="cb31-711"><a href="#cb31-711"></a>p_mean <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(trace_df, <span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> mean_val, <span class="at">colour =</span> chain)) <span class="sc">+</span></span>
<span id="cb31-712"><a href="#cb31-712"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb31-713"><a href="#cb31-713"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-714"><a href="#cb31-714"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb31-715"><a href="#cb31-715"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq_len</span>(n_iter)) <span class="sc">+</span></span>
<span id="cb31-716"><a href="#cb31-716"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Chain mean"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">colour =</span> <span class="st">"Chain"</span>) <span class="sc">+</span></span>
<span id="cb31-717"><a href="#cb31-717"></a>  report_theme <span class="sc">+</span></span>
<span id="cb31-718"><a href="#cb31-718"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb31-719"><a href="#cb31-719"></a></span>
<span id="cb31-720"><a href="#cb31-720"></a>p_sd <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(trace_df, <span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> sd_val, <span class="at">colour =</span> chain)) <span class="sc">+</span></span>
<span id="cb31-721"><a href="#cb31-721"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb31-722"><a href="#cb31-722"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-723"><a href="#cb31-723"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb31-724"><a href="#cb31-724"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq_len</span>(n_iter)) <span class="sc">+</span></span>
<span id="cb31-725"><a href="#cb31-725"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Chain SD"</span>, <span class="at">x =</span> <span class="st">"Iteration"</span>, <span class="at">colour =</span> <span class="st">"Chain"</span>) <span class="sc">+</span></span>
<span id="cb31-726"><a href="#cb31-726"></a>  report_theme</span>
<span id="cb31-727"><a href="#cb31-727"></a></span>
<span id="cb31-728"><a href="#cb31-728"></a>(p_mean <span class="sc">/</span> p_sd) <span class="sc">+</span></span>
<span id="cb31-729"><a href="#cb31-729"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb31-730"><a href="#cb31-730"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb31-731"><a href="#cb31-731"></a>    <span class="at">title =</span> <span class="st">"MCMC Convergence Diagnostics"</span>,</span>
<span id="cb31-732"><a href="#cb31-732"></a>    <span class="at">subtitle =</span> <span class="st">"Chain means (top) and standard deviations (bottom) across iterations"</span>,</span>
<span id="cb31-733"><a href="#cb31-733"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb31-734"><a href="#cb31-734"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb31-735"><a href="#cb31-735"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>)</span>
<span id="cb31-736"><a href="#cb31-736"></a>    )</span>
<span id="cb31-737"><a href="#cb31-737"></a>  ) <span class="sc">&amp;</span></span>
<span id="cb31-738"><a href="#cb31-738"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb31-739"><a href="#cb31-739"></a><span class="in">```</span></span>
<span id="cb31-740"><a href="#cb31-740"></a></span>
<span id="cb31-741"><a href="#cb31-741"></a>All four variables exhibit satisfactory convergence. The chains mix freely throughout and show no directional trend in either the mean or the standard deviation, confirming that five iterations were sufficient for the PMM models to reach a stable solution. The <span class="in">`sunshine`</span> chains undergo a sharper adjustment between iterations one and two, consistent with the asymmetric bimodal structure of that variable's observed distribution, but settle into stable mixing immediately afterward. This behaviour is expected: PMM must locate a donor pool within a distribution that has both a low-sunshine cluster and a high-sunshine cluster, and this requires slightly more initial adjustment than the unimodal cloud cover distributions. It is not evidence of non-convergence.</span>
<span id="cb31-742"><a href="#cb31-742"></a></span>
<span id="cb31-743"><a href="#cb31-743"></a>---</span>
<span id="cb31-744"><a href="#cb31-744"></a></span>
<span id="cb31-745"><a href="#cb31-745"></a><span class="fu">### Distributional Fidelity {#sec-dist-fidelity}</span></span>
<span id="cb31-746"><a href="#cb31-746"></a></span>
<span id="cb31-747"><a href="#cb31-747"></a>Convergence of the algorithm is necessary but not sufficient: the imputed values must also reproduce the marginal distribution of each variable as observed at instrumented stations. Distributional fidelity is assessed by comparing the density of observed values, drawn from non-flagged rows in <span class="in">`df_final`</span>, against the density of imputed values drawn from flagged rows. The Kolmogorov-Smirnov statistic $D$ quantifies the maximum absolute distance between the two empirical cumulative distribution functions. Because the sample sizes involved exceed 60,000 observations per variable, all KS p-values are effectively zero by construction and the $D$ statistic alone is the operative measure of practical divergence.</span>
<span id="cb31-748"><a href="#cb31-748"></a></span>
<span id="cb31-751"><a href="#cb31-751"></a><span class="in">```{r}</span></span>
<span id="cb31-752"><a href="#cb31-752"></a><span class="co">#| label: fig-dist-fidelity</span></span>
<span id="cb31-753"><a href="#cb31-753"></a><span class="co">#| fig-cap: "Density of observed versus imputed values for the four PMM-imputed variables. Observed values are drawn from instrumented stations (flag = 0); imputed values are drawn from stations where the instrument was absent (flag = 1). The KS statistic D annotated in each panel quantifies the maximum separation between the two empirical CDFs."</span></span>
<span id="cb31-754"><a href="#cb31-754"></a><span class="co">#| fig-width: 11</span></span>
<span id="cb31-755"><a href="#cb31-755"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb31-756"><a href="#cb31-756"></a><span class="co">#| echo: true</span></span>
<span id="cb31-757"><a href="#cb31-757"></a><span class="co">#| warning: false</span></span>
<span id="cb31-758"><a href="#cb31-758"></a></span>
<span id="cb31-759"><a href="#cb31-759"></a>fidelity_df <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(continuous_ghost_vars, <span class="cf">function</span>(var) {</span>
<span id="cb31-760"><a href="#cb31-760"></a>  flag <span class="ot">&lt;-</span> flag_map[[var]]</span>
<span id="cb31-761"><a href="#cb31-761"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb31-762"><a href="#cb31-762"></a>    df_final <span class="sc">%&gt;%</span></span>
<span id="cb31-763"><a href="#cb31-763"></a>      <span class="fu">filter</span>(.data[[flag]] <span class="sc">==</span> <span class="dv">0</span>, <span class="sc">!</span><span class="fu">is.na</span>(.data[[var]])) <span class="sc">%&gt;%</span></span>
<span id="cb31-764"><a href="#cb31-764"></a>      <span class="fu">transmute</span>(<span class="at">value =</span> .data[[var]], <span class="at">source =</span> <span class="st">"Observed"</span>, <span class="at">variable =</span> var),</span>
<span id="cb31-765"><a href="#cb31-765"></a>    df_final <span class="sc">%&gt;%</span></span>
<span id="cb31-766"><a href="#cb31-766"></a>      <span class="fu">filter</span>(.data[[flag]] <span class="sc">==</span> <span class="dv">1</span>, <span class="sc">!</span><span class="fu">is.na</span>(.data[[var]])) <span class="sc">%&gt;%</span></span>
<span id="cb31-767"><a href="#cb31-767"></a>      <span class="fu">transmute</span>(<span class="at">value =</span> .data[[var]], <span class="at">source =</span> <span class="st">"Imputed"</span>, <span class="at">variable =</span> var)</span>
<span id="cb31-768"><a href="#cb31-768"></a>  )</span>
<span id="cb31-769"><a href="#cb31-769"></a>})</span>
<span id="cb31-770"><a href="#cb31-770"></a></span>
<span id="cb31-771"><a href="#cb31-771"></a>ks_results <span class="ot">&lt;-</span> fidelity_df <span class="sc">%&gt;%</span></span>
<span id="cb31-772"><a href="#cb31-772"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb31-773"><a href="#cb31-773"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-774"><a href="#cb31-774"></a>    <span class="at">ks_stat =</span> <span class="fu">ks.test</span>(</span>
<span id="cb31-775"><a href="#cb31-775"></a>      value[source <span class="sc">==</span> <span class="st">"Observed"</span>],</span>
<span id="cb31-776"><a href="#cb31-776"></a>      value[source <span class="sc">==</span> <span class="st">"Imputed"</span>]</span>
<span id="cb31-777"><a href="#cb31-777"></a>    )<span class="sc">$</span>statistic,</span>
<span id="cb31-778"><a href="#cb31-778"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb31-779"><a href="#cb31-779"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-780"><a href="#cb31-780"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"D = %.3f"</span>, ks_stat))</span>
<span id="cb31-781"><a href="#cb31-781"></a></span>
<span id="cb31-782"><a href="#cb31-782"></a><span class="fu">ggplot</span>(fidelity_df, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> source, <span class="at">colour =</span> source)) <span class="sc">+</span></span>
<span id="cb31-783"><a href="#cb31-783"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb31-784"><a href="#cb31-784"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb31-785"><a href="#cb31-785"></a>    <span class="at">data =</span> ks_results,</span>
<span id="cb31-786"><a href="#cb31-786"></a>    <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>),</span>
<span id="cb31-787"><a href="#cb31-787"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-788"><a href="#cb31-788"></a>    <span class="at">hjust =</span> <span class="fl">1.1</span>,</span>
<span id="cb31-789"><a href="#cb31-789"></a>    <span class="at">vjust =</span> <span class="fl">1.4</span>,</span>
<span id="cb31-790"><a href="#cb31-790"></a>    <span class="at">size =</span> <span class="fl">3.2</span>,</span>
<span id="cb31-791"><a href="#cb31-791"></a>    <span class="at">colour =</span> <span class="st">"grey30"</span></span>
<span id="cb31-792"><a href="#cb31-792"></a>  ) <span class="sc">+</span></span>
<span id="cb31-793"><a href="#cb31-793"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-794"><a href="#cb31-794"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Observed"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>, <span class="st">"Imputed"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>)) <span class="sc">+</span></span>
<span id="cb31-795"><a href="#cb31-795"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb31-796"><a href="#cb31-796"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Observed"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>, <span class="st">"Imputed"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>)</span>
<span id="cb31-797"><a href="#cb31-797"></a>  ) <span class="sc">+</span></span>
<span id="cb31-798"><a href="#cb31-798"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-799"><a href="#cb31-799"></a>    <span class="at">title =</span> <span class="st">"Distributional Fidelity: Observed vs. Imputed Values"</span>,</span>
<span id="cb31-800"><a href="#cb31-800"></a>    <span class="at">subtitle =</span> <span class="st">"KS statistic D annotated per panel. P-values are not reported as they are uninformative at this sample size."</span>,</span>
<span id="cb31-801"><a href="#cb31-801"></a>    <span class="at">x =</span> <span class="st">"Value"</span>,</span>
<span id="cb31-802"><a href="#cb31-802"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb31-803"><a href="#cb31-803"></a>    <span class="at">fill =</span> <span class="st">"Source"</span>,</span>
<span id="cb31-804"><a href="#cb31-804"></a>    <span class="at">colour =</span> <span class="st">"Source"</span>,</span>
<span id="cb31-805"><a href="#cb31-805"></a>    <span class="at">caption =</span> <span class="st">"Observed = instrumented stations (flag = 0). Imputed = ghost sensor stations (flag = 1)."</span></span>
<span id="cb31-806"><a href="#cb31-806"></a>  ) <span class="sc">+</span></span>
<span id="cb31-807"><a href="#cb31-807"></a>  report_theme <span class="sc">+</span></span>
<span id="cb31-808"><a href="#cb31-808"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb31-809"><a href="#cb31-809"></a><span class="in">```</span></span>
<span id="cb31-810"><a href="#cb31-810"></a></span>
<span id="cb31-813"><a href="#cb31-813"></a><span class="in">```{r}</span></span>
<span id="cb31-814"><a href="#cb31-814"></a><span class="co">#| label: tbl-ks-results</span></span>
<span id="cb31-815"><a href="#cb31-815"></a><span class="co">#| tbl-cap: "Kolmogorov-Smirnov statistics comparing observed and imputed marginal distributions. Interpretation is based on the magnitude of D rather than the p-value, which is uninformative at sample sizes exceeding 60,000 observations per variable."</span></span>
<span id="cb31-816"><a href="#cb31-816"></a><span class="co">#| echo: true</span></span>
<span id="cb31-817"><a href="#cb31-817"></a><span class="co">#| warning: false</span></span>
<span id="cb31-818"><a href="#cb31-818"></a></span>
<span id="cb31-819"><a href="#cb31-819"></a>ks_results <span class="sc">%&gt;%</span></span>
<span id="cb31-820"><a href="#cb31-820"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-821"><a href="#cb31-821"></a>    <span class="at">interpretation =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-822"><a href="#cb31-822"></a>      ks_stat <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Negligible shift; distributions effectively identical"</span>,</span>
<span id="cb31-823"><a href="#cb31-823"></a>      ks_stat <span class="sc">&lt;</span> <span class="fl">0.10</span> <span class="sc">~</span> <span class="st">"Small shift; acceptable fidelity"</span>,</span>
<span id="cb31-824"><a href="#cb31-824"></a>      ks_stat <span class="sc">&lt;</span> <span class="fl">0.20</span> <span class="sc">~</span> <span class="st">"Moderate shift; review predictor set"</span>,</span>
<span id="cb31-825"><a href="#cb31-825"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Large shift; imputation has drifted from observed"</span></span>
<span id="cb31-826"><a href="#cb31-826"></a>    )</span>
<span id="cb31-827"><a href="#cb31-827"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-828"><a href="#cb31-828"></a>  <span class="fu">select</span>(variable, ks_stat, interpretation) <span class="sc">%&gt;%</span></span>
<span id="cb31-829"><a href="#cb31-829"></a>  <span class="fu">kable</span>(</span>
<span id="cb31-830"><a href="#cb31-830"></a>    <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb31-831"><a href="#cb31-831"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"KS Statistic (D)"</span>, <span class="st">"Interpretation"</span>),</span>
<span id="cb31-832"><a href="#cb31-832"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span></span>
<span id="cb31-833"><a href="#cb31-833"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-834"><a href="#cb31-834"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb31-835"><a href="#cb31-835"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb31-836"><a href="#cb31-836"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-837"><a href="#cb31-837"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>)</span>
<span id="cb31-838"><a href="#cb31-838"></a>  )</span>
<span id="cb31-839"><a href="#cb31-839"></a><span class="in">```</span></span>
<span id="cb31-840"><a href="#cb31-840"></a></span>
<span id="cb31-841"><a href="#cb31-841"></a>The cloud cover variables achieve near-perfect fidelity. The statistic for <span class="in">`cloud3pm`</span> ($D = 0.019$) is negligible, and <span class="in">`cloud9am`</span> ($D = 0.051$) remains well within the small-shift range. Both multi-modal peaks in the cloud cover distributions are reproduced accurately by the imputed draws. <span class="in">`evaporation`</span> and <span class="in">`sunshine`</span> show small shifts ($D = 0.065$ and $D = 0.074$ respectively). These are attributable in part to the ghost sensor stations identified in @sec-ghost-sensor: those stations have climatological profiles that differ systematically from the instrumented set, and PMM donor matching correctly reflects those differences rather than suppressing them. All imputed values respect the physical bounds of each variable, a consequence of switching <span class="in">`na.approx`</span> from <span class="in">`rule = 2`</span> to <span class="in">`rule = 1`</span> in Stage 1, which eliminated the out-of-range boundary extrapolations that would otherwise contaminate the PMM donor pool.</span>
<span id="cb31-842"><a href="#cb31-842"></a></span>
<span id="cb31-843"><a href="#cb31-843"></a>---</span>
<span id="cb31-844"><a href="#cb31-844"></a></span>
<span id="cb31-845"><a href="#cb31-845"></a><span class="fu">### Between-Imputation Variance {#sec-between-variance}</span></span>
<span id="cb31-846"><a href="#cb31-846"></a></span>
<span id="cb31-847"><a href="#cb31-847"></a>The justification for retaining $m = 10$ completed datasets rather than a single imputation rests on the magnitude of the between-imputation variance. If the ten completions agree closely across observations, a single-completion analysis would be adequate. If they diverge substantially, pooling is required to obtain valid standard errors. The ribbon plots below display the range of imputed values across all ten completions for each observation, sorted by the cross-completion mean, so that the width of the ribbon directly represents the seed-to-seed uncertainty at each quantile of the imputed distribution.</span>
<span id="cb31-848"><a href="#cb31-848"></a></span>
<span id="cb31-851"><a href="#cb31-851"></a><span class="in">```{r}</span></span>
<span id="cb31-852"><a href="#cb31-852"></a><span class="co">#| label: fig-between-imputation-variance</span></span>
<span id="cb31-853"><a href="#cb31-853"></a><span class="co">#| fig-cap: "Between-imputation variance across the ten PMM completions. Each observation is ranked by its mean imputed value across all completions; the ribbon spans the minimum to maximum imputed value for that observation. Narrow ribbons indicate stable imputation; wide ribbons indicate that downstream point estimates are sensitive to the choice of completion."</span></span>
<span id="cb31-854"><a href="#cb31-854"></a><span class="co">#| fig-width: 11</span></span>
<span id="cb31-855"><a href="#cb31-855"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb31-856"><a href="#cb31-856"></a><span class="co">#| echo: true</span></span>
<span id="cb31-857"><a href="#cb31-857"></a><span class="co">#| warning: false</span></span>
<span id="cb31-858"><a href="#cb31-858"></a></span>
<span id="cb31-859"><a href="#cb31-859"></a>all_completions <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">seq_len</span>(M), <span class="cf">function</span>(m) {</span>
<span id="cb31-860"><a href="#cb31-860"></a>  <span class="fu">complete</span>(imp_mids, <span class="at">action =</span> m) <span class="sc">%&gt;%</span></span>
<span id="cb31-861"><a href="#cb31-861"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(trace_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb31-862"><a href="#cb31-862"></a>    <span class="fu">mutate</span>(<span class="at">imputation =</span> <span class="fu">factor</span>(m), <span class="at">row_id =</span> <span class="fu">row_number</span>())</span>
<span id="cb31-863"><a href="#cb31-863"></a>})</span>
<span id="cb31-864"><a href="#cb31-864"></a></span>
<span id="cb31-865"><a href="#cb31-865"></a>ribbon_df <span class="ot">&lt;-</span> all_completions <span class="sc">%&gt;%</span></span>
<span id="cb31-866"><a href="#cb31-866"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb31-867"><a href="#cb31-867"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(trace_vars),</span>
<span id="cb31-868"><a href="#cb31-868"></a>    <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb31-869"><a href="#cb31-869"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb31-870"><a href="#cb31-870"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-871"><a href="#cb31-871"></a>  <span class="fu">group_by</span>(variable, row_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-872"><a href="#cb31-872"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-873"><a href="#cb31-873"></a>    <span class="at">mean_val =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-874"><a href="#cb31-874"></a>    <span class="at">min_val =</span> <span class="fu">min</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-875"><a href="#cb31-875"></a>    <span class="at">max_val =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-876"><a href="#cb31-876"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb31-877"><a href="#cb31-877"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-878"><a href="#cb31-878"></a>  <span class="fu">arrange</span>(variable, mean_val) <span class="sc">%&gt;%</span></span>
<span id="cb31-879"><a href="#cb31-879"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb31-880"><a href="#cb31-880"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb31-881"><a href="#cb31-881"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb31-882"><a href="#cb31-882"></a></span>
<span id="cb31-883"><a href="#cb31-883"></a><span class="fu">ggplot</span>(ribbon_df, <span class="fu">aes</span>(<span class="at">x =</span> rank)) <span class="sc">+</span></span>
<span id="cb31-884"><a href="#cb31-884"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb31-885"><a href="#cb31-885"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> min_val, <span class="at">ymax =</span> max_val),</span>
<span id="cb31-886"><a href="#cb31-886"></a>    <span class="at">fill =</span> <span class="st">"#2C7BB6"</span>,</span>
<span id="cb31-887"><a href="#cb31-887"></a>    <span class="at">alpha =</span> <span class="fl">0.25</span></span>
<span id="cb31-888"><a href="#cb31-888"></a>  ) <span class="sc">+</span></span>
<span id="cb31-889"><a href="#cb31-889"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_val), <span class="at">colour =</span> <span class="st">"#2C7BB6"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-890"><a href="#cb31-890"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-891"><a href="#cb31-891"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-892"><a href="#cb31-892"></a>    <span class="at">title =</span> <span class="st">"Between-Imputation Variance Across Ten Completions"</span>,</span>
<span id="cb31-893"><a href="#cb31-893"></a>    <span class="at">subtitle =</span> <span class="st">"Ribbon spans the full range of imputed values;</span></span>
<span id="cb31-894"><a href="#cb31-894"></a><span class="st">                line is the cross-completion mean."</span>,</span>
<span id="cb31-895"><a href="#cb31-895"></a>    <span class="at">x =</span> <span class="st">"Observation rank (ascending mean)"</span>,</span>
<span id="cb31-896"><a href="#cb31-896"></a>    <span class="at">y =</span> <span class="st">"Imputed value"</span>,</span>
<span id="cb31-897"><a href="#cb31-897"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb31-898"><a href="#cb31-898"></a>      <span class="st">"m = "</span>,</span>
<span id="cb31-899"><a href="#cb31-899"></a>      M,</span>
<span id="cb31-900"><a href="#cb31-900"></a>      <span class="st">" completions. Observations sorted independently within each panel."</span></span>
<span id="cb31-901"><a href="#cb31-901"></a>    )</span>
<span id="cb31-902"><a href="#cb31-902"></a>  ) <span class="sc">+</span></span>
<span id="cb31-903"><a href="#cb31-903"></a>  report_theme</span>
<span id="cb31-904"><a href="#cb31-904"></a><span class="in">```</span></span>
<span id="cb31-905"><a href="#cb31-905"></a></span>
<span id="cb31-908"><a href="#cb31-908"></a><span class="in">```{r}</span></span>
<span id="cb31-909"><a href="#cb31-909"></a><span class="co">#| label: tbl-between-variance</span></span>
<span id="cb31-910"><a href="#cb31-910"></a><span class="co">#| tbl-cap: "Between-imputation variance summary across ten PMM completions. Mean Range is the average difference between the maximum and minimum imputed value across the ten datasets for a given observation. CV of Range is the coefficient of variation of that range across all observations."</span></span>
<span id="cb31-911"><a href="#cb31-911"></a><span class="co">#| echo: true</span></span>
<span id="cb31-912"><a href="#cb31-912"></a><span class="co">#| warning: false</span></span>
<span id="cb31-913"><a href="#cb31-913"></a></span>
<span id="cb31-914"><a href="#cb31-914"></a>between_var_summary <span class="ot">&lt;-</span> all_completions <span class="sc">%&gt;%</span></span>
<span id="cb31-915"><a href="#cb31-915"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb31-916"><a href="#cb31-916"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(trace_vars),</span>
<span id="cb31-917"><a href="#cb31-917"></a>    <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb31-918"><a href="#cb31-918"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb31-919"><a href="#cb31-919"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-920"><a href="#cb31-920"></a>  <span class="fu">group_by</span>(variable, row_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-921"><a href="#cb31-921"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-922"><a href="#cb31-922"></a>    <span class="at">range_val =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-923"><a href="#cb31-923"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb31-924"><a href="#cb31-924"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-925"><a href="#cb31-925"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb31-926"><a href="#cb31-926"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-927"><a href="#cb31-927"></a>    <span class="at">mean_range =</span> <span class="fu">mean</span>(range_val, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-928"><a href="#cb31-928"></a>    <span class="at">median_range =</span> <span class="fu">median</span>(range_val, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-929"><a href="#cb31-929"></a>    <span class="at">cv_range =</span> <span class="fu">sd</span>(range_val, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">mean</span>(range_val, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-930"><a href="#cb31-930"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb31-931"><a href="#cb31-931"></a>  )</span>
<span id="cb31-932"><a href="#cb31-932"></a></span>
<span id="cb31-933"><a href="#cb31-933"></a>between_var_summary <span class="sc">%&gt;%</span></span>
<span id="cb31-934"><a href="#cb31-934"></a>  <span class="fu">kable</span>(</span>
<span id="cb31-935"><a href="#cb31-935"></a>    <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb31-936"><a href="#cb31-936"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"Mean Range"</span>, <span class="st">"Median Range"</span>, <span class="st">"CV of Range"</span>),</span>
<span id="cb31-937"><a href="#cb31-937"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span></span>
<span id="cb31-938"><a href="#cb31-938"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-939"><a href="#cb31-939"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb31-940"><a href="#cb31-940"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb31-941"><a href="#cb31-941"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-942"><a href="#cb31-942"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>)</span>
<span id="cb31-943"><a href="#cb31-943"></a>  )</span>
<span id="cb31-944"><a href="#cb31-944"></a><span class="in">```</span></span>
<span id="cb31-945"><a href="#cb31-945"></a></span>
<span id="cb31-946"><a href="#cb31-946"></a>The between-imputation variance is material for all four variables, though its structure differs meaningfully across them.</span>
<span id="cb31-947"><a href="#cb31-947"></a></span>
<span id="cb31-948"><a href="#cb31-948"></a>The cloud cover variables show the widest absolute ranges, consistent with their discrete integer scale (0 to 8 oktas). The ribbon plots reveal a characteristic stepped pattern in the mean line, a direct consequence of donor values being drawn from a finite set of integer okta levels rather than a continuous distribution. A notable feature of the cloud cover ribbons is that for a substantial proportion of observations the ribbon collapses to zero width, meaning all ten completions agreed on the same donor value. This stability coexists with periodic spikes in ribbon width at specific observation ranks, most plausibly corresponding to cases where predictor coverage was sparse and the PMM donor pool was ambiguous between adjacent okta levels. The median range of zero for both cloud variables confirms that this agreement is the typical rather than the exceptional case.</span>
<span id="cb31-949"><a href="#cb31-949"></a></span>
<span id="cb31-950"><a href="#cb31-950"></a><span class="in">`sunshine`</span> and <span class="in">`evaporation`</span> exhibit a different structure. Their mean ranges (3.470 and 2.318 respectively) are smaller in absolute terms than the cloud cover ranges but their CV of Range values are considerably higher (1.483 and 1.721). This dissociation between the mean and the coefficient of variation indicates that imputation uncertainty is not spread uniformly across the distribution: the ribbons are narrow across the bulk of observations but widen substantially in the right tail, where high-sunshine and high-evaporation events are rarer and the PMM donor pool is consequently thinner. For any given high-evaporation day, the spread between the most and least optimistic imputed values across the ten completions is disproportionately large relative to the average. This right-tail concentration of uncertainty is precisely the regime where downstream model coefficients are most sensitive to the choice of completion, making pooled inference particularly important for these two variables.</span>
<span id="cb31-951"><a href="#cb31-951"></a></span>
<span id="cb31-952"><a href="#cb31-952"></a>Taken together, the non-zero mean ranges and the elevated CV values for <span class="in">`sunshine`</span> and <span class="in">`evaporation`</span> confirm that the data does not satisfy MCAR in the regions where uncertainty is highest. Using a single completed dataset would treat the seed-to-seed variability visible in the ribbon plots as if it did not exist, producing standard errors that are artificially narrow. This provides direct empirical justification for the Rubin's Rules pooling strategy formalised in the following section.</span>
<span id="cb31-953"><a href="#cb31-953"></a></span>
<span id="cb31-954"><a href="#cb31-954"></a>---</span>
<span id="cb31-955"><a href="#cb31-955"></a></span>
<span id="cb31-956"><a href="#cb31-956"></a><span class="fu">### Rubin's Rules Variance Decomposition {#sec-rubins-rules}</span></span>
<span id="cb31-957"><a href="#cb31-957"></a></span>
<span id="cb31-958"><a href="#cb31-958"></a>The Rubin variance decomposition provides a formal quantification of how much of the total estimator uncertainty is attributable to missingness rather than to ordinary sampling variation. For each variable, a linear model is fitted to each of the $m = 10$ completed datasets using a physically motivated predictor set that mirrors the production imputation matrix. The within-imputation variance $W$ is the average sampling variance across the ten fits; the between-imputation variance $B$ captures the dispersion of coefficient estimates across the ten datasets. Total variance $T = W + (1 + 1/m)B$ and the Fraction of Missing Information $\text{FMI} = (B + B/m) / T$ follow directly from Rubin (1987). Ghost sensor observations are excluded from these fits because their zero within-location variance causes numerical instability in the linear model; only anchored observations with empirical support are used.</span>
<span id="cb31-959"><a href="#cb31-959"></a></span>
<span id="cb31-962"><a href="#cb31-962"></a><span class="in">```{r}</span></span>
<span id="cb31-963"><a href="#cb31-963"></a><span class="co">#| label: tbl-rubins-rules</span></span>
<span id="cb31-964"><a href="#cb31-964"></a><span class="co">#| tbl-cap: "Rubin's Rules variance decomposition for the four PMM-imputed variables. W is the within-imputation variance, B the between-imputation variance, T the total variance, and FMI the Fraction of Missing Information. Analyses restricted to anchored (non-ghost) observations."</span></span>
<span id="cb31-965"><a href="#cb31-965"></a><span class="co">#| echo: true</span></span>
<span id="cb31-966"><a href="#cb31-966"></a><span class="co">#| warning: false</span></span>
<span id="cb31-967"><a href="#cb31-967"></a><span class="co">#| message: false</span></span>
<span id="cb31-968"><a href="#cb31-968"></a></span>
<span id="cb31-969"><a href="#cb31-969"></a>flag_map_rubin <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-970"><a href="#cb31-970"></a>  <span class="at">sunshine =</span> <span class="st">"sunshine_imp_flagged"</span>,</span>
<span id="cb31-971"><a href="#cb31-971"></a>  <span class="at">evaporation =</span> <span class="st">"evap_imp_flagged"</span>,</span>
<span id="cb31-972"><a href="#cb31-972"></a>  <span class="at">cloud9am =</span> <span class="st">"cloud9am_imp_flagged"</span>,</span>
<span id="cb31-973"><a href="#cb31-973"></a>  <span class="at">cloud3pm =</span> <span class="st">"cloud3pm_imp_flagged"</span></span>
<span id="cb31-974"><a href="#cb31-974"></a>)</span>
<span id="cb31-975"><a href="#cb31-975"></a></span>
<span id="cb31-976"><a href="#cb31-976"></a>rubin_predictor_map <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb31-977"><a href="#cb31-977"></a>  <span class="at">sunshine =</span> <span class="fu">c</span>(<span class="st">"cloud9am"</span>, <span class="st">"cloud3pm"</span>, <span class="st">"max_temp"</span>, <span class="st">"humidity3pm"</span>),</span>
<span id="cb31-978"><a href="#cb31-978"></a>  <span class="at">evaporation =</span> <span class="fu">c</span>(<span class="st">"wind_gust_speed"</span>, <span class="st">"max_temp"</span>, <span class="st">"humidity3pm"</span>),</span>
<span id="cb31-979"><a href="#cb31-979"></a>  <span class="at">cloud9am =</span> <span class="fu">c</span>(<span class="st">"humidity9am"</span>, <span class="st">"pressure9am"</span>, <span class="st">"humidity3pm"</span>),</span>
<span id="cb31-980"><a href="#cb31-980"></a>  <span class="at">cloud3pm =</span> <span class="fu">c</span>(<span class="st">"humidity3pm"</span>, <span class="st">"pressure3pm"</span>, <span class="st">"humidity9am"</span>)</span>
<span id="cb31-981"><a href="#cb31-981"></a>)</span>
<span id="cb31-982"><a href="#cb31-982"></a></span>
<span id="cb31-983"><a href="#cb31-983"></a>rubin_results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(continuous_ghost_vars, <span class="cf">function</span>(outcome) {</span>
<span id="cb31-984"><a href="#cb31-984"></a>  flag_col <span class="ot">&lt;-</span> flag_map_rubin[[outcome]]</span>
<span id="cb31-985"><a href="#cb31-985"></a>  preds <span class="ot">&lt;-</span> rubin_predictor_map[[outcome]]</span>
<span id="cb31-986"><a href="#cb31-986"></a>  available <span class="ot">&lt;-</span> <span class="fu">intersect</span>(preds, <span class="fu">names</span>(imp_mids<span class="sc">$</span>data))</span>
<span id="cb31-987"><a href="#cb31-987"></a></span>
<span id="cb31-988"><a href="#cb31-988"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb31-989"><a href="#cb31-989"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb31-990"><a href="#cb31-990"></a>  }</span>
<span id="cb31-991"><a href="#cb31-991"></a></span>
<span id="cb31-992"><a href="#cb31-992"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(outcome, <span class="st">"~"</span>, <span class="fu">paste</span>(available, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb31-993"><a href="#cb31-993"></a></span>
<span id="cb31-994"><a href="#cb31-994"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb31-995"><a href="#cb31-995"></a>    {</span>
<span id="cb31-996"><a href="#cb31-996"></a>      fits <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(imp_mids<span class="sc">$</span>m), <span class="cf">function</span>(m) {</span>
<span id="cb31-997"><a href="#cb31-997"></a>        df_m <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp_mids, <span class="at">action =</span> m) <span class="sc">%&gt;%</span></span>
<span id="cb31-998"><a href="#cb31-998"></a>          <span class="fu">filter</span>(.data[[flag_col]] <span class="sc">==</span> <span class="dv">0</span>L)</span>
<span id="cb31-999"><a href="#cb31-999"></a>        <span class="fu">lm</span>(fml, <span class="at">data =</span> df_m)</span>
<span id="cb31-1000"><a href="#cb31-1000"></a>      })</span>
<span id="cb31-1001"><a href="#cb31-1001"></a>      pooled <span class="ot">&lt;-</span> <span class="fu">pool</span>(<span class="fu">as.mira</span>(fits))</span>
<span id="cb31-1002"><a href="#cb31-1002"></a>      pr <span class="ot">&lt;-</span> pooled<span class="sc">$</span>pooled <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span>)</span>
<span id="cb31-1003"><a href="#cb31-1003"></a></span>
<span id="cb31-1004"><a href="#cb31-1004"></a>      <span class="fu">tibble</span>(</span>
<span id="cb31-1005"><a href="#cb31-1005"></a>        <span class="at">variable =</span> outcome,</span>
<span id="cb31-1006"><a href="#cb31-1006"></a>        <span class="at">W =</span> pr<span class="sc">$</span>ubar,</span>
<span id="cb31-1007"><a href="#cb31-1007"></a>        <span class="at">B =</span> pr<span class="sc">$</span>b,</span>
<span id="cb31-1008"><a href="#cb31-1008"></a>        <span class="at">T_total =</span> pr<span class="sc">$</span>t,</span>
<span id="cb31-1009"><a href="#cb31-1009"></a>        <span class="at">FMI =</span> pr<span class="sc">$</span>fmi</span>
<span id="cb31-1010"><a href="#cb31-1010"></a>      )</span>
<span id="cb31-1011"><a href="#cb31-1011"></a>    },</span>
<span id="cb31-1012"><a href="#cb31-1012"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb31-1013"><a href="#cb31-1013"></a>      <span class="fu">message</span>(</span>
<span id="cb31-1014"><a href="#cb31-1014"></a>        <span class="st">"Rubin decomposition failed for "</span>,</span>
<span id="cb31-1015"><a href="#cb31-1015"></a>        outcome,</span>
<span id="cb31-1016"><a href="#cb31-1016"></a>        <span class="st">": "</span>,</span>
<span id="cb31-1017"><a href="#cb31-1017"></a>        <span class="fu">conditionMessage</span>(e)</span>
<span id="cb31-1018"><a href="#cb31-1018"></a>      )</span>
<span id="cb31-1019"><a href="#cb31-1019"></a>      <span class="cn">NULL</span></span>
<span id="cb31-1020"><a href="#cb31-1020"></a>    }</span>
<span id="cb31-1021"><a href="#cb31-1021"></a>  )</span>
<span id="cb31-1022"><a href="#cb31-1022"></a>})</span>
<span id="cb31-1023"><a href="#cb31-1023"></a></span>
<span id="cb31-1024"><a href="#cb31-1024"></a><span class="fu">stopifnot</span>(</span>
<span id="cb31-1025"><a href="#cb31-1025"></a>  <span class="st">"All Rubin decompositions failed; check imp_mids structure"</span> <span class="ot">=</span> <span class="fu">nrow</span>(</span>
<span id="cb31-1026"><a href="#cb31-1026"></a>    rubin_results</span>
<span id="cb31-1027"><a href="#cb31-1027"></a>  ) <span class="sc">&gt;</span></span>
<span id="cb31-1028"><a href="#cb31-1028"></a>    <span class="dv">0</span></span>
<span id="cb31-1029"><a href="#cb31-1029"></a>)</span>
<span id="cb31-1030"><a href="#cb31-1030"></a></span>
<span id="cb31-1031"><a href="#cb31-1031"></a>rubin_results <span class="sc">%&gt;%</span></span>
<span id="cb31-1032"><a href="#cb31-1032"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-1033"><a href="#cb31-1033"></a>    <span class="at">pct_between =</span> B <span class="sc">/</span> T_total <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb31-1034"><a href="#cb31-1034"></a>    <span class="at">fmi_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-1035"><a href="#cb31-1035"></a>      FMI <span class="sc">&lt;</span> <span class="fl">0.10</span> <span class="sc">~</span> <span class="st">"Low; single completion adequate"</span>,</span>
<span id="cb31-1036"><a href="#cb31-1036"></a>      FMI <span class="sc">&lt;</span> <span class="fl">0.30</span> <span class="sc">~</span> <span class="st">"Moderate; pooling recommended"</span>,</span>
<span id="cb31-1037"><a href="#cb31-1037"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"High; pooling required"</span></span>
<span id="cb31-1038"><a href="#cb31-1038"></a>    )</span>
<span id="cb31-1039"><a href="#cb31-1039"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-1040"><a href="#cb31-1040"></a>  <span class="fu">kable</span>(</span>
<span id="cb31-1041"><a href="#cb31-1041"></a>    <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb31-1042"><a href="#cb31-1042"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb31-1043"><a href="#cb31-1043"></a>      <span class="st">"Variable"</span>,</span>
<span id="cb31-1044"><a href="#cb31-1044"></a>      <span class="st">"Within (W)"</span>,</span>
<span id="cb31-1045"><a href="#cb31-1045"></a>      <span class="st">"Between (B)"</span>,</span>
<span id="cb31-1046"><a href="#cb31-1046"></a>      <span class="st">"Total (T)"</span>,</span>
<span id="cb31-1047"><a href="#cb31-1047"></a>      <span class="st">"FMI"</span>,</span>
<span id="cb31-1048"><a href="#cb31-1048"></a>      <span class="st">"Between (%)"</span>,</span>
<span id="cb31-1049"><a href="#cb31-1049"></a>      <span class="st">"FMI Classification"</span></span>
<span id="cb31-1050"><a href="#cb31-1050"></a>    ),</span>
<span id="cb31-1051"><a href="#cb31-1051"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span></span>
<span id="cb31-1052"><a href="#cb31-1052"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-1053"><a href="#cb31-1053"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb31-1054"><a href="#cb31-1054"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb31-1055"><a href="#cb31-1055"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-1056"><a href="#cb31-1056"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>)</span>
<span id="cb31-1057"><a href="#cb31-1057"></a>  )</span>
<span id="cb31-1058"><a href="#cb31-1058"></a><span class="in">```</span></span>
<span id="cb31-1059"><a href="#cb31-1059"></a></span>
<span id="cb31-1060"><a href="#cb31-1060"></a>All four FMI values exceed 0.30, the threshold above which Rubin (1987) recommends against single-completion inference. For <span class="in">`cloud9am`</span> the between-imputation variance $B$ exceeds the within-imputation variance $W$, meaning that uncertainty from the missing data mechanism is the dominant source of variability in the intercept estimate rather than sampling noise. <span class="in">`sunshine`</span> and <span class="in">`evaporation`</span> show FMI values in the 0.47 to 0.55 range, implying that roughly half of the total variance in downstream estimates involving these variables is attributable to missingness if only a single completed dataset is used. These FMI magnitudes are consistent with the right-tail volatility identified in @sec-between-variance: the observations where imputation uncertainty is highest are also the observations that exercise the tails of the coefficient distributions most strongly. The consequence for subsequent modelling is direct: all zero-inflated gamma model estimates that incorporate <span class="in">`sunshine`</span>, <span class="in">`evaporation`</span>, <span class="in">`cloud9am`</span>, or <span class="in">`cloud3pm`</span> as predictors must be fitted across all $m = 10$ completions and pooled using Rubin's combining rules before inference is drawn.</span>
<span id="cb31-1061"><a href="#cb31-1061"></a></span>
<span id="cb31-1062"><a href="#cb31-1062"></a>---</span>
<span id="cb31-1063"><a href="#cb31-1063"></a></span>
<span id="cb31-1064"><a href="#cb31-1064"></a><span class="fu">### Diagnostic Summary {#sec-sensitivity-summary}</span></span>
<span id="cb31-1065"><a href="#cb31-1065"></a></span>
<span id="cb31-1068"><a href="#cb31-1068"></a><span class="in">```{r}</span></span>
<span id="cb31-1069"><a href="#cb31-1069"></a><span class="co">#| label: tbl-sensitivity-summary</span></span>
<span id="cb31-1070"><a href="#cb31-1070"></a><span class="co">#| tbl-cap: "Summary of imputation sensitivity diagnostics. Each row corresponds to one diagnostic procedure; the action column specifies the corrective step that would be warranted if the criterion were not met."</span></span>
<span id="cb31-1071"><a href="#cb31-1071"></a><span class="co">#| echo: true</span></span>
<span id="cb31-1072"><a href="#cb31-1072"></a><span class="co">#| warning: false</span></span>
<span id="cb31-1073"><a href="#cb31-1073"></a></span>
<span id="cb31-1074"><a href="#cb31-1074"></a><span class="fu">tibble</span>(</span>
<span id="cb31-1075"><a href="#cb31-1075"></a>  <span class="at">diagnostic =</span> <span class="fu">c</span>(</span>
<span id="cb31-1076"><a href="#cb31-1076"></a>    <span class="st">"MCMC convergence (trace plots)"</span>,</span>
<span id="cb31-1077"><a href="#cb31-1077"></a>    <span class="st">"Distributional fidelity (KS test)"</span>,</span>
<span id="cb31-1078"><a href="#cb31-1078"></a>    <span class="st">"Between-imputation variance (ribbon plots)"</span>,</span>
<span id="cb31-1079"><a href="#cb31-1079"></a>    <span class="st">"Rubin FMI decomposition"</span></span>
<span id="cb31-1080"><a href="#cb31-1080"></a>  ),</span>
<span id="cb31-1081"><a href="#cb31-1081"></a>  <span class="at">criterion =</span> <span class="fu">c</span>(</span>
<span id="cb31-1082"><a href="#cb31-1082"></a>    <span class="st">"Chains mix without directional trend across iterations"</span>,</span>
<span id="cb31-1083"><a href="#cb31-1083"></a>    <span class="st">"KS statistic D below 0.10 for all variables"</span>,</span>
<span id="cb31-1084"><a href="#cb31-1084"></a>    <span class="st">"Ribbon width consistent with acceptable seed-to-seed variation"</span>,</span>
<span id="cb31-1085"><a href="#cb31-1085"></a>    <span class="st">"FMI below 0.30 for variables used in downstream inference"</span></span>
<span id="cb31-1086"><a href="#cb31-1086"></a>  ),</span>
<span id="cb31-1087"><a href="#cb31-1087"></a>  <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb31-1088"><a href="#cb31-1088"></a>    <span class="st">"Met; all chains converge within five iterations"</span>,</span>
<span id="cb31-1089"><a href="#cb31-1089"></a>    <span class="st">"Met for cloud cover;</span></span>
<span id="cb31-1090"><a href="#cb31-1090"></a><span class="st">     small shift for sunshine and evaporation within tolerance"</span>,</span>
<span id="cb31-1091"><a href="#cb31-1091"></a>    <span class="st">"Material variance present;</span></span>
<span id="cb31-1092"><a href="#cb31-1092"></a><span class="st">     uncertainty concentrated in right tail for sunshine and evaporation"</span>,</span>
<span id="cb31-1093"><a href="#cb31-1093"></a>    <span class="st">"Not met; FMI ranges from 0.33 to 0.57 across all four variables"</span></span>
<span id="cb31-1094"><a href="#cb31-1094"></a>  ),</span>
<span id="cb31-1095"><a href="#cb31-1095"></a>  <span class="at">action =</span> <span class="fu">c</span>(</span>
<span id="cb31-1096"><a href="#cb31-1096"></a>    <span class="st">"No action required"</span>,</span>
<span id="cb31-1097"><a href="#cb31-1097"></a>    <span class="st">"Monitor sunshine and evaporation coefficients for sensitivity"</span>,</span>
<span id="cb31-1098"><a href="#cb31-1098"></a>    <span class="st">"Use all m = 10 completions in downstream models"</span>,</span>
<span id="cb31-1099"><a href="#cb31-1099"></a>    <span class="st">"Pool all zero-inflated gamma model estimates using Rubin's combining rules"</span></span>
<span id="cb31-1100"><a href="#cb31-1100"></a>  )</span>
<span id="cb31-1101"><a href="#cb31-1101"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb31-1102"><a href="#cb31-1102"></a>  <span class="fu">kable</span>(</span>
<span id="cb31-1103"><a href="#cb31-1103"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Diagnostic"</span>, <span class="st">"Criterion"</span>, <span class="st">"Outcome"</span>, <span class="st">"Action"</span>),</span>
<span id="cb31-1104"><a href="#cb31-1104"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span></span>
<span id="cb31-1105"><a href="#cb31-1105"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-1106"><a href="#cb31-1106"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb31-1107"><a href="#cb31-1107"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb31-1108"><a href="#cb31-1108"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-1109"><a href="#cb31-1109"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>)</span>
<span id="cb31-1110"><a href="#cb31-1110"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-1111"><a href="#cb31-1111"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-1112"><a href="#cb31-1112"></a>  <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">italic =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-1113"><a href="#cb31-1113"></a><span class="in">```</span></span>
<span id="cb31-1114"><a href="#cb31-1114"></a></span>
<span id="cb31-1115"><a href="#cb31-1115"></a></span>
<span id="cb31-1118"><a href="#cb31-1118"></a><span class="in">```{r}</span></span>
<span id="cb31-1119"><a href="#cb31-1119"></a><span class="co">#| label: save-clean-data</span></span>
<span id="cb31-1120"><a href="#cb31-1120"></a><span class="co">#| include: false</span></span>
<span id="cb31-1121"><a href="#cb31-1121"></a></span>
<span id="cb31-1122"><a href="#cb31-1122"></a><span class="fu">saveRDS</span>(df_clean, <span class="st">"data/df_clean.rds"</span>)</span>
<span id="cb31-1123"><a href="#cb31-1123"></a><span class="in">```</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models/blob/main/02-data-prep.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/chrisolande/Statistical-Inference-Zero-Inflated-Models/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>